<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.450">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>dddex - Generate Neighborhoods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "navbar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "end",
  "type": "overlay",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script>
<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


<link rel="stylesheet" href="styles.css">
<meta property="og:title" content="dddex - Generate Neighborhoods">
<meta property="og:site-name" content="dddex">
<meta name="twitter:title" content="dddex - Generate Neighborhoods">
<meta name="twitter:card" content="summary">
</head>

<body class="nav-sidebar floating nav-fixed">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
    <nav class="navbar navbar-expand-lg navbar-dark ">
      <div class="navbar-container container-fluid">
      <div class="navbar-brand-container">
    <a class="navbar-brand" href="./index.html">
    <span class="navbar-title">dddex</span>
    </a>
  </div>
        <div class="quarto-navbar-tools ms-auto">
</div>
          <div id="quarto-search" class="" title="Search"></div>
      </div> <!-- /container-fluid -->
    </nav>
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./99_unitTests.html">Generate Neighborhoods</a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article page-navbar">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">dddex: Data-Driven Density Estimation x</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./baseclasses.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Base Class</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./levelsetkdex_univariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Level-Set Based Kernel Density Estimation</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./levelsetkdex_multivariate.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Level-Set Based Kernel Density Estimation for multivariate Predictors</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./wsaa.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">wSAA</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./crossvalidation.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Cross Validation Functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./utils.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Helper Functions</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./loaddata.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Load Datasets</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./99_unitTests.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Generate Neighborhoods</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#toy-examples" id="toc-toy-examples" class="nav-link active" data-scroll-target="#toy-examples">Toy Examples</a></li>
  <li><a href="#neighbors-on-yaz" id="toc-neighbors-on-yaz" class="nav-link" data-scroll-target="#neighbors-on-yaz">Neighbors on Yaz</a></li>
  <li><a href="#lsx-nn-kernel" id="toc-lsx-nn-kernel" class="nav-link" data-scroll-target="#lsx-nn-kernel">LSx NN Kernel</a>
  <ul class="collapse">
  <li><a href="#brute-force-version" id="toc-brute-force-version" class="nav-link" data-scroll-target="#brute-force-version">Brute Force Version</a></li>
  <li><a href="#efficientram-algorithm" id="toc-efficientram-algorithm" class="nav-link" data-scroll-target="#efficientram-algorithm">EfficientRAM Algorithm</a></li>
  </ul></li>
  <li><a href="#saa" id="toc-saa" class="nav-link" data-scroll-target="#saa">SAA</a></li>
  <li><a href="#loading-yaz-data" id="toc-loading-yaz-data" class="nav-link" data-scroll-target="#loading-yaz-data">Loading Yaz Data</a></li>
  <li><a href="#grouped-time-series-split" id="toc-grouped-time-series-split" class="nav-link" data-scroll-target="#grouped-time-series-split">Grouped Time Series Split</a></li>
  <li><a href="#cross-validation" id="toc-cross-validation" class="nav-link" data-scroll-target="#cross-validation">Cross-Validation</a>
  <ul class="collapse">
  <li><a href="#wasserstein-distance" id="toc-wasserstein-distance" class="nav-link" data-scroll-target="#wasserstein-distance">Wasserstein Distance</a></li>
  <li><a href="#cross-validation---general-quantile-predictors" id="toc-cross-validation---general-quantile-predictors" class="nav-link" data-scroll-target="#cross-validation---general-quantile-predictors">Cross Validation - General Quantile Predictors</a></li>
  </ul></li>
  <li><a href="#ls_kdex" id="toc-ls_kdex" class="nav-link" data-scroll-target="#ls_kdex">LS_KDEx</a>
  <ul class="collapse">
  <li><a href="#standard-attributes" id="toc-standard-attributes" class="nav-link" data-scroll-target="#standard-attributes">Standard Attributes</a></li>
  <li><a href="#lower-bounds" id="toc-lower-bounds" class="nav-link" data-scroll-target="#lower-bounds">Lower Bounds</a></li>
  <li><a href="#getweights" id="toc-getweights" class="nav-link" data-scroll-target="#getweights">getWeights</a></li>
  <li><a href="#set-and-get-parameters" id="toc-set-and-get-parameters" class="nav-link" data-scroll-target="#set-and-get-parameters">Set and Get Parameters</a></li>
  <li><a href="#point-estimator-fit-and-predict" id="toc-point-estimator-fit-and-predict" class="nav-link" data-scroll-target="#point-estimator-fit-and-predict">Point Estimator Fit and Predict</a></li>
  </ul></li>
  <li><a href="#ls_kdex_knn" id="toc-ls_kdex_knn" class="nav-link" data-scroll-target="#ls_kdex_knn">LS_KDEx_kNN</a>
  <ul class="collapse">
  <li><a href="#standard-attributes-1" id="toc-standard-attributes-1" class="nav-link" data-scroll-target="#standard-attributes-1">Standard Attributes</a></li>
  <li><a href="#getweights-1" id="toc-getweights-1" class="nav-link" data-scroll-target="#getweights-1">getWeights</a></li>
  <li><a href="#predict-1" id="toc-predict-1" class="nav-link" data-scroll-target="#predict-1">predict</a></li>
  <li><a href="#set-and-get-parameters-1" id="toc-set-and-get-parameters-1" class="nav-link" data-scroll-target="#set-and-get-parameters-1">Set and Get Parameters</a></li>
  <li><a href="#point-estimator-fit-and-predict-1" id="toc-point-estimator-fit-and-predict-1" class="nav-link" data-scroll-target="#point-estimator-fit-and-predict-1">Point Estimator Fit and Predict</a></li>
  </ul></li>
  <li><a href="#generate-bins" id="toc-generate-bins" class="nav-link" data-scroll-target="#generate-bins">Generate Bins</a></li>
  </ul>
<div class="toc-actions"><div><i class="bi bi-github"></i></div><div class="action-links"><p><a href="https://github.com/kaiguender/dddex/issues/new" class="toc-action">Report an issue</a></p></div></div></nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Generate Neighborhoods</h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- WARNING: THIS FILE WAS AUTOGENERATED! DO NOT EDIT! -->
<section id="toy-examples" class="level3">
<h3 class="anchored" data-anchor-id="toy-examples">Toy Examples</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">10</span>, <span class="dv">15</span>, <span class="dv">21</span>, <span class="dv">28</span>, <span class="dv">36</span>, <span class="dv">45</span>, <span class="dv">55</span>, <span class="dv">66</span>, <span class="dv">78</span>])</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">24</span>]),</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb1-10"><a href="#cb1-10" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb1-11"><a href="#cb1-11" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">24</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>])</span>
<span id="cb1-12"><a href="#cb1-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-13"><a href="#cb1-13" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="dv">24</span>]),</span>
<span id="cb1-14"><a href="#cb1-14" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb1-15"><a href="#cb1-15" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb1-16"><a href="#cb1-16" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb1-17"><a href="#cb1-17" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb1-18"><a href="#cb1-18" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb1-19"><a href="#cb1-19" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb1-20"><a href="#cb1-20" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb1-21"><a href="#cb1-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="dv">2</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">4</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">6</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">4</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">6</span>])</span>
<span id="cb1-23"><a href="#cb1-23" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> weights <span class="op">/</span> weights.<span class="bu">sum</span>()</span>
<span id="cb1-24"><a href="#cb1-24" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>]</span>
<span id="cb1-25"><a href="#cb1-25" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights)</span>
<span id="cb1-26"><a href="#cb1-26" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices)</span>
<span id="cb1-27"><a href="#cb1-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-28"><a href="#cb1-28" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb1-29"><a href="#cb1-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-30"><a href="#cb1-30" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb1-31"><a href="#cb1-31" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="fl">25.5</span>]),</span>
<span id="cb1-32"><a href="#cb1-32" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb1-33"><a href="#cb1-33" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb1-34"><a href="#cb1-34" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">25.5</span>], [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>])</span>
<span id="cb1-35"><a href="#cb1-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-36"><a href="#cb1-36" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="fl">25.5</span>]),</span>
<span id="cb1-37"><a href="#cb1-37" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb1-38"><a href="#cb1-38" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb1-39"><a href="#cb1-39" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb1-40"><a href="#cb1-40" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb1-41"><a href="#cb1-41" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb1-42"><a href="#cb1-42" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb1-43"><a href="#cb1-43" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb1-44"><a href="#cb1-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-45"><a href="#cb1-45" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="dv">2</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">4</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">6</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">6</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">4</span><span class="op">/</span><span class="dv">7</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">7</span>])</span>
<span id="cb1-46"><a href="#cb1-46" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> weights <span class="op">/</span> weights.<span class="bu">sum</span>()</span>
<span id="cb1-47"><a href="#cb1-47" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]</span>
<span id="cb1-48"><a href="#cb1-48" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights)</span>
<span id="cb1-49"><a href="#cb1-49" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices)</span>
<span id="cb1-50"><a href="#cb1-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-51"><a href="#cb1-51" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb1-52"><a href="#cb1-52" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-53"><a href="#cb1-53" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb1-54"><a href="#cb1-54" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="fl">25.54</span>]),</span>
<span id="cb1-55"><a href="#cb1-55" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb1-56"><a href="#cb1-56" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb1-57"><a href="#cb1-57" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">25.54</span>], [<span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>])</span>
<span id="cb1-58"><a href="#cb1-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-59"><a href="#cb1-59" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="fl">25.54</span>]),</span>
<span id="cb1-60"><a href="#cb1-60" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb1-61"><a href="#cb1-61" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb1-62"><a href="#cb1-62" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb1-63"><a href="#cb1-63" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb1-64"><a href="#cb1-64" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb1-65"><a href="#cb1-65" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb1-66"><a href="#cb1-66" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb1-67"><a href="#cb1-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb1-68"><a href="#cb1-68" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> np.array([<span class="dv">2</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">4</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">6</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">4</span><span class="op">/</span><span class="dv">6</span>, <span class="dv">2</span><span class="op">/</span><span class="dv">6</span>])</span>
<span id="cb1-69"><a href="#cb1-69" aria-hidden="true" tabindex="-1"></a>weights <span class="op">=</span> weights <span class="op">/</span> weights.<span class="bu">sum</span>()</span>
<span id="cb1-70"><a href="#cb1-70" aria-hidden="true" tabindex="-1"></a>indices <span class="op">=</span> [<span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>]</span>
<span id="cb1-71"><a href="#cb1-71" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights)</span>
<span id="cb1-72"><a href="#cb1-72" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 192.29 MB
After Kernel Values: Memory used by Jupyter notebook: 192.29 MB
After Kernel Values: Memory used by Jupyter notebook: 192.29 MB
After Kernel Values: Memory used by Jupyter notebook: 192.29 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.concatenate([np.arange(<span class="dv">3</span>)] <span class="op">*</span> <span class="dv">5</span>, axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-9"><a href="#cb3-9" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-10"><a href="#cb3-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-11"><a href="#cb3-11" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>])</span>
<span id="cb3-12"><a href="#cb3-12" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-13"><a href="#cb3-13" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-14"><a href="#cb3-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-15"><a href="#cb3-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-16"><a href="#cb3-16" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-17"><a href="#cb3-17" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb3-18"><a href="#cb3-18" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-19"><a href="#cb3-19" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-20"><a href="#cb3-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-21"><a href="#cb3-21" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-22"><a href="#cb3-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-23"><a href="#cb3-23" aria-hidden="true" tabindex="-1"></a>neighbors0 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>]</span>
<span id="cb3-24"><a href="#cb3-24" aria-hidden="true" tabindex="-1"></a>neighbors1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>]</span>
<span id="cb3-25"><a href="#cb3-25" aria-hidden="true" tabindex="-1"></a>neighbors2 <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-26"><a href="#cb3-26" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], neighbors0)</span>
<span id="cb3-27"><a href="#cb3-27" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], neighbors1)</span>
<span id="cb3-28"><a href="#cb3-28" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], neighbors2)</span>
<span id="cb3-29"><a href="#cb3-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-30"><a href="#cb3-30" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb3-31"><a href="#cb3-31" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-32"><a href="#cb3-32" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-33"><a href="#cb3-33" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-34"><a href="#cb3-34" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-35"><a href="#cb3-35" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-36"><a href="#cb3-36" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-37"><a href="#cb3-37" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-38"><a href="#cb3-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-39"><a href="#cb3-39" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb3-40"><a href="#cb3-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-41"><a href="#cb3-41" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-42"><a href="#cb3-42" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>):</span>
<span id="cb3-43"><a href="#cb3-43" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">0</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">0</span>])</span>
<span id="cb3-44"><a href="#cb3-44" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">1</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">1</span>])</span>
<span id="cb3-45"><a href="#cb3-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-46"><a href="#cb3-46" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-47"><a href="#cb3-47" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> weights0 <span class="op">/</span> weights0.<span class="bu">sum</span>()</span>
<span id="cb3-48"><a href="#cb3-48" aria-hidden="true" tabindex="-1"></a>indices0 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>])</span>
<span id="cb3-49"><a href="#cb3-49" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-50"><a href="#cb3-50" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb3-51"><a href="#cb3-51" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-52"><a href="#cb3-52" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-53"><a href="#cb3-53" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb3-54"><a href="#cb3-54" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-55"><a href="#cb3-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-56"><a href="#cb3-56" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-57"><a href="#cb3-57" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-58"><a href="#cb3-58" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb3-59"><a href="#cb3-59" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb3-60"><a href="#cb3-60" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-61"><a href="#cb3-61" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-62"><a href="#cb3-62" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-63"><a href="#cb3-63" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-64"><a href="#cb3-64" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-65"><a href="#cb3-65" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-66"><a href="#cb3-66" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-67"><a href="#cb3-67" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-68"><a href="#cb3-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-69"><a href="#cb3-69" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>])</span>
<span id="cb3-70"><a href="#cb3-70" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-71"><a href="#cb3-71" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], np.array(neighbors0))</span>
<span id="cb3-72"><a href="#cb3-72" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">0.4</span>], np.array(neighbors0))</span>
<span id="cb3-73"><a href="#cb3-73" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">1.5</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-74"><a href="#cb3-74" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], np.array(neighbors2))</span>
<span id="cb3-75"><a href="#cb3-75" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-76"><a href="#cb3-76" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-77"><a href="#cb3-77" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-78"><a href="#cb3-78" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-79"><a href="#cb3-79" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-80"><a href="#cb3-80" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-81"><a href="#cb3-81" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-82"><a href="#cb3-82" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-83"><a href="#cb3-83" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-84"><a href="#cb3-84" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-85"><a href="#cb3-85" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">4</span>)</span>
<span id="cb3-86"><a href="#cb3-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-87"><a href="#cb3-87" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">15</span>, <span class="dv">10</span> <span class="op">/</span> <span class="dv">15</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-88"><a href="#cb3-88" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> weightsTest <span class="op">/</span> weightsTest.<span class="bu">sum</span>()</span>
<span id="cb3-89"><a href="#cb3-89" aria-hidden="true" tabindex="-1"></a>indicesTest <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">14</span>])</span>
<span id="cb3-90"><a href="#cb3-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-91"><a href="#cb3-91" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-92"><a href="#cb3-92" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-93"><a href="#cb3-93" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-94"><a href="#cb3-94" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-95"><a href="#cb3-95" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weightsTest)</span>
<span id="cb3-96"><a href="#cb3-96" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indicesTest)</span>
<span id="cb3-97"><a href="#cb3-97" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-98"><a href="#cb3-98" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-99"><a href="#cb3-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-100"><a href="#cb3-100" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb3-101"><a href="#cb3-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-102"><a href="#cb3-102" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb3-103"><a href="#cb3-103" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb3-104"><a href="#cb3-104" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb3-105"><a href="#cb3-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-106"><a href="#cb3-106" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-107"><a href="#cb3-107" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-108"><a href="#cb3-108" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>])</span>
<span id="cb3-109"><a href="#cb3-109" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-110"><a href="#cb3-110" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-111"><a href="#cb3-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-112"><a href="#cb3-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-113"><a href="#cb3-113" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-114"><a href="#cb3-114" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb3-115"><a href="#cb3-115" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-116"><a href="#cb3-116" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-117"><a href="#cb3-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-118"><a href="#cb3-118" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-119"><a href="#cb3-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-120"><a href="#cb3-120" aria-hidden="true" tabindex="-1"></a>neighbors0 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>]</span>
<span id="cb3-121"><a href="#cb3-121" aria-hidden="true" tabindex="-1"></a>neighbors1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>]</span>
<span id="cb3-122"><a href="#cb3-122" aria-hidden="true" tabindex="-1"></a>neighbors2 <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-123"><a href="#cb3-123" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], neighbors0)</span>
<span id="cb3-124"><a href="#cb3-124" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], neighbors1)</span>
<span id="cb3-125"><a href="#cb3-125" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], neighbors2)</span>
<span id="cb3-126"><a href="#cb3-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-127"><a href="#cb3-127" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb3-128"><a href="#cb3-128" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-129"><a href="#cb3-129" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-130"><a href="#cb3-130" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-131"><a href="#cb3-131" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-132"><a href="#cb3-132" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-133"><a href="#cb3-133" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-134"><a href="#cb3-134" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-135"><a href="#cb3-135" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-136"><a href="#cb3-136" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb3-137"><a href="#cb3-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-138"><a href="#cb3-138" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-139"><a href="#cb3-139" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>):</span>
<span id="cb3-140"><a href="#cb3-140" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">0</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">0</span>])</span>
<span id="cb3-141"><a href="#cb3-141" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">1</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">1</span>])</span>
<span id="cb3-142"><a href="#cb3-142" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb3-143"><a href="#cb3-143" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-144"><a href="#cb3-144" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> weights0 <span class="op">/</span> weights0.<span class="bu">sum</span>()</span>
<span id="cb3-145"><a href="#cb3-145" aria-hidden="true" tabindex="-1"></a>indices0 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>])</span>
<span id="cb3-146"><a href="#cb3-146" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-147"><a href="#cb3-147" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb3-148"><a href="#cb3-148" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-149"><a href="#cb3-149" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-150"><a href="#cb3-150" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb3-151"><a href="#cb3-151" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-152"><a href="#cb3-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-153"><a href="#cb3-153" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-154"><a href="#cb3-154" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-155"><a href="#cb3-155" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb3-156"><a href="#cb3-156" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb3-157"><a href="#cb3-157" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-158"><a href="#cb3-158" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-159"><a href="#cb3-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-160"><a href="#cb3-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-161"><a href="#cb3-161" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-162"><a href="#cb3-162" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-163"><a href="#cb3-163" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-164"><a href="#cb3-164" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-165"><a href="#cb3-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-166"><a href="#cb3-166" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>])</span>
<span id="cb3-167"><a href="#cb3-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-168"><a href="#cb3-168" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], np.array(neighbors0))</span>
<span id="cb3-169"><a href="#cb3-169" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">0.4</span>], np.array(neighbors0))</span>
<span id="cb3-170"><a href="#cb3-170" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">1.5</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-171"><a href="#cb3-171" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], np.array(neighbors2))</span>
<span id="cb3-172"><a href="#cb3-172" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-173"><a href="#cb3-173" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-174"><a href="#cb3-174" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-175"><a href="#cb3-175" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-176"><a href="#cb3-176" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-177"><a href="#cb3-177" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-178"><a href="#cb3-178" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-179"><a href="#cb3-179" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-180"><a href="#cb3-180" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-181"><a href="#cb3-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-182"><a href="#cb3-182" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">4</span>)</span>
<span id="cb3-183"><a href="#cb3-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-184"><a href="#cb3-184" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">15</span>, <span class="dv">10</span> <span class="op">/</span> <span class="dv">15</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-185"><a href="#cb3-185" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> weightsTest <span class="op">/</span> weightsTest.<span class="bu">sum</span>()</span>
<span id="cb3-186"><a href="#cb3-186" aria-hidden="true" tabindex="-1"></a>indicesTest <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">14</span>])</span>
<span id="cb3-187"><a href="#cb3-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-188"><a href="#cb3-188" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-189"><a href="#cb3-189" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-190"><a href="#cb3-190" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-191"><a href="#cb3-191" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-192"><a href="#cb3-192" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weightsTest)</span>
<span id="cb3-193"><a href="#cb3-193" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indicesTest)</span>
<span id="cb3-194"><a href="#cb3-194" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-195"><a href="#cb3-195" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-196"><a href="#cb3-196" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-197"><a href="#cb3-197" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb3-198"><a href="#cb3-198" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-199"><a href="#cb3-199" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb3-200"><a href="#cb3-200" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb3-201"><a href="#cb3-201" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb3-202"><a href="#cb3-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-203"><a href="#cb3-203" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-204"><a href="#cb3-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-205"><a href="#cb3-205" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>])</span>
<span id="cb3-206"><a href="#cb3-206" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-207"><a href="#cb3-207" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-208"><a href="#cb3-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-209"><a href="#cb3-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-210"><a href="#cb3-210" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-211"><a href="#cb3-211" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb3-212"><a href="#cb3-212" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-213"><a href="#cb3-213" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-214"><a href="#cb3-214" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-215"><a href="#cb3-215" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-216"><a href="#cb3-216" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-217"><a href="#cb3-217" aria-hidden="true" tabindex="-1"></a>neighbors0 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>]</span>
<span id="cb3-218"><a href="#cb3-218" aria-hidden="true" tabindex="-1"></a>neighbors1 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>]</span>
<span id="cb3-219"><a href="#cb3-219" aria-hidden="true" tabindex="-1"></a>neighbors2 <span class="op">=</span> [<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-220"><a href="#cb3-220" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], neighbors0)</span>
<span id="cb3-221"><a href="#cb3-221" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], neighbors1)</span>
<span id="cb3-222"><a href="#cb3-222" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], neighbors2)</span>
<span id="cb3-223"><a href="#cb3-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-224"><a href="#cb3-224" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb3-225"><a href="#cb3-225" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-226"><a href="#cb3-226" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-227"><a href="#cb3-227" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-228"><a href="#cb3-228" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-229"><a href="#cb3-229" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-230"><a href="#cb3-230" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-231"><a href="#cb3-231" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-232"><a href="#cb3-232" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-233"><a href="#cb3-233" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb3-234"><a href="#cb3-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-235"><a href="#cb3-235" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-236"><a href="#cb3-236" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>):</span>
<span id="cb3-237"><a href="#cb3-237" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">0</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">0</span>])</span>
<span id="cb3-238"><a href="#cb3-238" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">1</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">1</span>])</span>
<span id="cb3-239"><a href="#cb3-239" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-240"><a href="#cb3-240" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-241"><a href="#cb3-241" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> weights0 <span class="op">/</span> weights0.<span class="bu">sum</span>()</span>
<span id="cb3-242"><a href="#cb3-242" aria-hidden="true" tabindex="-1"></a>indices0 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>])</span>
<span id="cb3-243"><a href="#cb3-243" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-244"><a href="#cb3-244" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb3-245"><a href="#cb3-245" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-246"><a href="#cb3-246" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.repeat(<span class="dv">1</span><span class="op">/</span><span class="dv">5</span>, <span class="dv">5</span>)</span>
<span id="cb3-247"><a href="#cb3-247" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb3-248"><a href="#cb3-248" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.array([<span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-249"><a href="#cb3-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-250"><a href="#cb3-250" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-251"><a href="#cb3-251" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-252"><a href="#cb3-252" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb3-253"><a href="#cb3-253" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb3-254"><a href="#cb3-254" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-255"><a href="#cb3-255" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-256"><a href="#cb3-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-257"><a href="#cb3-257" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-258"><a href="#cb3-258" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-259"><a href="#cb3-259" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-260"><a href="#cb3-260" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-261"><a href="#cb3-261" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-262"><a href="#cb3-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-263"><a href="#cb3-263" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>])</span>
<span id="cb3-264"><a href="#cb3-264" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-265"><a href="#cb3-265" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], np.array(neighbors0))</span>
<span id="cb3-266"><a href="#cb3-266" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">0.4</span>], np.array(neighbors0))</span>
<span id="cb3-267"><a href="#cb3-267" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">1.5</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-268"><a href="#cb3-268" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], np.array(neighbors2))</span>
<span id="cb3-269"><a href="#cb3-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-270"><a href="#cb3-270" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-271"><a href="#cb3-271" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-272"><a href="#cb3-272" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-273"><a href="#cb3-273" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-274"><a href="#cb3-274" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-275"><a href="#cb3-275" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-276"><a href="#cb3-276" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-277"><a href="#cb3-277" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-278"><a href="#cb3-278" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-279"><a href="#cb3-279" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">4</span>)</span>
<span id="cb3-280"><a href="#cb3-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-281"><a href="#cb3-281" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">15</span>, <span class="dv">10</span> <span class="op">/</span> <span class="dv">15</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-282"><a href="#cb3-282" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> weightsTest <span class="op">/</span> weightsTest.<span class="bu">sum</span>()</span>
<span id="cb3-283"><a href="#cb3-283" aria-hidden="true" tabindex="-1"></a>indicesTest <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">13</span>, <span class="dv">14</span>])</span>
<span id="cb3-284"><a href="#cb3-284" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-285"><a href="#cb3-285" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-286"><a href="#cb3-286" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-287"><a href="#cb3-287" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-288"><a href="#cb3-288" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-289"><a href="#cb3-289" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weightsTest)</span>
<span id="cb3-290"><a href="#cb3-290" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indicesTest)</span>
<span id="cb3-291"><a href="#cb3-291" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-292"><a href="#cb3-292" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-293"><a href="#cb3-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-294"><a href="#cb3-294" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb3-295"><a href="#cb3-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-296"><a href="#cb3-296" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb3-297"><a href="#cb3-297" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb3-298"><a href="#cb3-298" aria-hidden="true" tabindex="-1"></a>                                                                    yPred <span class="op">=</span> yPred)</span>
<span id="cb3-299"><a href="#cb3-299" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-300"><a href="#cb3-300" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-301"><a href="#cb3-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-302"><a href="#cb3-302" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-303"><a href="#cb3-303" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-304"><a href="#cb3-304" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-305"><a href="#cb3-305" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-306"><a href="#cb3-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-307"><a href="#cb3-307" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-308"><a href="#cb3-308" aria-hidden="true" tabindex="-1"></a>                                     yPred <span class="op">=</span> yPred,</span>
<span id="cb3-309"><a href="#cb3-309" aria-hidden="true" tabindex="-1"></a>                                     yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-310"><a href="#cb3-310" aria-hidden="true" tabindex="-1"></a>                                     neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-311"><a href="#cb3-311" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-312"><a href="#cb3-312" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-313"><a href="#cb3-313" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-314"><a href="#cb3-314" aria-hidden="true" tabindex="-1"></a>neighbors0 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>]</span>
<span id="cb3-315"><a href="#cb3-315" aria-hidden="true" tabindex="-1"></a>neighbors1 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-316"><a href="#cb3-316" aria-hidden="true" tabindex="-1"></a>neighbors2 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-317"><a href="#cb3-317" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], neighbors0)</span>
<span id="cb3-318"><a href="#cb3-318" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], neighbors1)</span>
<span id="cb3-319"><a href="#cb3-319" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], neighbors2)</span>
<span id="cb3-320"><a href="#cb3-320" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-321"><a href="#cb3-321" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb3-322"><a href="#cb3-322" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-323"><a href="#cb3-323" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-324"><a href="#cb3-324" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-325"><a href="#cb3-325" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-326"><a href="#cb3-326" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-327"><a href="#cb3-327" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-328"><a href="#cb3-328" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-329"><a href="#cb3-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-330"><a href="#cb3-330" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb3-331"><a href="#cb3-331" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-332"><a href="#cb3-332" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-333"><a href="#cb3-333" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>):</span>
<span id="cb3-334"><a href="#cb3-334" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">0</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">0</span>])</span>
<span id="cb3-335"><a href="#cb3-335" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">1</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">1</span>])</span>
<span id="cb3-336"><a href="#cb3-336" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-337"><a href="#cb3-337" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> np.array([<span class="dv">20</span> <span class="op">/</span> <span class="dv">20</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">10</span> <span class="op">/</span> <span class="dv">20</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-338"><a href="#cb3-338" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> weights0 <span class="op">/</span> weights0.<span class="bu">sum</span>()</span>
<span id="cb3-339"><a href="#cb3-339" aria-hidden="true" tabindex="-1"></a>indices0 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-340"><a href="#cb3-340" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">30</span> <span class="op">/</span> <span class="dv">30</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-341"><a href="#cb3-341" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb3-342"><a href="#cb3-342" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-343"><a href="#cb3-343" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">20</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">20</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-344"><a href="#cb3-344" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb3-345"><a href="#cb3-345" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-346"><a href="#cb3-346" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-347"><a href="#cb3-347" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-348"><a href="#cb3-348" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-349"><a href="#cb3-349" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb3-350"><a href="#cb3-350" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb3-351"><a href="#cb3-351" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-352"><a href="#cb3-352" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-353"><a href="#cb3-353" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-354"><a href="#cb3-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-355"><a href="#cb3-355" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-356"><a href="#cb3-356" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-357"><a href="#cb3-357" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-358"><a href="#cb3-358" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-359"><a href="#cb3-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-360"><a href="#cb3-360" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>])</span>
<span id="cb3-361"><a href="#cb3-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-362"><a href="#cb3-362" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], np.array(neighbors0))</span>
<span id="cb3-363"><a href="#cb3-363" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">0.4</span>], np.array(neighbors0))</span>
<span id="cb3-364"><a href="#cb3-364" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">1.5</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-365"><a href="#cb3-365" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], np.array(neighbors2))</span>
<span id="cb3-366"><a href="#cb3-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-367"><a href="#cb3-367" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-368"><a href="#cb3-368" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-369"><a href="#cb3-369" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-370"><a href="#cb3-370" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-371"><a href="#cb3-371" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-372"><a href="#cb3-372" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-373"><a href="#cb3-373" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-374"><a href="#cb3-374" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-375"><a href="#cb3-375" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-376"><a href="#cb3-376" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">4</span>)</span>
<span id="cb3-377"><a href="#cb3-377" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-378"><a href="#cb3-378" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">20</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">20</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-379"><a href="#cb3-379" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> weightsTest <span class="op">/</span> weightsTest.<span class="bu">sum</span>()</span>
<span id="cb3-380"><a href="#cb3-380" aria-hidden="true" tabindex="-1"></a>indicesTest <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>])</span>
<span id="cb3-381"><a href="#cb3-381" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-382"><a href="#cb3-382" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-383"><a href="#cb3-383" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-384"><a href="#cb3-384" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-385"><a href="#cb3-385" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-386"><a href="#cb3-386" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weightsTest)</span>
<span id="cb3-387"><a href="#cb3-387" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indicesTest)</span>
<span id="cb3-388"><a href="#cb3-388" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-389"><a href="#cb3-389" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-390"><a href="#cb3-390" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-391"><a href="#cb3-391" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb3-392"><a href="#cb3-392" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-393"><a href="#cb3-393" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb3-394"><a href="#cb3-394" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb3-395"><a href="#cb3-395" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb3-396"><a href="#cb3-396" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-397"><a href="#cb3-397" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-398"><a href="#cb3-398" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-399"><a href="#cb3-399" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>])</span>
<span id="cb3-400"><a href="#cb3-400" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-401"><a href="#cb3-401" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-402"><a href="#cb3-402" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-403"><a href="#cb3-403" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-404"><a href="#cb3-404" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-405"><a href="#cb3-405" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-406"><a href="#cb3-406" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb3-407"><a href="#cb3-407" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-408"><a href="#cb3-408" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-409"><a href="#cb3-409" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-410"><a href="#cb3-410" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-411"><a href="#cb3-411" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-412"><a href="#cb3-412" aria-hidden="true" tabindex="-1"></a>neighbors0 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>]</span>
<span id="cb3-413"><a href="#cb3-413" aria-hidden="true" tabindex="-1"></a>neighbors1 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-414"><a href="#cb3-414" aria-hidden="true" tabindex="-1"></a>neighbors2 <span class="op">=</span> [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-415"><a href="#cb3-415" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], neighbors0)</span>
<span id="cb3-416"><a href="#cb3-416" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], neighbors1)</span>
<span id="cb3-417"><a href="#cb3-417" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], neighbors2)</span>
<span id="cb3-418"><a href="#cb3-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-419"><a href="#cb3-419" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb3-420"><a href="#cb3-420" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-421"><a href="#cb3-421" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-422"><a href="#cb3-422" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-423"><a href="#cb3-423" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-424"><a href="#cb3-424" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-425"><a href="#cb3-425" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-426"><a href="#cb3-426" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-427"><a href="#cb3-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-428"><a href="#cb3-428" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb3-429"><a href="#cb3-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-430"><a href="#cb3-430" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-431"><a href="#cb3-431" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>):</span>
<span id="cb3-432"><a href="#cb3-432" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">0</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">0</span>])</span>
<span id="cb3-433"><a href="#cb3-433" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">1</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">1</span>])</span>
<span id="cb3-434"><a href="#cb3-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-435"><a href="#cb3-435" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> np.array([<span class="dv">20</span> <span class="op">/</span> <span class="dv">20</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">10</span> <span class="op">/</span> <span class="dv">20</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-436"><a href="#cb3-436" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> weights0 <span class="op">/</span> weights0.<span class="bu">sum</span>()</span>
<span id="cb3-437"><a href="#cb3-437" aria-hidden="true" tabindex="-1"></a>indices0 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-438"><a href="#cb3-438" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">30</span> <span class="op">/</span> <span class="dv">30</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-439"><a href="#cb3-439" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb3-440"><a href="#cb3-440" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-441"><a href="#cb3-441" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">20</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">20</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-442"><a href="#cb3-442" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb3-443"><a href="#cb3-443" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-444"><a href="#cb3-444" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-445"><a href="#cb3-445" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-446"><a href="#cb3-446" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-447"><a href="#cb3-447" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb3-448"><a href="#cb3-448" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb3-449"><a href="#cb3-449" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-450"><a href="#cb3-450" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-451"><a href="#cb3-451" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-452"><a href="#cb3-452" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-453"><a href="#cb3-453" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-454"><a href="#cb3-454" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-455"><a href="#cb3-455" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-456"><a href="#cb3-456" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-457"><a href="#cb3-457" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-458"><a href="#cb3-458" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>])</span>
<span id="cb3-459"><a href="#cb3-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-460"><a href="#cb3-460" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], np.array(neighbors0))</span>
<span id="cb3-461"><a href="#cb3-461" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">0.4</span>], np.array(neighbors0))</span>
<span id="cb3-462"><a href="#cb3-462" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">1.5</span>], [<span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-463"><a href="#cb3-463" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], np.array(neighbors2))</span>
<span id="cb3-464"><a href="#cb3-464" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-465"><a href="#cb3-465" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-466"><a href="#cb3-466" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-467"><a href="#cb3-467" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-468"><a href="#cb3-468" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-469"><a href="#cb3-469" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-470"><a href="#cb3-470" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-471"><a href="#cb3-471" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-472"><a href="#cb3-472" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-473"><a href="#cb3-473" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-474"><a href="#cb3-474" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">4</span>)</span>
<span id="cb3-475"><a href="#cb3-475" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-476"><a href="#cb3-476" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">20</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">25</span>, <span class="dv">20</span> <span class="op">/</span> <span class="dv">20</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-477"><a href="#cb3-477" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> weightsTest <span class="op">/</span> weightsTest.<span class="bu">sum</span>()</span>
<span id="cb3-478"><a href="#cb3-478" aria-hidden="true" tabindex="-1"></a>indicesTest <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>])</span>
<span id="cb3-479"><a href="#cb3-479" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-480"><a href="#cb3-480" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-481"><a href="#cb3-481" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-482"><a href="#cb3-482" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-483"><a href="#cb3-483" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-484"><a href="#cb3-484" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weightsTest)</span>
<span id="cb3-485"><a href="#cb3-485" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indicesTest)</span>
<span id="cb3-486"><a href="#cb3-486" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-487"><a href="#cb3-487" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-488"><a href="#cb3-488" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-489"><a href="#cb3-489" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb3-490"><a href="#cb3-490" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-491"><a href="#cb3-491" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">12</span></span>
<span id="cb3-492"><a href="#cb3-492" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb3-493"><a href="#cb3-493" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb3-494"><a href="#cb3-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-495"><a href="#cb3-495" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-496"><a href="#cb3-496" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-497"><a href="#cb3-497" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-498"><a href="#cb3-498" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-499"><a href="#cb3-499" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-500"><a href="#cb3-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-501"><a href="#cb3-501" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-502"><a href="#cb3-502" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-503"><a href="#cb3-503" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb3-504"><a href="#cb3-504" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-505"><a href="#cb3-505" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-506"><a href="#cb3-506" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-507"><a href="#cb3-507" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb3-508"><a href="#cb3-508" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-509"><a href="#cb3-509" aria-hidden="true" tabindex="-1"></a>neighbors0 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-510"><a href="#cb3-510" aria-hidden="true" tabindex="-1"></a>neighbors1 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-511"><a href="#cb3-511" aria-hidden="true" tabindex="-1"></a>neighbors2 <span class="op">=</span> [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>]</span>
<span id="cb3-512"><a href="#cb3-512" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], neighbors0)</span>
<span id="cb3-513"><a href="#cb3-513" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], neighbors1)</span>
<span id="cb3-514"><a href="#cb3-514" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], neighbors2)</span>
<span id="cb3-515"><a href="#cb3-515" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-516"><a href="#cb3-516" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb3-517"><a href="#cb3-517" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-518"><a href="#cb3-518" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-519"><a href="#cb3-519" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-520"><a href="#cb3-520" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-521"><a href="#cb3-521" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-522"><a href="#cb3-522" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-523"><a href="#cb3-523" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-524"><a href="#cb3-524" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-525"><a href="#cb3-525" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb3-526"><a href="#cb3-526" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-527"><a href="#cb3-527" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>):</span>
<span id="cb3-528"><a href="#cb3-528" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> j <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>, <span class="dv">5</span>, <span class="dv">1</span>):</span>
<span id="cb3-529"><a href="#cb3-529" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">0</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">0</span>])</span>
<span id="cb3-530"><a href="#cb3-530" aria-hidden="true" tabindex="-1"></a>        test_eq(weightsData[i][<span class="dv">1</span>], weightsData[i <span class="op">+</span> <span class="dv">3</span><span class="op">*</span>j][<span class="dv">1</span>])</span>
<span id="cb3-531"><a href="#cb3-531" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-532"><a href="#cb3-532" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-533"><a href="#cb3-533" aria-hidden="true" tabindex="-1"></a>weights0 <span class="op">=</span> weights0 <span class="op">/</span> weights0.<span class="bu">sum</span>()</span>
<span id="cb3-534"><a href="#cb3-534" aria-hidden="true" tabindex="-1"></a>indices0 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-535"><a href="#cb3-535" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-536"><a href="#cb3-536" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb3-537"><a href="#cb3-537" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-538"><a href="#cb3-538" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-539"><a href="#cb3-539" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb3-540"><a href="#cb3-540" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">15</span>)</span>
<span id="cb3-541"><a href="#cb3-541" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-542"><a href="#cb3-542" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-543"><a href="#cb3-543" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-544"><a href="#cb3-544" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb3-545"><a href="#cb3-545" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb3-546"><a href="#cb3-546" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-547"><a href="#cb3-547" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb3-548"><a href="#cb3-548" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-549"><a href="#cb3-549" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-550"><a href="#cb3-550" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb3-551"><a href="#cb3-551" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-552"><a href="#cb3-552" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-553"><a href="#cb3-553" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb3-554"><a href="#cb3-554" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-555"><a href="#cb3-555" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>])</span>
<span id="cb3-556"><a href="#cb3-556" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-557"><a href="#cb3-557" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], np.array(neighbors0))</span>
<span id="cb3-558"><a href="#cb3-558" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">0.4</span>], np.array(neighbors0))</span>
<span id="cb3-559"><a href="#cb3-559" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="fl">1.5</span>], [<span class="dv">0</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">9</span>, <span class="dv">12</span>, <span class="dv">1</span>, <span class="dv">4</span>, <span class="dv">7</span>, <span class="dv">10</span>, <span class="dv">13</span>, <span class="dv">2</span>, <span class="dv">5</span>, <span class="dv">8</span>, <span class="dv">11</span>, <span class="dv">14</span>])</span>
<span id="cb3-560"><a href="#cb3-560" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], np.array(neighbors2))</span>
<span id="cb3-561"><a href="#cb3-561" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-562"><a href="#cb3-562" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="fl">0.4</span>, <span class="fl">1.5</span>, <span class="dv">4</span>]),</span>
<span id="cb3-563"><a href="#cb3-563" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb3-564"><a href="#cb3-564" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb3-565"><a href="#cb3-565" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb3-566"><a href="#cb3-566" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb3-567"><a href="#cb3-567" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb3-568"><a href="#cb3-568" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb3-569"><a href="#cb3-569" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb3-570"><a href="#cb3-570" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-571"><a href="#cb3-571" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">4</span>)</span>
<span id="cb3-572"><a href="#cb3-572" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-573"><a href="#cb3-573" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">1</span>, <span class="dv">1</span>] <span class="op">*</span> <span class="dv">5</span>)</span>
<span id="cb3-574"><a href="#cb3-574" aria-hidden="true" tabindex="-1"></a>weightsTest <span class="op">=</span> weightsTest <span class="op">/</span> weightsTest.<span class="bu">sum</span>()</span>
<span id="cb3-575"><a href="#cb3-575" aria-hidden="true" tabindex="-1"></a>indicesTest <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>])</span>
<span id="cb3-576"><a href="#cb3-576" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-577"><a href="#cb3-577" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-578"><a href="#cb3-578" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-579"><a href="#cb3-579" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights0)</span>
<span id="cb3-580"><a href="#cb3-580" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices0)</span>
<span id="cb3-581"><a href="#cb3-581" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">0</span>], weightsTest)</span>
<span id="cb3-582"><a href="#cb3-582" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">2</span>][<span class="dv">1</span>], indicesTest)</span>
<span id="cb3-583"><a href="#cb3-583" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb3-584"><a href="#cb3-584" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Loop: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Loop: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Loop: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Loop: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Loop: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB
After Kernel Values: Memory used by Jupyter notebook: 194.67 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb5"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>])</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>])</span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-19"><a href="#cb5-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-20"><a href="#cb5-20" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-21"><a href="#cb5-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-22"><a href="#cb5-22" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], [<span class="dv">0</span>])</span>
<span id="cb5-23"><a href="#cb5-23" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-24"><a href="#cb5-24" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-25"><a href="#cb5-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-26"><a href="#cb5-26" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb5-27"><a href="#cb5-27" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-28"><a href="#cb5-28" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-29"><a href="#cb5-29" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-30"><a href="#cb5-30" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-31"><a href="#cb5-31" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-32"><a href="#cb5-32" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-33"><a href="#cb5-33" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-34"><a href="#cb5-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-35"><a href="#cb5-35" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb5-36"><a href="#cb5-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-37"><a href="#cb5-37" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weightsData[<span class="dv">2</span>][<span class="dv">0</span>])</span>
<span id="cb5-38"><a href="#cb5-38" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], weightsData[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb5-39"><a href="#cb5-39" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">4</span>][<span class="dv">0</span>])</span>
<span id="cb5-40"><a href="#cb5-40" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">4</span>][<span class="dv">1</span>])</span>
<span id="cb5-41"><a href="#cb5-41" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">5</span>][<span class="dv">0</span>])</span>
<span id="cb5-42"><a href="#cb5-42" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">5</span>][<span class="dv">1</span>])</span>
<span id="cb5-43"><a href="#cb5-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-44"><a href="#cb5-44" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">1</span>])</span>
<span id="cb5-45"><a href="#cb5-45" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb5-46"><a href="#cb5-46" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.array([<span class="dv">0</span>])</span>
<span id="cb5-47"><a href="#cb5-47" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">1</span>] <span class="op">*</span> <span class="dv">2</span>)</span>
<span id="cb5-48"><a href="#cb5-48" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb5-49"><a href="#cb5-49" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-50"><a href="#cb5-50" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> np.array([<span class="dv">1</span>] <span class="op">*</span> <span class="dv">3</span>)</span>
<span id="cb5-51"><a href="#cb5-51" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> weights3 <span class="op">/</span> weights3.<span class="bu">sum</span>()</span>
<span id="cb5-52"><a href="#cb5-52" aria-hidden="true" tabindex="-1"></a>indices3 <span class="op">=</span> np.array([<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-53"><a href="#cb5-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-54"><a href="#cb5-54" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-55"><a href="#cb5-55" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-56"><a href="#cb5-56" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb5-57"><a href="#cb5-57" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb5-58"><a href="#cb5-58" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-59"><a href="#cb5-59" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-60"><a href="#cb5-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-61"><a href="#cb5-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-62"><a href="#cb5-62" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-63"><a href="#cb5-63" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-64"><a href="#cb5-64" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-65"><a href="#cb5-65" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-66"><a href="#cb5-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-67"><a href="#cb5-67" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>])</span>
<span id="cb5-68"><a href="#cb5-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-69"><a href="#cb5-69" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], [<span class="dv">0</span>])</span>
<span id="cb5-70"><a href="#cb5-70" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-71"><a href="#cb5-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-72"><a href="#cb5-72" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-73"><a href="#cb5-73" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-74"><a href="#cb5-74" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-75"><a href="#cb5-75" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-76"><a href="#cb5-76" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-77"><a href="#cb5-77" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-78"><a href="#cb5-78" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-79"><a href="#cb5-79" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-80"><a href="#cb5-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-81"><a href="#cb5-81" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">2</span>)</span>
<span id="cb5-82"><a href="#cb5-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-83"><a href="#cb5-83" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-84"><a href="#cb5-84" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-85"><a href="#cb5-85" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-86"><a href="#cb5-86" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-87"><a href="#cb5-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-88"><a href="#cb5-88" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb5-89"><a href="#cb5-89" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-90"><a href="#cb5-90" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb5-91"><a href="#cb5-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-92"><a href="#cb5-92" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb5-93"><a href="#cb5-93" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb5-94"><a href="#cb5-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-95"><a href="#cb5-95" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-96"><a href="#cb5-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-97"><a href="#cb5-97" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-98"><a href="#cb5-98" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-99"><a href="#cb5-99" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-100"><a href="#cb5-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-101"><a href="#cb5-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-102"><a href="#cb5-102" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-103"><a href="#cb5-103" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb5-104"><a href="#cb5-104" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-105"><a href="#cb5-105" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-106"><a href="#cb5-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-107"><a href="#cb5-107" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-108"><a href="#cb5-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-109"><a href="#cb5-109" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-110"><a href="#cb5-110" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-111"><a href="#cb5-111" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-112"><a href="#cb5-112" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-113"><a href="#cb5-113" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb5-114"><a href="#cb5-114" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-115"><a href="#cb5-115" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-116"><a href="#cb5-116" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-117"><a href="#cb5-117" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-118"><a href="#cb5-118" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-119"><a href="#cb5-119" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-120"><a href="#cb5-120" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-121"><a href="#cb5-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-122"><a href="#cb5-122" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb5-123"><a href="#cb5-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-124"><a href="#cb5-124" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weightsData[<span class="dv">2</span>][<span class="dv">0</span>])</span>
<span id="cb5-125"><a href="#cb5-125" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], weightsData[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb5-126"><a href="#cb5-126" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">4</span>][<span class="dv">0</span>])</span>
<span id="cb5-127"><a href="#cb5-127" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">4</span>][<span class="dv">1</span>])</span>
<span id="cb5-128"><a href="#cb5-128" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">5</span>][<span class="dv">0</span>])</span>
<span id="cb5-129"><a href="#cb5-129" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">5</span>][<span class="dv">1</span>])</span>
<span id="cb5-130"><a href="#cb5-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-131"><a href="#cb5-131" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">6</span> <span class="op">/</span> <span class="dv">6</span>] <span class="op">+</span> [<span class="dv">4</span> <span class="op">/</span> <span class="dv">5</span>]<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb5-132"><a href="#cb5-132" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb5-133"><a href="#cb5-133" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-134"><a href="#cb5-134" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">4</span> <span class="op">/</span> <span class="dv">5</span>] <span class="op">+</span> [<span class="dv">4</span> <span class="op">/</span> <span class="dv">4</span>]<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb5-135"><a href="#cb5-135" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb5-136"><a href="#cb5-136" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-137"><a href="#cb5-137" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> np.array([<span class="dv">1</span>] <span class="op">*</span> <span class="dv">3</span>)</span>
<span id="cb5-138"><a href="#cb5-138" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> weights3 <span class="op">/</span> weights3.<span class="bu">sum</span>()</span>
<span id="cb5-139"><a href="#cb5-139" aria-hidden="true" tabindex="-1"></a>indices3 <span class="op">=</span> np.array([<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-140"><a href="#cb5-140" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-141"><a href="#cb5-141" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-142"><a href="#cb5-142" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-143"><a href="#cb5-143" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb5-144"><a href="#cb5-144" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb5-145"><a href="#cb5-145" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-146"><a href="#cb5-146" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-147"><a href="#cb5-147" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-148"><a href="#cb5-148" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-149"><a href="#cb5-149" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-150"><a href="#cb5-150" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-151"><a href="#cb5-151" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-152"><a href="#cb5-152" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-153"><a href="#cb5-153" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-154"><a href="#cb5-154" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>])</span>
<span id="cb5-155"><a href="#cb5-155" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-156"><a href="#cb5-156" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-157"><a href="#cb5-157" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-158"><a href="#cb5-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-159"><a href="#cb5-159" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-160"><a href="#cb5-160" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-161"><a href="#cb5-161" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-162"><a href="#cb5-162" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-163"><a href="#cb5-163" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-164"><a href="#cb5-164" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-165"><a href="#cb5-165" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-166"><a href="#cb5-166" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-167"><a href="#cb5-167" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-168"><a href="#cb5-168" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">2</span>)</span>
<span id="cb5-169"><a href="#cb5-169" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-170"><a href="#cb5-170" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-171"><a href="#cb5-171" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-172"><a href="#cb5-172" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-173"><a href="#cb5-173" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-174"><a href="#cb5-174" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-175"><a href="#cb5-175" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb5-176"><a href="#cb5-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-177"><a href="#cb5-177" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb5-178"><a href="#cb5-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-179"><a href="#cb5-179" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb5-180"><a href="#cb5-180" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb5-181"><a href="#cb5-181" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-182"><a href="#cb5-182" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-183"><a href="#cb5-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-184"><a href="#cb5-184" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-185"><a href="#cb5-185" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-186"><a href="#cb5-186" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-187"><a href="#cb5-187" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-188"><a href="#cb5-188" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-189"><a href="#cb5-189" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-190"><a href="#cb5-190" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb5-191"><a href="#cb5-191" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-192"><a href="#cb5-192" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-193"><a href="#cb5-193" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-194"><a href="#cb5-194" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-195"><a href="#cb5-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-196"><a href="#cb5-196" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-197"><a href="#cb5-197" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-198"><a href="#cb5-198" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-199"><a href="#cb5-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-200"><a href="#cb5-200" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb5-201"><a href="#cb5-201" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-202"><a href="#cb5-202" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-203"><a href="#cb5-203" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-204"><a href="#cb5-204" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-205"><a href="#cb5-205" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-206"><a href="#cb5-206" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-207"><a href="#cb5-207" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-208"><a href="#cb5-208" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-209"><a href="#cb5-209" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb5-210"><a href="#cb5-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-211"><a href="#cb5-211" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weightsData[<span class="dv">2</span>][<span class="dv">0</span>])</span>
<span id="cb5-212"><a href="#cb5-212" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], weightsData[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb5-213"><a href="#cb5-213" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">4</span>][<span class="dv">0</span>])</span>
<span id="cb5-214"><a href="#cb5-214" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">4</span>][<span class="dv">1</span>])</span>
<span id="cb5-215"><a href="#cb5-215" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">5</span>][<span class="dv">0</span>])</span>
<span id="cb5-216"><a href="#cb5-216" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">5</span>][<span class="dv">1</span>])</span>
<span id="cb5-217"><a href="#cb5-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-218"><a href="#cb5-218" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">6</span> <span class="op">/</span> <span class="dv">6</span>] <span class="op">+</span> [<span class="dv">4</span> <span class="op">/</span> <span class="dv">8</span>]<span class="op">*</span><span class="dv">2</span>)</span>
<span id="cb5-219"><a href="#cb5-219" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb5-220"><a href="#cb5-220" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-221"><a href="#cb5-221" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">4</span> <span class="op">/</span> <span class="dv">8</span>] <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">6</span> <span class="op">/</span> <span class="dv">8</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-222"><a href="#cb5-222" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb5-223"><a href="#cb5-223" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-224"><a href="#cb5-224" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> np.array([<span class="dv">6</span> <span class="op">/</span> <span class="dv">8</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">6</span> <span class="op">/</span> <span class="dv">6</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-225"><a href="#cb5-225" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> weights3 <span class="op">/</span> weights3.<span class="bu">sum</span>()</span>
<span id="cb5-226"><a href="#cb5-226" aria-hidden="true" tabindex="-1"></a>indices3 <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-227"><a href="#cb5-227" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-228"><a href="#cb5-228" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-229"><a href="#cb5-229" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-230"><a href="#cb5-230" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb5-231"><a href="#cb5-231" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb5-232"><a href="#cb5-232" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-233"><a href="#cb5-233" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-234"><a href="#cb5-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-235"><a href="#cb5-235" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-236"><a href="#cb5-236" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-237"><a href="#cb5-237" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-238"><a href="#cb5-238" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-239"><a href="#cb5-239" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-240"><a href="#cb5-240" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-241"><a href="#cb5-241" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>])</span>
<span id="cb5-242"><a href="#cb5-242" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-243"><a href="#cb5-243" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb5-244"><a href="#cb5-244" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-245"><a href="#cb5-245" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-246"><a href="#cb5-246" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-247"><a href="#cb5-247" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-248"><a href="#cb5-248" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-249"><a href="#cb5-249" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-250"><a href="#cb5-250" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-251"><a href="#cb5-251" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-252"><a href="#cb5-252" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-253"><a href="#cb5-253" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-254"><a href="#cb5-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-255"><a href="#cb5-255" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">2</span>)</span>
<span id="cb5-256"><a href="#cb5-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-257"><a href="#cb5-257" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-258"><a href="#cb5-258" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-259"><a href="#cb5-259" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-260"><a href="#cb5-260" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-261"><a href="#cb5-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-262"><a href="#cb5-262" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb5-263"><a href="#cb5-263" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-264"><a href="#cb5-264" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb5-265"><a href="#cb5-265" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-266"><a href="#cb5-266" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb5-267"><a href="#cb5-267" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb5-268"><a href="#cb5-268" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-269"><a href="#cb5-269" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-270"><a href="#cb5-270" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-271"><a href="#cb5-271" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-272"><a href="#cb5-272" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-273"><a href="#cb5-273" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-274"><a href="#cb5-274" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-275"><a href="#cb5-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-276"><a href="#cb5-276" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-277"><a href="#cb5-277" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb5-278"><a href="#cb5-278" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-279"><a href="#cb5-279" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-280"><a href="#cb5-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-281"><a href="#cb5-281" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-282"><a href="#cb5-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-283"><a href="#cb5-283" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-284"><a href="#cb5-284" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-285"><a href="#cb5-285" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-286"><a href="#cb5-286" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-287"><a href="#cb5-287" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb5-288"><a href="#cb5-288" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-289"><a href="#cb5-289" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-290"><a href="#cb5-290" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-291"><a href="#cb5-291" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-292"><a href="#cb5-292" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-293"><a href="#cb5-293" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-294"><a href="#cb5-294" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-295"><a href="#cb5-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-296"><a href="#cb5-296" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb5-297"><a href="#cb5-297" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-298"><a href="#cb5-298" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weightsData[<span class="dv">2</span>][<span class="dv">0</span>])</span>
<span id="cb5-299"><a href="#cb5-299" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], weightsData[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb5-300"><a href="#cb5-300" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">4</span>][<span class="dv">0</span>])</span>
<span id="cb5-301"><a href="#cb5-301" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">4</span>][<span class="dv">1</span>])</span>
<span id="cb5-302"><a href="#cb5-302" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">5</span>][<span class="dv">0</span>])</span>
<span id="cb5-303"><a href="#cb5-303" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">5</span>][<span class="dv">1</span>])</span>
<span id="cb5-304"><a href="#cb5-304" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-305"><a href="#cb5-305" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">12</span><span class="op">/</span><span class="dv">12</span>] <span class="op">+</span> [<span class="dv">10</span><span class="op">/</span><span class="dv">11</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">10</span><span class="op">/</span><span class="dv">11</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-306"><a href="#cb5-306" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb5-307"><a href="#cb5-307" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-308"><a href="#cb5-308" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">11</span>] <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-309"><a href="#cb5-309" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb5-310"><a href="#cb5-310" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-311"><a href="#cb5-311" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">11</span>] <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-312"><a href="#cb5-312" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> weights3 <span class="op">/</span> weights3.<span class="bu">sum</span>()</span>
<span id="cb5-313"><a href="#cb5-313" aria-hidden="true" tabindex="-1"></a>indices3 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-314"><a href="#cb5-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-315"><a href="#cb5-315" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-316"><a href="#cb5-316" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-317"><a href="#cb5-317" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb5-318"><a href="#cb5-318" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb5-319"><a href="#cb5-319" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-320"><a href="#cb5-320" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-321"><a href="#cb5-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-322"><a href="#cb5-322" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-323"><a href="#cb5-323" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-324"><a href="#cb5-324" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-325"><a href="#cb5-325" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-326"><a href="#cb5-326" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-327"><a href="#cb5-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-328"><a href="#cb5-328" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>])</span>
<span id="cb5-329"><a href="#cb5-329" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-330"><a href="#cb5-330" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-331"><a href="#cb5-331" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-332"><a href="#cb5-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-333"><a href="#cb5-333" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-334"><a href="#cb5-334" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-335"><a href="#cb5-335" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-336"><a href="#cb5-336" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-337"><a href="#cb5-337" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-338"><a href="#cb5-338" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-339"><a href="#cb5-339" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-340"><a href="#cb5-340" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-341"><a href="#cb5-341" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-342"><a href="#cb5-342" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">2</span>)</span>
<span id="cb5-343"><a href="#cb5-343" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-344"><a href="#cb5-344" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-345"><a href="#cb5-345" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-346"><a href="#cb5-346" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-347"><a href="#cb5-347" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-348"><a href="#cb5-348" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-349"><a href="#cb5-349" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb5-350"><a href="#cb5-350" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-351"><a href="#cb5-351" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb5-352"><a href="#cb5-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-353"><a href="#cb5-353" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb5-354"><a href="#cb5-354" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb5-355"><a href="#cb5-355" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-356"><a href="#cb5-356" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-357"><a href="#cb5-357" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-358"><a href="#cb5-358" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-359"><a href="#cb5-359" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-360"><a href="#cb5-360" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-361"><a href="#cb5-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-362"><a href="#cb5-362" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-363"><a href="#cb5-363" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-364"><a href="#cb5-364" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb5-365"><a href="#cb5-365" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-366"><a href="#cb5-366" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-367"><a href="#cb5-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-368"><a href="#cb5-368" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-369"><a href="#cb5-369" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-370"><a href="#cb5-370" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-371"><a href="#cb5-371" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-372"><a href="#cb5-372" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-373"><a href="#cb5-373" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-374"><a href="#cb5-374" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb5-375"><a href="#cb5-375" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-376"><a href="#cb5-376" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-377"><a href="#cb5-377" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-378"><a href="#cb5-378" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-379"><a href="#cb5-379" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-380"><a href="#cb5-380" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-381"><a href="#cb5-381" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-382"><a href="#cb5-382" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-383"><a href="#cb5-383" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb5-384"><a href="#cb5-384" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-385"><a href="#cb5-385" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weightsData[<span class="dv">2</span>][<span class="dv">0</span>])</span>
<span id="cb5-386"><a href="#cb5-386" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], weightsData[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb5-387"><a href="#cb5-387" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">4</span>][<span class="dv">0</span>])</span>
<span id="cb5-388"><a href="#cb5-388" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">4</span>][<span class="dv">1</span>])</span>
<span id="cb5-389"><a href="#cb5-389" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">5</span>][<span class="dv">0</span>])</span>
<span id="cb5-390"><a href="#cb5-390" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">5</span>][<span class="dv">1</span>])</span>
<span id="cb5-391"><a href="#cb5-391" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-392"><a href="#cb5-392" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">12</span><span class="op">/</span><span class="dv">12</span>] <span class="op">+</span> [<span class="dv">10</span><span class="op">/</span><span class="dv">11</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">10</span><span class="op">/</span><span class="dv">11</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-393"><a href="#cb5-393" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb5-394"><a href="#cb5-394" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-395"><a href="#cb5-395" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">11</span>] <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-396"><a href="#cb5-396" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb5-397"><a href="#cb5-397" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-398"><a href="#cb5-398" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> np.array([<span class="dv">10</span> <span class="op">/</span> <span class="dv">11</span>] <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">10</span> <span class="op">/</span> <span class="dv">10</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-399"><a href="#cb5-399" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> weights3 <span class="op">/</span> weights3.<span class="bu">sum</span>()</span>
<span id="cb5-400"><a href="#cb5-400" aria-hidden="true" tabindex="-1"></a>indices3 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-401"><a href="#cb5-401" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-402"><a href="#cb5-402" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-403"><a href="#cb5-403" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-404"><a href="#cb5-404" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb5-405"><a href="#cb5-405" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb5-406"><a href="#cb5-406" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-407"><a href="#cb5-407" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-408"><a href="#cb5-408" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-409"><a href="#cb5-409" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-410"><a href="#cb5-410" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-411"><a href="#cb5-411" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-412"><a href="#cb5-412" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-413"><a href="#cb5-413" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-414"><a href="#cb5-414" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>])</span>
<span id="cb5-415"><a href="#cb5-415" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-416"><a href="#cb5-416" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-417"><a href="#cb5-417" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>],  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-418"><a href="#cb5-418" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-419"><a href="#cb5-419" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-420"><a href="#cb5-420" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-421"><a href="#cb5-421" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-422"><a href="#cb5-422" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-423"><a href="#cb5-423" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-424"><a href="#cb5-424" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-425"><a href="#cb5-425" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-426"><a href="#cb5-426" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-427"><a href="#cb5-427" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-428"><a href="#cb5-428" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">2</span>)</span>
<span id="cb5-429"><a href="#cb5-429" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-430"><a href="#cb5-430" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-431"><a href="#cb5-431" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-432"><a href="#cb5-432" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-433"><a href="#cb5-433" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-434"><a href="#cb5-434" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-435"><a href="#cb5-435" aria-hidden="true" tabindex="-1"></a><span class="co">#-----------------------------------------------------------</span></span>
<span id="cb5-436"><a href="#cb5-436" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-437"><a href="#cb5-437" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb5-438"><a href="#cb5-438" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-439"><a href="#cb5-439" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain, neighborsRemoved, neighborsAdded <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb5-440"><a href="#cb5-440" aria-hidden="true" tabindex="-1"></a>                                                                                   yPred <span class="op">=</span> yPred)</span>
<span id="cb5-441"><a href="#cb5-441" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-442"><a href="#cb5-442" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-443"><a href="#cb5-443" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-444"><a href="#cb5-444" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-445"><a href="#cb5-445" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-446"><a href="#cb5-446" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-447"><a href="#cb5-447" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-448"><a href="#cb5-448" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-449"><a href="#cb5-449" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-450"><a href="#cb5-450" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb5-451"><a href="#cb5-451" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-452"><a href="#cb5-452" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-453"><a href="#cb5-453" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-454"><a href="#cb5-454" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">2</span>, <span class="dv">3</span>])</span>
<span id="cb5-455"><a href="#cb5-455" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-456"><a href="#cb5-456" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-457"><a href="#cb5-457" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-458"><a href="#cb5-458" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-459"><a href="#cb5-459" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-460"><a href="#cb5-460" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> yPred,</span>
<span id="cb5-461"><a href="#cb5-461" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-462"><a href="#cb5-462" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-463"><a href="#cb5-463" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-464"><a href="#cb5-464" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-465"><a href="#cb5-465" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-466"><a href="#cb5-466" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-467"><a href="#cb5-467" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-468"><a href="#cb5-468" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-469"><a href="#cb5-469" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(yPred))</span>
<span id="cb5-470"><a href="#cb5-470" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-471"><a href="#cb5-471" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weightsData[<span class="dv">2</span>][<span class="dv">0</span>])</span>
<span id="cb5-472"><a href="#cb5-472" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], weightsData[<span class="dv">2</span>][<span class="dv">1</span>])</span>
<span id="cb5-473"><a href="#cb5-473" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">4</span>][<span class="dv">0</span>])</span>
<span id="cb5-474"><a href="#cb5-474" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">4</span>][<span class="dv">1</span>])</span>
<span id="cb5-475"><a href="#cb5-475" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weightsData[<span class="dv">5</span>][<span class="dv">0</span>])</span>
<span id="cb5-476"><a href="#cb5-476" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], weightsData[<span class="dv">5</span>][<span class="dv">1</span>])</span>
<span id="cb5-477"><a href="#cb5-477" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-478"><a href="#cb5-478" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> np.array([<span class="dv">1</span>] <span class="op">+</span> [<span class="dv">1</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">1</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-479"><a href="#cb5-479" aria-hidden="true" tabindex="-1"></a>weights1 <span class="op">=</span> weights1 <span class="op">/</span> weights1.<span class="bu">sum</span>()</span>
<span id="cb5-480"><a href="#cb5-480" aria-hidden="true" tabindex="-1"></a>indices1 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-481"><a href="#cb5-481" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> np.array([<span class="dv">1</span>] <span class="op">+</span> [<span class="dv">1</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">1</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-482"><a href="#cb5-482" aria-hidden="true" tabindex="-1"></a>weights2 <span class="op">=</span> weights2 <span class="op">/</span> weights2.<span class="bu">sum</span>()</span>
<span id="cb5-483"><a href="#cb5-483" aria-hidden="true" tabindex="-1"></a>indices2 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-484"><a href="#cb5-484" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> np.array([<span class="dv">1</span>] <span class="op">+</span> [<span class="dv">1</span>]<span class="op">*</span><span class="dv">2</span> <span class="op">+</span> [<span class="dv">1</span>]<span class="op">*</span><span class="dv">3</span>)</span>
<span id="cb5-485"><a href="#cb5-485" aria-hidden="true" tabindex="-1"></a>weights3 <span class="op">=</span> weights3 <span class="op">/</span> weights3.<span class="bu">sum</span>()</span>
<span id="cb5-486"><a href="#cb5-486" aria-hidden="true" tabindex="-1"></a>indices3 <span class="op">=</span> np.arange(<span class="dv">6</span>)</span>
<span id="cb5-487"><a href="#cb5-487" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-488"><a href="#cb5-488" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-489"><a href="#cb5-489" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-490"><a href="#cb5-490" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights2)</span>
<span id="cb5-491"><a href="#cb5-491" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices2)</span>
<span id="cb5-492"><a href="#cb5-492" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-493"><a href="#cb5-493" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">3</span>][<span class="dv">1</span>], indices3)</span>
<span id="cb5-494"><a href="#cb5-494" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-495"><a href="#cb5-495" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-496"><a href="#cb5-496" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb5-497"><a href="#cb5-497" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-498"><a href="#cb5-498" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-499"><a href="#cb5-499" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb5-500"><a href="#cb5-500" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-501"><a href="#cb5-501" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>])</span>
<span id="cb5-502"><a href="#cb5-502" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-503"><a href="#cb5-503" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="op">-</span><span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-504"><a href="#cb5-504" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb5-505"><a href="#cb5-505" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-506"><a href="#cb5-506" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> getKernelValues(yPred <span class="op">=</span> np.array([<span class="op">-</span><span class="dv">1</span>, <span class="dv">4</span>]),</span>
<span id="cb5-507"><a href="#cb5-507" aria-hidden="true" tabindex="-1"></a>                              yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb5-508"><a href="#cb5-508" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTest <span class="op">=</span> neighborsDictTest,</span>
<span id="cb5-509"><a href="#cb5-509" aria-hidden="true" tabindex="-1"></a>                              neighborsDictTrain <span class="op">=</span> neighborsDictTrain,</span>
<span id="cb5-510"><a href="#cb5-510" aria-hidden="true" tabindex="-1"></a>                              neighborsRemoved <span class="op">=</span> neighborsRemoved,</span>
<span id="cb5-511"><a href="#cb5-511" aria-hidden="true" tabindex="-1"></a>                              neighborsAdded <span class="op">=</span> neighborsAdded,</span>
<span id="cb5-512"><a href="#cb5-512" aria-hidden="true" tabindex="-1"></a>                              binSize <span class="op">=</span> binSize,</span>
<span id="cb5-513"><a href="#cb5-513" aria-hidden="true" tabindex="-1"></a>                              efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb5-514"><a href="#cb5-514" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-515"><a href="#cb5-515" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">2</span>)</span>
<span id="cb5-516"><a href="#cb5-516" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb5-517"><a href="#cb5-517" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], weights1)</span>
<span id="cb5-518"><a href="#cb5-518" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], indices1)</span>
<span id="cb5-519"><a href="#cb5-519" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">0</span>], weights3)</span>
<span id="cb5-520"><a href="#cb5-520" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">1</span>][<span class="dv">1</span>], indices3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB
After Kernel Values: Memory used by Jupyter notebook: 194.71 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.array([<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>, <span class="dv">4</span>])</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>])</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-12"><a href="#cb7-12" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-13"><a href="#cb7-13" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-14"><a href="#cb7-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-15"><a href="#cb7-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-16"><a href="#cb7-16" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-17"><a href="#cb7-17" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-18"><a href="#cb7-18" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-19"><a href="#cb7-19" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-20"><a href="#cb7-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-22"><a href="#cb7-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-23"><a href="#cb7-23" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>])</span>
<span id="cb7-24"><a href="#cb7-24" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-25"><a href="#cb7-25" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-26"><a href="#cb7-26" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-27"><a href="#cb7-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-28"><a href="#cb7-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-29"><a href="#cb7-29" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-30"><a href="#cb7-30" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-31"><a href="#cb7-31" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-32"><a href="#cb7-32" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-33"><a href="#cb7-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-34"><a href="#cb7-34" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-35"><a href="#cb7-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-36"><a href="#cb7-36" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>])</span>
<span id="cb7-37"><a href="#cb7-37" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-38"><a href="#cb7-38" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-39"><a href="#cb7-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-40"><a href="#cb7-40" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-41"><a href="#cb7-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb7-43"><a href="#cb7-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-44"><a href="#cb7-44" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-45"><a href="#cb7-45" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-46"><a href="#cb7-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-47"><a href="#cb7-47" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-48"><a href="#cb7-48" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-49"><a href="#cb7-49" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-50"><a href="#cb7-50" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-51"><a href="#cb7-51" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-52"><a href="#cb7-52" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-53"><a href="#cb7-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-54"><a href="#cb7-54" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-55"><a href="#cb7-55" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-56"><a href="#cb7-56" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-57"><a href="#cb7-57" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-58"><a href="#cb7-58" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-59"><a href="#cb7-59" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-60"><a href="#cb7-60" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-61"><a href="#cb7-61" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-62"><a href="#cb7-62" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-63"><a href="#cb7-63" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-64"><a href="#cb7-64" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-65"><a href="#cb7-65" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-66"><a href="#cb7-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-67"><a href="#cb7-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-68"><a href="#cb7-68" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-69"><a href="#cb7-69" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-70"><a href="#cb7-70" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-71"><a href="#cb7-71" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-72"><a href="#cb7-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-73"><a href="#cb7-73" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-74"><a href="#cb7-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-75"><a href="#cb7-75" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-76"><a href="#cb7-76" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-77"><a href="#cb7-77" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-78"><a href="#cb7-78" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-79"><a href="#cb7-79" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-80"><a href="#cb7-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-81"><a href="#cb7-81" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">3</span></span>
<span id="cb7-82"><a href="#cb7-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-83"><a href="#cb7-83" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-84"><a href="#cb7-84" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-85"><a href="#cb7-85" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-86"><a href="#cb7-86" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-87"><a href="#cb7-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-88"><a href="#cb7-88" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-89"><a href="#cb7-89" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-90"><a href="#cb7-90" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-91"><a href="#cb7-91" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-92"><a href="#cb7-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-93"><a href="#cb7-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-94"><a href="#cb7-94" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-95"><a href="#cb7-95" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-96"><a href="#cb7-96" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-97"><a href="#cb7-97" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-98"><a href="#cb7-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-99"><a href="#cb7-99" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-100"><a href="#cb7-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-101"><a href="#cb7-101" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-102"><a href="#cb7-102" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-103"><a href="#cb7-103" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-104"><a href="#cb7-104" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-105"><a href="#cb7-105" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-106"><a href="#cb7-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-107"><a href="#cb7-107" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-108"><a href="#cb7-108" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-109"><a href="#cb7-109" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-110"><a href="#cb7-110" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-111"><a href="#cb7-111" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-112"><a href="#cb7-112" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-113"><a href="#cb7-113" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-114"><a href="#cb7-114" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>])</span>
<span id="cb7-115"><a href="#cb7-115" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-116"><a href="#cb7-116" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-117"><a href="#cb7-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-118"><a href="#cb7-118" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-119"><a href="#cb7-119" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-120"><a href="#cb7-120" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb7-121"><a href="#cb7-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-122"><a href="#cb7-122" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-123"><a href="#cb7-123" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-124"><a href="#cb7-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-125"><a href="#cb7-125" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-126"><a href="#cb7-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-127"><a href="#cb7-127" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-128"><a href="#cb7-128" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-129"><a href="#cb7-129" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-130"><a href="#cb7-130" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-131"><a href="#cb7-131" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-132"><a href="#cb7-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-133"><a href="#cb7-133" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-134"><a href="#cb7-134" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-135"><a href="#cb7-135" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-136"><a href="#cb7-136" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-137"><a href="#cb7-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-138"><a href="#cb7-138" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-139"><a href="#cb7-139" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-140"><a href="#cb7-140" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-141"><a href="#cb7-141" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-142"><a href="#cb7-142" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-143"><a href="#cb7-143" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-144"><a href="#cb7-144" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-145"><a href="#cb7-145" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-146"><a href="#cb7-146" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-147"><a href="#cb7-147" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-148"><a href="#cb7-148" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-149"><a href="#cb7-149" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-150"><a href="#cb7-150" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-151"><a href="#cb7-151" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-152"><a href="#cb7-152" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-153"><a href="#cb7-153" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-154"><a href="#cb7-154" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-155"><a href="#cb7-155" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-156"><a href="#cb7-156" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-157"><a href="#cb7-157" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-158"><a href="#cb7-158" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-159"><a href="#cb7-159" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">5</span></span>
<span id="cb7-160"><a href="#cb7-160" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-161"><a href="#cb7-161" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-162"><a href="#cb7-162" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-163"><a href="#cb7-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-164"><a href="#cb7-164" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-165"><a href="#cb7-165" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-166"><a href="#cb7-166" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-167"><a href="#cb7-167" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-168"><a href="#cb7-168" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-169"><a href="#cb7-169" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-170"><a href="#cb7-170" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-171"><a href="#cb7-171" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-172"><a href="#cb7-172" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-173"><a href="#cb7-173" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-174"><a href="#cb7-174" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-175"><a href="#cb7-175" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-176"><a href="#cb7-176" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-177"><a href="#cb7-177" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-178"><a href="#cb7-178" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-179"><a href="#cb7-179" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-180"><a href="#cb7-180" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-181"><a href="#cb7-181" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-182"><a href="#cb7-182" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-183"><a href="#cb7-183" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-184"><a href="#cb7-184" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-185"><a href="#cb7-185" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-186"><a href="#cb7-186" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-187"><a href="#cb7-187" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-188"><a href="#cb7-188" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-189"><a href="#cb7-189" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-190"><a href="#cb7-190" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-191"><a href="#cb7-191" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-192"><a href="#cb7-192" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-193"><a href="#cb7-193" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-194"><a href="#cb7-194" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-195"><a href="#cb7-195" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-196"><a href="#cb7-196" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-197"><a href="#cb7-197" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-198"><a href="#cb7-198" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">6</span></span>
<span id="cb7-199"><a href="#cb7-199" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-200"><a href="#cb7-200" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-201"><a href="#cb7-201" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-202"><a href="#cb7-202" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-203"><a href="#cb7-203" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-204"><a href="#cb7-204" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-205"><a href="#cb7-205" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-206"><a href="#cb7-206" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-207"><a href="#cb7-207" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-208"><a href="#cb7-208" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-209"><a href="#cb7-209" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-210"><a href="#cb7-210" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-211"><a href="#cb7-211" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-212"><a href="#cb7-212" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-213"><a href="#cb7-213" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-214"><a href="#cb7-214" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-215"><a href="#cb7-215" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-216"><a href="#cb7-216" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-217"><a href="#cb7-217" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-218"><a href="#cb7-218" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-219"><a href="#cb7-219" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-220"><a href="#cb7-220" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-221"><a href="#cb7-221" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-222"><a href="#cb7-222" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-223"><a href="#cb7-223" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-224"><a href="#cb7-224" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-225"><a href="#cb7-225" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-226"><a href="#cb7-226" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-227"><a href="#cb7-227" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-228"><a href="#cb7-228" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-229"><a href="#cb7-229" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-230"><a href="#cb7-230" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-231"><a href="#cb7-231" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>])</span>
<span id="cb7-232"><a href="#cb7-232" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-233"><a href="#cb7-233" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-234"><a href="#cb7-234" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-235"><a href="#cb7-235" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-236"><a href="#cb7-236" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-237"><a href="#cb7-237" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb7-238"><a href="#cb7-238" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-239"><a href="#cb7-239" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-240"><a href="#cb7-240" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-241"><a href="#cb7-241" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-242"><a href="#cb7-242" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-243"><a href="#cb7-243" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-244"><a href="#cb7-244" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-245"><a href="#cb7-245" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-246"><a href="#cb7-246" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-247"><a href="#cb7-247" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-248"><a href="#cb7-248" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-249"><a href="#cb7-249" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-250"><a href="#cb7-250" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-251"><a href="#cb7-251" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-252"><a href="#cb7-252" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-253"><a href="#cb7-253" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-254"><a href="#cb7-254" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-255"><a href="#cb7-255" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-256"><a href="#cb7-256" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-257"><a href="#cb7-257" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-258"><a href="#cb7-258" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-259"><a href="#cb7-259" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-260"><a href="#cb7-260" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-261"><a href="#cb7-261" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-262"><a href="#cb7-262" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-263"><a href="#cb7-263" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-264"><a href="#cb7-264" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-265"><a href="#cb7-265" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-266"><a href="#cb7-266" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-267"><a href="#cb7-267" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-268"><a href="#cb7-268" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-269"><a href="#cb7-269" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-270"><a href="#cb7-270" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-271"><a href="#cb7-271" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-272"><a href="#cb7-272" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-273"><a href="#cb7-273" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-274"><a href="#cb7-274" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-275"><a href="#cb7-275" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-276"><a href="#cb7-276" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">8</span></span>
<span id="cb7-277"><a href="#cb7-277" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-278"><a href="#cb7-278" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-279"><a href="#cb7-279" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-280"><a href="#cb7-280" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-281"><a href="#cb7-281" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-282"><a href="#cb7-282" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-283"><a href="#cb7-283" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-284"><a href="#cb7-284" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-285"><a href="#cb7-285" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-286"><a href="#cb7-286" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-287"><a href="#cb7-287" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-288"><a href="#cb7-288" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-289"><a href="#cb7-289" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-290"><a href="#cb7-290" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-291"><a href="#cb7-291" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-292"><a href="#cb7-292" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-293"><a href="#cb7-293" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-294"><a href="#cb7-294" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-295"><a href="#cb7-295" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-296"><a href="#cb7-296" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-297"><a href="#cb7-297" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-298"><a href="#cb7-298" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-299"><a href="#cb7-299" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-300"><a href="#cb7-300" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-301"><a href="#cb7-301" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-302"><a href="#cb7-302" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-303"><a href="#cb7-303" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-304"><a href="#cb7-304" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-305"><a href="#cb7-305" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-306"><a href="#cb7-306" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-307"><a href="#cb7-307" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-308"><a href="#cb7-308" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-309"><a href="#cb7-309" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-310"><a href="#cb7-310" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-311"><a href="#cb7-311" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-312"><a href="#cb7-312" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-313"><a href="#cb7-313" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-314"><a href="#cb7-314" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-315"><a href="#cb7-315" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">9</span></span>
<span id="cb7-316"><a href="#cb7-316" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-317"><a href="#cb7-317" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-318"><a href="#cb7-318" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-319"><a href="#cb7-319" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-320"><a href="#cb7-320" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-321"><a href="#cb7-321" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-322"><a href="#cb7-322" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-323"><a href="#cb7-323" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-324"><a href="#cb7-324" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-325"><a href="#cb7-325" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-326"><a href="#cb7-326" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-327"><a href="#cb7-327" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-328"><a href="#cb7-328" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-329"><a href="#cb7-329" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-330"><a href="#cb7-330" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-331"><a href="#cb7-331" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-332"><a href="#cb7-332" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-333"><a href="#cb7-333" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-334"><a href="#cb7-334" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-335"><a href="#cb7-335" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-336"><a href="#cb7-336" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-337"><a href="#cb7-337" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-338"><a href="#cb7-338" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-339"><a href="#cb7-339" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-340"><a href="#cb7-340" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-341"><a href="#cb7-341" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-342"><a href="#cb7-342" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-343"><a href="#cb7-343" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-344"><a href="#cb7-344" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-345"><a href="#cb7-345" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-346"><a href="#cb7-346" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-347"><a href="#cb7-347" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-348"><a href="#cb7-348" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-349"><a href="#cb7-349" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-350"><a href="#cb7-350" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-351"><a href="#cb7-351" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-352"><a href="#cb7-352" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-353"><a href="#cb7-353" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb7-354"><a href="#cb7-354" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-355"><a href="#cb7-355" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb7-356"><a href="#cb7-356" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-357"><a href="#cb7-357" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb7-358"><a href="#cb7-358" aria-hidden="true" tabindex="-1"></a>                                            yPred <span class="op">=</span> yPred)[<span class="dv">0</span>]</span>
<span id="cb7-359"><a href="#cb7-359" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-360"><a href="#cb7-360" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTrain.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-361"><a href="#cb7-361" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-362"><a href="#cb7-362" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-363"><a href="#cb7-363" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-364"><a href="#cb7-364" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">3</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-365"><a href="#cb7-365" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTrain[<span class="dv">4</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-366"><a href="#cb7-366" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-367"><a href="#cb7-367" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-368"><a href="#cb7-368" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-369"><a href="#cb7-369" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb7-370"><a href="#cb7-370" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-371"><a href="#cb7-371" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-372"><a href="#cb7-372" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-373"><a href="#cb7-373" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb7-374"><a href="#cb7-374" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-375"><a href="#cb7-375" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">1</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-376"><a href="#cb7-376" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">2</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-377"><a href="#cb7-377" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">3</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-378"><a href="#cb7-378" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">4</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-379"><a href="#cb7-379" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-380"><a href="#cb7-380" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-381"><a href="#cb7-381" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb7-382"><a href="#cb7-382" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> np.array([<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>]),</span>
<span id="cb7-383"><a href="#cb7-383" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPred,</span>
<span id="cb7-384"><a href="#cb7-384" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb7-385"><a href="#cb7-385" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-386"><a href="#cb7-386" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(neighborsDictTest.keys()), [<span class="dv">0</span>, <span class="dv">5</span>, <span class="dv">10</span>])</span>
<span id="cb7-387"><a href="#cb7-387" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb7-388"><a href="#cb7-388" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">0</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-389"><a href="#cb7-389" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">5</span>],  [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span>
<span id="cb7-390"><a href="#cb7-390" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest[<span class="dv">10</span>], [<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB
After Loop: Memory used by Jupyter notebook: 194.71 MB</code></pre>
</div>
</div>
</section>
<section id="neighbors-on-yaz" class="level3">
<h3 class="anchored" data-anchor-id="neighbors-on-yaz">Neighbors on Yaz</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neighborsByKNN(binSize,</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>                   yPred):</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>    yPred_reshaped <span class="op">=</span> np.reshape(yPred, newshape <span class="op">=</span> (<span class="bu">len</span>(yPred), <span class="dv">1</span>))</span>
<span id="cb9-5"><a href="#cb9-5" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-6"><a href="#cb9-6" aria-hidden="true" tabindex="-1"></a>    nn <span class="op">=</span> NearestNeighbors(algorithm <span class="op">=</span> <span class="st">'kd_tree'</span>)</span>
<span id="cb9-7"><a href="#cb9-7" aria-hidden="true" tabindex="-1"></a>    nn.fit(X <span class="op">=</span> yPred_reshaped)</span>
<span id="cb9-8"><a href="#cb9-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-9"><a href="#cb9-9" aria-hidden="true" tabindex="-1"></a>    distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPred_reshaped, </span>
<span id="cb9-10"><a href="#cb9-10" aria-hidden="true" tabindex="-1"></a>                                                     n_neighbors <span class="op">=</span> binSize <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb9-11"><a href="#cb9-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" aria-hidden="true" tabindex="-1"></a>    neighborsList <span class="op">=</span> <span class="bu">list</span>(neighborsMatrix[:, <span class="dv">0</span>:binSize])</span>
<span id="cb9-13"><a href="#cb9-13" aria-hidden="true" tabindex="-1"></a>    distanceCheck <span class="op">=</span> np.where(distancesMatrix[:, binSize <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> distancesMatrix[:, binSize])</span>
<span id="cb9-14"><a href="#cb9-14" aria-hidden="true" tabindex="-1"></a>    indicesToMod <span class="op">=</span> distanceCheck[<span class="dv">0</span>]</span>
<span id="cb9-15"><a href="#cb9-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-16"><a href="#cb9-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index <span class="kw">in</span> indicesToMod:</span>
<span id="cb9-17"><a href="#cb9-17" aria-hidden="true" tabindex="-1"></a>        distanceExtremePoint <span class="op">=</span> np.absolute(yPred[index] <span class="op">-</span> yPred[neighborsMatrix[index, binSize<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb9-18"><a href="#cb9-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-19"><a href="#cb9-19" aria-hidden="true" tabindex="-1"></a>        neighborsByRadius <span class="op">=</span> nn.radius_neighbors(X <span class="op">=</span> yPred_reshaped[index:index <span class="op">+</span> <span class="dv">1</span>], </span>
<span id="cb9-20"><a href="#cb9-20" aria-hidden="true" tabindex="-1"></a>                                                radius <span class="op">=</span> distanceExtremePoint, </span>
<span id="cb9-21"><a href="#cb9-21" aria-hidden="true" tabindex="-1"></a>                                                return_distance <span class="op">=</span> <span class="va">False</span>)[<span class="dv">0</span>]</span>
<span id="cb9-22"><a href="#cb9-22" aria-hidden="true" tabindex="-1"></a>        neighborsList[index] <span class="op">=</span> neighborsByRadius</span>
<span id="cb9-23"><a href="#cb9-23" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb9-24"><a href="#cb9-24" aria-hidden="true" tabindex="-1"></a>    neighborsPerPred <span class="op">=</span> {yPred[index]: neighborsList[index] <span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(yPred))}</span>
<span id="cb9-25"><a href="#cb9-25" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-26"><a href="#cb9-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> neighborsPerPred</span>
<span id="cb9-27"><a href="#cb9-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-28"><a href="#cb9-28" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb9-29"><a href="#cb9-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-30"><a href="#cb9-30" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> neighborsByKNNTest(binSize,</span>
<span id="cb9-31"><a href="#cb9-31" aria-hidden="true" tabindex="-1"></a>                       yPred,</span>
<span id="cb9-32"><a href="#cb9-32" aria-hidden="true" tabindex="-1"></a>                       yPredTrain):</span>
<span id="cb9-33"><a href="#cb9-33" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-34"><a href="#cb9-34" aria-hidden="true" tabindex="-1"></a>    yPredTrain_reshaped <span class="op">=</span> np.reshape(yPredTrain, newshape <span class="op">=</span> (<span class="bu">len</span>(yPredTrain), <span class="dv">1</span>))</span>
<span id="cb9-35"><a href="#cb9-35" aria-hidden="true" tabindex="-1"></a>    yPred_reshaped <span class="op">=</span> np.reshape(yPred, newshape <span class="op">=</span> (<span class="bu">len</span>(yPred), <span class="dv">1</span>))</span>
<span id="cb9-36"><a href="#cb9-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-37"><a href="#cb9-37" aria-hidden="true" tabindex="-1"></a>    nn <span class="op">=</span> NearestNeighbors(algorithm <span class="op">=</span> <span class="st">'kd_tree'</span>)</span>
<span id="cb9-38"><a href="#cb9-38" aria-hidden="true" tabindex="-1"></a>    nn.fit(X <span class="op">=</span> yPredTrain_reshaped)</span>
<span id="cb9-39"><a href="#cb9-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-40"><a href="#cb9-40" aria-hidden="true" tabindex="-1"></a>    distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPred_reshaped, </span>
<span id="cb9-41"><a href="#cb9-41" aria-hidden="true" tabindex="-1"></a>                                                     n_neighbors <span class="op">=</span> binSize <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb9-42"><a href="#cb9-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-43"><a href="#cb9-43" aria-hidden="true" tabindex="-1"></a>    neighborsList <span class="op">=</span> <span class="bu">list</span>(neighborsMatrix[:, <span class="dv">0</span>:binSize])</span>
<span id="cb9-44"><a href="#cb9-44" aria-hidden="true" tabindex="-1"></a>    distanceCheck <span class="op">=</span> np.where(distancesMatrix[:, binSize <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> distancesMatrix[:, binSize])</span>
<span id="cb9-45"><a href="#cb9-45" aria-hidden="true" tabindex="-1"></a>    indicesToMod <span class="op">=</span> distanceCheck[<span class="dv">0</span>]</span>
<span id="cb9-46"><a href="#cb9-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-47"><a href="#cb9-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> index <span class="kw">in</span> indicesToMod:</span>
<span id="cb9-48"><a href="#cb9-48" aria-hidden="true" tabindex="-1"></a>        distanceExtremePoint <span class="op">=</span> np.absolute(yPred[index] <span class="op">-</span> yPredTrain[neighborsMatrix[index, binSize<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb9-49"><a href="#cb9-49" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb9-50"><a href="#cb9-50" aria-hidden="true" tabindex="-1"></a>        neighborsByRadius <span class="op">=</span> nn.radius_neighbors(X <span class="op">=</span> yPred_reshaped[index:index <span class="op">+</span> <span class="dv">1</span>], </span>
<span id="cb9-51"><a href="#cb9-51" aria-hidden="true" tabindex="-1"></a>                                                radius <span class="op">=</span> distanceExtremePoint, return_distance <span class="op">=</span> <span class="va">False</span>)[<span class="dv">0</span>]</span>
<span id="cb9-52"><a href="#cb9-52" aria-hidden="true" tabindex="-1"></a>        neighborsList[index] <span class="op">=</span> neighborsByRadius</span>
<span id="cb9-53"><a href="#cb9-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-54"><a href="#cb9-54" aria-hidden="true" tabindex="-1"></a>    neighborsPerPred <span class="op">=</span> {yPred[index]: neighborsList[index] <span class="cf">for</span> index <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(yPred))}</span>
<span id="cb9-55"><a href="#cb9-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb9-56"><a href="#cb9-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> neighborsPerPred</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>data, XTrain, yTrain, XTest, yTest <span class="op">=</span> loadDataYaz(returnXY <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb10-2"><a href="#cb10-2" aria-hidden="true" tabindex="-1"></a>scalingList <span class="op">=</span> data.loc[data[<span class="st">'label'</span>] <span class="op">==</span> <span class="st">'test'</span>, <span class="st">'scalingValue'</span>].tolist()</span>
<span id="cb10-3"><a href="#cb10-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-4"><a href="#cb10-4" aria-hidden="true" tabindex="-1"></a>LGBM <span class="op">=</span> LGBMRegressor(max_depth <span class="op">=</span> <span class="dv">4</span>, n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb10-5"><a href="#cb10-5" aria-hidden="true" tabindex="-1"></a>LGBM.fit(X <span class="op">=</span> XTrain, y <span class="op">=</span> yTrain)</span>
<span id="cb10-6"><a href="#cb10-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb10-7"><a href="#cb10-7" aria-hidden="true" tabindex="-1"></a>yPredTrain <span class="op">=</span> LGBM.predict(XTrain)</span>
<span id="cb10-8"><a href="#cb10-8" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb11"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb11-4"><a href="#cb11-4" aria-hidden="true" tabindex="-1"></a>                                  yPred <span class="op">=</span> yPredTrain)[<span class="dv">0</span>]</span>
<span id="cb11-5"><a href="#cb11-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize, </span>
<span id="cb11-7"><a href="#cb11-7" aria-hidden="true" tabindex="-1"></a>                                     yPred <span class="op">=</span> yPredTrain,</span>
<span id="cb11-8"><a href="#cb11-8" aria-hidden="true" tabindex="-1"></a>                                     yPredTrain <span class="op">=</span> yPredTrain,</span>
<span id="cb11-9"><a href="#cb11-9" aria-hidden="true" tabindex="-1"></a>                                     neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb11-10"><a href="#cb11-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-11"><a href="#cb11-11" aria-hidden="true" tabindex="-1"></a>test_eq(neighborsDictTest.keys(), neighborsDictTrain.keys())</span>
<span id="cb11-12"><a href="#cb11-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> neighborsDictTest.keys():</span>
<span id="cb11-14"><a href="#cb11-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.array(neighborsDictTrain[key]), np.array(neighborsDictTest[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 208.28 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">1</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a>neighborsDictTrainKNN <span class="op">=</span> neighborsByKNN(binSize <span class="op">=</span> binSize,</span>
<span id="cb13-4"><a href="#cb13-4" aria-hidden="true" tabindex="-1"></a>                                       yPred <span class="op">=</span> yPredTrain)</span>
<span id="cb13-5"><a href="#cb13-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-6"><a href="#cb13-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb13-7"><a href="#cb13-7" aria-hidden="true" tabindex="-1"></a>                                                 yPred <span class="op">=</span> yPredTrain)[<span class="dv">0</span>]</span>
<span id="cb13-8"><a href="#cb13-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-9"><a href="#cb13-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTrain.keys())), np.sort(<span class="bu">list</span>(neighborsDictTrainKNN.keys())))</span>
<span id="cb13-10"><a href="#cb13-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-11"><a href="#cb13-11" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTrain.keys()))</span>
<span id="cb13-12"><a href="#cb13-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb13-13"><a href="#cb13-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTrainKNN[key]), np.sort(neighborsDictTrain[key]))</span>
<span id="cb13-14"><a href="#cb13-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb13-15"><a href="#cb13-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb13-16"><a href="#cb13-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-17"><a href="#cb13-17" aria-hidden="true" tabindex="-1"></a>neighborsDictTestKNN <span class="op">=</span> neighborsByKNNTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb13-18"><a href="#cb13-18" aria-hidden="true" tabindex="-1"></a>                                          yPred <span class="op">=</span> yPred,</span>
<span id="cb13-19"><a href="#cb13-19" aria-hidden="true" tabindex="-1"></a>                                          yPredTrain <span class="op">=</span> yPredTrain)</span>
<span id="cb13-20"><a href="#cb13-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-21"><a href="#cb13-21" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize, </span>
<span id="cb13-22"><a href="#cb13-22" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb13-23"><a href="#cb13-23" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPredTrain,</span>
<span id="cb13-24"><a href="#cb13-24" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb13-25"><a href="#cb13-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-26"><a href="#cb13-26" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTest.keys())), np.sort(<span class="bu">list</span>(neighborsDictTestKNN.keys())))</span>
<span id="cb13-27"><a href="#cb13-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-28"><a href="#cb13-28" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTest.keys()))</span>
<span id="cb13-29"><a href="#cb13-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb13-30"><a href="#cb13-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTestKNN[key]), np.sort(neighborsDictTest[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 210.14 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>neighborsDictTrainKNN <span class="op">=</span> neighborsByKNN(binSize <span class="op">=</span> binSize,</span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>                                       yPred <span class="op">=</span> yPredTrain)</span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>                                                 yPred <span class="op">=</span> yPredTrain)[<span class="dv">0</span>]</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-9"><a href="#cb15-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTrain.keys())), np.sort(<span class="bu">list</span>(neighborsDictTrainKNN.keys())))</span>
<span id="cb15-10"><a href="#cb15-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-11"><a href="#cb15-11" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTrain.keys()))</span>
<span id="cb15-12"><a href="#cb15-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb15-13"><a href="#cb15-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTrainKNN[key]), np.sort(neighborsDictTrain[key]))</span>
<span id="cb15-14"><a href="#cb15-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb15-15"><a href="#cb15-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb15-16"><a href="#cb15-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-17"><a href="#cb15-17" aria-hidden="true" tabindex="-1"></a>neighborsDictTestKNN <span class="op">=</span> neighborsByKNNTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb15-18"><a href="#cb15-18" aria-hidden="true" tabindex="-1"></a>                                          yPred <span class="op">=</span> yPred,</span>
<span id="cb15-19"><a href="#cb15-19" aria-hidden="true" tabindex="-1"></a>                                          yPredTrain <span class="op">=</span> yPredTrain)</span>
<span id="cb15-20"><a href="#cb15-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-21"><a href="#cb15-21" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize, </span>
<span id="cb15-22"><a href="#cb15-22" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb15-23"><a href="#cb15-23" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPredTrain,</span>
<span id="cb15-24"><a href="#cb15-24" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb15-25"><a href="#cb15-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-26"><a href="#cb15-26" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTest.keys())), np.sort(<span class="bu">list</span>(neighborsDictTestKNN.keys())))</span>
<span id="cb15-27"><a href="#cb15-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-28"><a href="#cb15-28" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTest.keys()))</span>
<span id="cb15-29"><a href="#cb15-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb15-30"><a href="#cb15-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTestKNN[key]), np.sort(neighborsDictTest[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 210.40 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">100</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a>neighborsDictTrainKNN <span class="op">=</span> neighborsByKNN(binSize <span class="op">=</span> binSize,</span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>                                       yPred <span class="op">=</span> yPredTrain)</span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a>                                                 yPred <span class="op">=</span> yPredTrain)[<span class="dv">0</span>]</span>
<span id="cb17-8"><a href="#cb17-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-9"><a href="#cb17-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTrain.keys())), np.sort(<span class="bu">list</span>(neighborsDictTrainKNN.keys())))</span>
<span id="cb17-10"><a href="#cb17-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-11"><a href="#cb17-11" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTrain.keys()))</span>
<span id="cb17-12"><a href="#cb17-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb17-13"><a href="#cb17-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTrainKNN[key]), np.sort(neighborsDictTrain[key]))</span>
<span id="cb17-14"><a href="#cb17-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb17-15"><a href="#cb17-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb17-16"><a href="#cb17-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-17"><a href="#cb17-17" aria-hidden="true" tabindex="-1"></a>neighborsDictTestKNN <span class="op">=</span> neighborsByKNNTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb17-18"><a href="#cb17-18" aria-hidden="true" tabindex="-1"></a>                                          yPred <span class="op">=</span> yPred,</span>
<span id="cb17-19"><a href="#cb17-19" aria-hidden="true" tabindex="-1"></a>                                          yPredTrain <span class="op">=</span> yPredTrain)</span>
<span id="cb17-20"><a href="#cb17-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-21"><a href="#cb17-21" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize, </span>
<span id="cb17-22"><a href="#cb17-22" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb17-23"><a href="#cb17-23" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPredTrain,</span>
<span id="cb17-24"><a href="#cb17-24" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb17-25"><a href="#cb17-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-26"><a href="#cb17-26" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTest.keys())), np.sort(<span class="bu">list</span>(neighborsDictTestKNN.keys())))</span>
<span id="cb17-27"><a href="#cb17-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-28"><a href="#cb17-28" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTest.keys()))</span>
<span id="cb17-29"><a href="#cb17-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb17-30"><a href="#cb17-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTestKNN[key]), np.sort(neighborsDictTest[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 216.01 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">1000</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a>neighborsDictTrainKNN <span class="op">=</span> neighborsByKNN(binSize <span class="op">=</span> binSize,</span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>                                       yPred <span class="op">=</span> yPredTrain)</span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a>                                                 yPred <span class="op">=</span> yPredTrain)[<span class="dv">0</span>]</span>
<span id="cb19-8"><a href="#cb19-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-9"><a href="#cb19-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTrain.keys())), np.sort(<span class="bu">list</span>(neighborsDictTrainKNN.keys())))</span>
<span id="cb19-10"><a href="#cb19-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-11"><a href="#cb19-11" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTrain.keys()))</span>
<span id="cb19-12"><a href="#cb19-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb19-13"><a href="#cb19-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTrainKNN[key]), np.sort(neighborsDictTrain[key]))</span>
<span id="cb19-14"><a href="#cb19-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb19-15"><a href="#cb19-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb19-16"><a href="#cb19-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-17"><a href="#cb19-17" aria-hidden="true" tabindex="-1"></a>neighborsDictTestKNN <span class="op">=</span> neighborsByKNNTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb19-18"><a href="#cb19-18" aria-hidden="true" tabindex="-1"></a>                                          yPred <span class="op">=</span> yPred,</span>
<span id="cb19-19"><a href="#cb19-19" aria-hidden="true" tabindex="-1"></a>                                          yPredTrain <span class="op">=</span> yPredTrain)</span>
<span id="cb19-20"><a href="#cb19-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-21"><a href="#cb19-21" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize, </span>
<span id="cb19-22"><a href="#cb19-22" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb19-23"><a href="#cb19-23" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPredTrain,</span>
<span id="cb19-24"><a href="#cb19-24" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb19-25"><a href="#cb19-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-26"><a href="#cb19-26" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTest.keys())), np.sort(<span class="bu">list</span>(neighborsDictTestKNN.keys())))</span>
<span id="cb19-27"><a href="#cb19-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-28"><a href="#cb19-28" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTest.keys()))</span>
<span id="cb19-29"><a href="#cb19-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb19-30"><a href="#cb19-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTestKNN[key]), np.sort(neighborsDictTest[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 275.35 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">3884</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>neighborsDictTrainKNN <span class="op">=</span> neighborsByKNN(binSize <span class="op">=</span> binSize,</span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>                                       yPred <span class="op">=</span> yPredTrain)</span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>neighborsDictTrain <span class="op">=</span> getNeighbors(binSize <span class="op">=</span> binSize, </span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>                                                 yPred <span class="op">=</span> yPredTrain)[<span class="dv">0</span>]</span>
<span id="cb21-8"><a href="#cb21-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-9"><a href="#cb21-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTrain.keys())), np.sort(<span class="bu">list</span>(neighborsDictTrainKNN.keys())))</span>
<span id="cb21-10"><a href="#cb21-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-11"><a href="#cb21-11" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTrain.keys()))</span>
<span id="cb21-12"><a href="#cb21-12" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb21-13"><a href="#cb21-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTrainKNN[key]), np.sort(neighborsDictTrain[key]))</span>
<span id="cb21-14"><a href="#cb21-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb21-15"><a href="#cb21-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb21-16"><a href="#cb21-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-17"><a href="#cb21-17" aria-hidden="true" tabindex="-1"></a>neighborsDictTestKNN <span class="op">=</span> neighborsByKNNTest(binSize <span class="op">=</span> binSize,</span>
<span id="cb21-18"><a href="#cb21-18" aria-hidden="true" tabindex="-1"></a>                                          yPred <span class="op">=</span> yPred,</span>
<span id="cb21-19"><a href="#cb21-19" aria-hidden="true" tabindex="-1"></a>                                          yPredTrain <span class="op">=</span> yPredTrain)</span>
<span id="cb21-20"><a href="#cb21-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-21"><a href="#cb21-21" aria-hidden="true" tabindex="-1"></a>neighborsDictTest <span class="op">=</span> getNeighborsTest(binSize <span class="op">=</span> binSize, </span>
<span id="cb21-22"><a href="#cb21-22" aria-hidden="true" tabindex="-1"></a>                                                    yPred <span class="op">=</span> yPred,</span>
<span id="cb21-23"><a href="#cb21-23" aria-hidden="true" tabindex="-1"></a>                                                    yPredTrain <span class="op">=</span> yPredTrain,</span>
<span id="cb21-24"><a href="#cb21-24" aria-hidden="true" tabindex="-1"></a>                                                    neighborsDictTrain <span class="op">=</span> neighborsDictTrain)</span>
<span id="cb21-25"><a href="#cb21-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-26"><a href="#cb21-26" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.array_equal(np.sort(<span class="bu">list</span>(neighborsDictTest.keys())), np.sort(<span class="bu">list</span>(neighborsDictTestKNN.keys())))</span>
<span id="cb21-27"><a href="#cb21-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-28"><a href="#cb21-28" aria-hidden="true" tabindex="-1"></a>keys <span class="op">=</span> np.sort(<span class="bu">list</span>(neighborsDictTest.keys()))</span>
<span id="cb21-29"><a href="#cb21-29" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> key <span class="kw">in</span> keys:</span>
<span id="cb21-30"><a href="#cb21-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(np.sort(neighborsDictTestKNN[key]), np.sort(neighborsDictTest[key]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 330.02 MB</code></pre>
</div>
</div>
</section>
<section id="lsx-nn-kernel" class="level2">
<h2 class="anchored" data-anchor-id="lsx-nn-kernel">LSx NN Kernel</h2>
<section id="brute-force-version" class="level3">
<h3 class="anchored" data-anchor-id="brute-force-version">Brute Force Version</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="kw">class</span> LevelSetKDEx_NN_bruteForce(BaseWeightsBasedEstimator, BaseLSx):</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>    <span class="co">"""</span></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="co">     `LevelSetKDEx_kNN` turns any point predictor that has a .predict-method </span></span>
<span id="cb23-4"><a href="#cb23-4" aria-hidden="true" tabindex="-1"></a><span class="co">    into an estimator of the condititional density of the underlying distribution.</span></span>
<span id="cb23-5"><a href="#cb23-5" aria-hidden="true" tabindex="-1"></a><span class="co">    The basic idea of each level-set based approach is to interprete the point forecast</span></span>
<span id="cb23-6"><a href="#cb23-6" aria-hidden="true" tabindex="-1"></a><span class="co">    generated by the underlying point predictor as a similarity measure of samples.</span></span>
<span id="cb23-7"><a href="#cb23-7" aria-hidden="true" tabindex="-1"></a><span class="co">    In the case of the `LevelSetKDEx_kNN` defined here, for every new samples</span></span>
<span id="cb23-8"><a href="#cb23-8" aria-hidden="true" tabindex="-1"></a><span class="co">    'binSize'-many training samples are computed whose point forecast is closest</span></span>
<span id="cb23-9"><a href="#cb23-9" aria-hidden="true" tabindex="-1"></a><span class="co">    to the point forecast of the new sample.</span></span>
<span id="cb23-10"><a href="#cb23-10" aria-hidden="true" tabindex="-1"></a><span class="co">    The resulting empirical distribution of these 'nearest' training samples are </span></span>
<span id="cb23-11"><a href="#cb23-11" aria-hidden="true" tabindex="-1"></a><span class="co">    viewed as our estimation of the conditional distribution of each the new sample </span></span>
<span id="cb23-12"><a href="#cb23-12" aria-hidden="true" tabindex="-1"></a><span class="co">    at hand.</span></span>
<span id="cb23-13"><a href="#cb23-13" aria-hidden="true" tabindex="-1"></a><span class="co">    </span></span>
<span id="cb23-14"><a href="#cb23-14" aria-hidden="true" tabindex="-1"></a><span class="co">    </span><span class="al">NOTE</span><span class="co">: In contrast to the standard `LevelSetKDEx`, it is possible to apply</span></span>
<span id="cb23-15"><a href="#cb23-15" aria-hidden="true" tabindex="-1"></a><span class="co">    `LevelSetKDEx_kNN` to arbitrary dimensional point predictors.</span></span>
<span id="cb23-16"><a href="#cb23-16" aria-hidden="true" tabindex="-1"></a><span class="co">    """</span></span>
<span id="cb23-17"><a href="#cb23-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-18"><a href="#cb23-18" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init__</span>(<span class="va">self</span>, </span>
<span id="cb23-19"><a href="#cb23-19" aria-hidden="true" tabindex="-1"></a>                 estimator, <span class="co"># Model with a .fit and .predict-method (implementing the scikit-learn estimator interface).</span></span>
<span id="cb23-20"><a href="#cb23-20" aria-hidden="true" tabindex="-1"></a>                 binSize: <span class="bu">int</span><span class="op">=</span><span class="va">None</span>, <span class="co"># Size of the bins created while running fit.</span></span>
<span id="cb23-21"><a href="#cb23-21" aria-hidden="true" tabindex="-1"></a>                 ):</span>
<span id="cb23-22"><a href="#cb23-22" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-23"><a href="#cb23-23" aria-hidden="true" tabindex="-1"></a>        <span class="bu">super</span>(BaseEstimator, <span class="va">self</span>).<span class="fu">__init__</span>(estimator <span class="op">=</span> estimator)</span>
<span id="cb23-24"><a href="#cb23-24" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-25"><a href="#cb23-25" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.binSize <span class="op">=</span> binSize</span>
<span id="cb23-26"><a href="#cb23-26" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.yTrain <span class="op">=</span> <span class="va">None</span></span>
<span id="cb23-27"><a href="#cb23-27" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.yPredTrain <span class="op">=</span> <span class="va">None</span></span>
<span id="cb23-28"><a href="#cb23-28" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.nearestNeighborsOnPreds <span class="op">=</span> <span class="va">None</span></span>
<span id="cb23-29"><a href="#cb23-29" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.fitted <span class="op">=</span> <span class="va">False</span></span>
<span id="cb23-30"><a href="#cb23-30" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-31"><a href="#cb23-31" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---</span></span>
<span id="cb23-32"><a href="#cb23-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-33"><a href="#cb23-33" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> fit(<span class="va">self</span>: LevelSetKDEx, </span>
<span id="cb23-34"><a href="#cb23-34" aria-hidden="true" tabindex="-1"></a>            X: np.ndarray, <span class="co"># Feature matrix used by `estimator` to predict `y`.</span></span>
<span id="cb23-35"><a href="#cb23-35" aria-hidden="true" tabindex="-1"></a>            y: np.ndarray, <span class="co"># 1-dimensional target variable corresponding to the feature matrix `X`.</span></span>
<span id="cb23-36"><a href="#cb23-36" aria-hidden="true" tabindex="-1"></a>            ):</span>
<span id="cb23-37"><a href="#cb23-37" aria-hidden="true" tabindex="-1"></a>        <span class="co">"""</span></span>
<span id="cb23-38"><a href="#cb23-38" aria-hidden="true" tabindex="-1"></a><span class="co">        Fit `LevelSetKDEx_kNN` model by applying the nearest neighbors algorithm to the point</span></span>
<span id="cb23-39"><a href="#cb23-39" aria-hidden="true" tabindex="-1"></a><span class="co">        predictions of the samples specified by `X` based on `estimator`. </span></span>
<span id="cb23-40"><a href="#cb23-40" aria-hidden="true" tabindex="-1"></a><span class="co">        """</span></span>
<span id="cb23-41"><a href="#cb23-41" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-42"><a href="#cb23-42" aria-hidden="true" tabindex="-1"></a>        <span class="co"># Checks</span></span>
<span id="cb23-43"><a href="#cb23-43" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.binSize <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb23-44"><a href="#cb23-44" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"'binSize' must be specified to fit the LSx estimator!"</span>)</span>
<span id="cb23-45"><a href="#cb23-45" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-46"><a href="#cb23-46" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="va">self</span>.binSize <span class="op">&gt;</span> y.shape[<span class="dv">0</span>]:</span>
<span id="cb23-47"><a href="#cb23-47" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"'binSize' mustn't be bigger than the size of 'y'!"</span>)</span>
<span id="cb23-48"><a href="#cb23-48" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-49"><a href="#cb23-49" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> X.shape[<span class="dv">0</span>] <span class="op">!=</span> y.shape[<span class="dv">0</span>]:</span>
<span id="cb23-50"><a href="#cb23-50" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"'X' and 'y' must contain the same number of samples!"</span>)</span>
<span id="cb23-51"><a href="#cb23-51" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-52"><a href="#cb23-52" aria-hidden="true" tabindex="-1"></a>        <span class="co"># IMPORTANT: In case 'y' is given as a pandas.Series, we can potentially run into indexing </span></span>
<span id="cb23-53"><a href="#cb23-53" aria-hidden="true" tabindex="-1"></a>        <span class="co"># problems later on.</span></span>
<span id="cb23-54"><a href="#cb23-54" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">isinstance</span>(y, pd.Series):</span>
<span id="cb23-55"><a href="#cb23-55" aria-hidden="true" tabindex="-1"></a>            y <span class="op">=</span> y.ravel()</span>
<span id="cb23-56"><a href="#cb23-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-57"><a href="#cb23-57" aria-hidden="true" tabindex="-1"></a>        <span class="co">#---</span></span>
<span id="cb23-58"><a href="#cb23-58" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-59"><a href="#cb23-59" aria-hidden="true" tabindex="-1"></a>        <span class="cf">try</span>:</span>
<span id="cb23-60"><a href="#cb23-60" aria-hidden="true" tabindex="-1"></a>            yPred <span class="op">=</span> <span class="va">self</span>.estimator.predict(X)</span>
<span id="cb23-61"><a href="#cb23-61" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-62"><a href="#cb23-62" aria-hidden="true" tabindex="-1"></a>        <span class="cf">except</span> NotFittedError:</span>
<span id="cb23-63"><a href="#cb23-63" aria-hidden="true" tabindex="-1"></a>            <span class="cf">try</span>:</span>
<span id="cb23-64"><a href="#cb23-64" aria-hidden="true" tabindex="-1"></a>                <span class="va">self</span>.estimator.fit(X <span class="op">=</span> X, y <span class="op">=</span> y)                </span>
<span id="cb23-65"><a href="#cb23-65" aria-hidden="true" tabindex="-1"></a>            <span class="cf">except</span>:</span>
<span id="cb23-66"><a href="#cb23-66" aria-hidden="true" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"Couldn't fit 'estimator' with user specified 'X' and 'y'!"</span>)</span>
<span id="cb23-67"><a href="#cb23-67" aria-hidden="true" tabindex="-1"></a>            <span class="cf">else</span>:</span>
<span id="cb23-68"><a href="#cb23-68" aria-hidden="true" tabindex="-1"></a>                yPred <span class="op">=</span> <span class="va">self</span>.estimator.predict(X)</span>
<span id="cb23-69"><a href="#cb23-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-70"><a href="#cb23-70" aria-hidden="true" tabindex="-1"></a>        <span class="co">#---</span></span>
<span id="cb23-71"><a href="#cb23-71" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-72"><a href="#cb23-72" aria-hidden="true" tabindex="-1"></a>        yPred_reshaped <span class="op">=</span> np.reshape(yPred, newshape <span class="op">=</span> (<span class="bu">len</span>(yPred), <span class="dv">1</span>))</span>
<span id="cb23-73"><a href="#cb23-73" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-74"><a href="#cb23-74" aria-hidden="true" tabindex="-1"></a>        nn <span class="op">=</span> NearestNeighbors(algorithm <span class="op">=</span> <span class="st">'kd_tree'</span>)</span>
<span id="cb23-75"><a href="#cb23-75" aria-hidden="true" tabindex="-1"></a>        nn.fit(X <span class="op">=</span> yPred_reshaped)</span>
<span id="cb23-76"><a href="#cb23-76" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-77"><a href="#cb23-77" aria-hidden="true" tabindex="-1"></a>        distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPred_reshaped, </span>
<span id="cb23-78"><a href="#cb23-78" aria-hidden="true" tabindex="-1"></a>                                                         n_neighbors <span class="op">=</span> <span class="va">self</span>.binSize <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb23-79"><a href="#cb23-79" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-80"><a href="#cb23-80" aria-hidden="true" tabindex="-1"></a>        neighborsList <span class="op">=</span> <span class="bu">list</span>(neighborsMatrix[:, <span class="dv">0</span>:<span class="va">self</span>.binSize])</span>
<span id="cb23-81"><a href="#cb23-81" aria-hidden="true" tabindex="-1"></a>        distanceCheck <span class="op">=</span> np.where(distancesMatrix[:, <span class="va">self</span>.binSize <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> distancesMatrix[:, <span class="va">self</span>.binSize])</span>
<span id="cb23-82"><a href="#cb23-82" aria-hidden="true" tabindex="-1"></a>        indicesToMod <span class="op">=</span> distanceCheck[<span class="dv">0</span>]</span>
<span id="cb23-83"><a href="#cb23-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-84"><a href="#cb23-84" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index <span class="kw">in</span> indicesToMod:</span>
<span id="cb23-85"><a href="#cb23-85" aria-hidden="true" tabindex="-1"></a>            distanceExtremePoint <span class="op">=</span> np.absolute(yPred[index] <span class="op">-</span> yPred[neighborsMatrixTrain[index, <span class="va">self</span>.binSize<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb23-86"><a href="#cb23-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-87"><a href="#cb23-87" aria-hidden="true" tabindex="-1"></a>            neighborsByRadius <span class="op">=</span> nn.radius_neighbors(X <span class="op">=</span> yPred_reshaped[index:index <span class="op">+</span> <span class="dv">1</span>], </span>
<span id="cb23-88"><a href="#cb23-88" aria-hidden="true" tabindex="-1"></a>                                                    radius <span class="op">=</span> distanceExtremePoint, </span>
<span id="cb23-89"><a href="#cb23-89" aria-hidden="true" tabindex="-1"></a>                                                    return_distance <span class="op">=</span> <span class="va">False</span>)[<span class="dv">0</span>]</span>
<span id="cb23-90"><a href="#cb23-90" aria-hidden="true" tabindex="-1"></a>            neighborsList[index] <span class="op">=</span> neighborsByRadius</span>
<span id="cb23-91"><a href="#cb23-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-92"><a href="#cb23-92" aria-hidden="true" tabindex="-1"></a>        <span class="co">#---</span></span>
<span id="cb23-93"><a href="#cb23-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-94"><a href="#cb23-94" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.yTrain <span class="op">=</span> y</span>
<span id="cb23-95"><a href="#cb23-95" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.yPredTrain <span class="op">=</span> yPred</span>
<span id="cb23-96"><a href="#cb23-96" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>.yTrainNeighborsList <span class="op">=</span> neighborsList</span>
<span id="cb23-97"><a href="#cb23-97" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._nearestNeighborsOnPreds <span class="op">=</span> nn</span>
<span id="cb23-98"><a href="#cb23-98" aria-hidden="true" tabindex="-1"></a>        <span class="va">self</span>._fitted <span class="op">=</span> <span class="va">True</span></span>
<span id="cb23-99"><a href="#cb23-99" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-100"><a href="#cb23-100" aria-hidden="true" tabindex="-1"></a>    <span class="co">#---</span></span>
<span id="cb23-101"><a href="#cb23-101" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb23-102"><a href="#cb23-102" aria-hidden="true" tabindex="-1"></a>    <span class="kw">def</span> getWeights(<span class="va">self</span>, </span>
<span id="cb23-103"><a href="#cb23-103" aria-hidden="true" tabindex="-1"></a>                   X: np.ndarray, <span class="co"># Feature matrix for which conditional density estimates are computed.</span></span>
<span id="cb23-104"><a href="#cb23-104" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># Specifies structure of the returned density estimates. One of: </span></span>
<span id="cb23-105"><a href="#cb23-105" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># 'all', 'onlyPositiveWeights', 'summarized', 'cumDistribution', 'cumDistributionSummarized'</span></span>
<span id="cb23-106"><a href="#cb23-106" aria-hidden="true" tabindex="-1"></a>                   outputType: <span class="bu">str</span><span class="op">=</span><span class="st">'onlyPositiveWeights'</span>, </span>
<span id="cb23-107"><a href="#cb23-107" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># Optional. List with length X.shape[0]. Values are multiplied to the estimated </span></span>
<span id="cb23-108"><a href="#cb23-108" aria-hidden="true" tabindex="-1"></a>                   <span class="co"># density of each sample for scaling purposes.</span></span>
<span id="cb23-109"><a href="#cb23-109" aria-hidden="true" tabindex="-1"></a>                   scalingList: <span class="bu">list</span><span class="op">=</span><span class="va">None</span>, </span>
<span id="cb23-110"><a href="#cb23-110" aria-hidden="true" tabindex="-1"></a>                   ) <span class="op">-&gt;</span> <span class="bu">list</span>: <span class="co"># List whose elements are the conditional density estimates for the samples specified by `X`.</span></span>
<span id="cb23-111"><a href="#cb23-111" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-112"><a href="#cb23-112" aria-hidden="true" tabindex="-1"></a>        __doc__ <span class="op">=</span> BaseWeightsBasedEstimator.getWeights.__doc__</span>
<span id="cb23-113"><a href="#cb23-113" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-114"><a href="#cb23-114" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="va">self</span>._fitted:</span>
<span id="cb23-115"><a href="#cb23-115" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> NotFittedError(<span class="st">"This LevelSetKDEx_kNN instance is not fitted yet. Call 'fit' with "</span></span>
<span id="cb23-116"><a href="#cb23-116" aria-hidden="true" tabindex="-1"></a>                                 <span class="st">"appropriate arguments before trying to compute weights."</span>)</span>
<span id="cb23-117"><a href="#cb23-117" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-118"><a href="#cb23-118" aria-hidden="true" tabindex="-1"></a>        <span class="co">#---</span></span>
<span id="cb23-119"><a href="#cb23-119" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-120"><a href="#cb23-120" aria-hidden="true" tabindex="-1"></a>        neighborsListTrain <span class="op">=</span> <span class="va">self</span>.yTrainNeighborsList</span>
<span id="cb23-121"><a href="#cb23-121" aria-hidden="true" tabindex="-1"></a>        nn <span class="op">=</span> <span class="va">self</span>._nearestNeighborsOnPreds</span>
<span id="cb23-122"><a href="#cb23-122" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-123"><a href="#cb23-123" aria-hidden="true" tabindex="-1"></a>        <span class="co">#---</span></span>
<span id="cb23-124"><a href="#cb23-124" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-125"><a href="#cb23-125" aria-hidden="true" tabindex="-1"></a>        yPred <span class="op">=</span> <span class="va">self</span>.estimator.predict(X)   </span>
<span id="cb23-126"><a href="#cb23-126" aria-hidden="true" tabindex="-1"></a>        yPred_reshaped <span class="op">=</span> np.reshape(yPred, newshape <span class="op">=</span> (<span class="bu">len</span>(yPred), <span class="dv">1</span>))</span>
<span id="cb23-127"><a href="#cb23-127" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-128"><a href="#cb23-128" aria-hidden="true" tabindex="-1"></a>        distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPred_reshaped, </span>
<span id="cb23-129"><a href="#cb23-129" aria-hidden="true" tabindex="-1"></a>                                                         n_neighbors <span class="op">=</span> <span class="va">self</span>.binSize <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb23-130"><a href="#cb23-130" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-131"><a href="#cb23-131" aria-hidden="true" tabindex="-1"></a>        neighborsList <span class="op">=</span> <span class="bu">list</span>(neighborsMatrix[:, <span class="dv">0</span>:<span class="va">self</span>.binSize])</span>
<span id="cb23-132"><a href="#cb23-132" aria-hidden="true" tabindex="-1"></a>        distanceCheck <span class="op">=</span> np.where(distancesMatrix[:, <span class="va">self</span>.binSize <span class="op">-</span> <span class="dv">1</span>] <span class="op">==</span> distancesMatrix[:, <span class="va">self</span>.binSize])</span>
<span id="cb23-133"><a href="#cb23-133" aria-hidden="true" tabindex="-1"></a>        indicesToMod <span class="op">=</span> distanceCheck[<span class="dv">0</span>]</span>
<span id="cb23-134"><a href="#cb23-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-135"><a href="#cb23-135" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> index <span class="kw">in</span> indicesToMod:</span>
<span id="cb23-136"><a href="#cb23-136" aria-hidden="true" tabindex="-1"></a>            distanceExtremePoint <span class="op">=</span> np.absolute(yPred[index] <span class="op">-</span> <span class="va">self</span>.yPredTrain[neighborsMatrix[index, <span class="va">self</span>.binSize<span class="op">-</span><span class="dv">1</span>]])</span>
<span id="cb23-137"><a href="#cb23-137" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-138"><a href="#cb23-138" aria-hidden="true" tabindex="-1"></a>            neighborsByRadius <span class="op">=</span> nn.radius_neighbors(X <span class="op">=</span> yPred_reshaped[index:index <span class="op">+</span> <span class="dv">1</span>], </span>
<span id="cb23-139"><a href="#cb23-139" aria-hidden="true" tabindex="-1"></a>                                                    radius <span class="op">=</span> distanceExtremePoint, return_distance <span class="op">=</span> <span class="va">False</span>)[<span class="dv">0</span>]</span>
<span id="cb23-140"><a href="#cb23-140" aria-hidden="true" tabindex="-1"></a>            neighborsList[index] <span class="op">=</span> neighborsByRadius</span>
<span id="cb23-141"><a href="#cb23-141" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-142"><a href="#cb23-142" aria-hidden="true" tabindex="-1"></a>        <span class="co">#---</span></span>
<span id="cb23-143"><a href="#cb23-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-144"><a href="#cb23-144" aria-hidden="true" tabindex="-1"></a>        weightsDataList <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb23-145"><a href="#cb23-145" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb23-146"><a href="#cb23-146" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> neighbors <span class="kw">in</span> neighborsList:</span>
<span id="cb23-147"><a href="#cb23-147" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-148"><a href="#cb23-148" aria-hidden="true" tabindex="-1"></a>            weights <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb23-149"><a href="#cb23-149" aria-hidden="true" tabindex="-1"></a>            indicesPosWeight <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb23-150"><a href="#cb23-150" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-151"><a href="#cb23-151" aria-hidden="true" tabindex="-1"></a>            <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(neighborsListTrain)):</span>
<span id="cb23-152"><a href="#cb23-152" aria-hidden="true" tabindex="-1"></a>                weight <span class="op">=</span> <span class="dv">2</span> <span class="op">*</span> <span class="bu">len</span>(<span class="bu">set</span>(neighbors) <span class="op">&amp;</span> <span class="bu">set</span>(neighborsListTrain[i])) <span class="op">/</span> (<span class="bu">len</span>(neighbors) <span class="op">+</span> <span class="bu">len</span>(neighborsListTrain[i]))</span>
<span id="cb23-153"><a href="#cb23-153" aria-hidden="true" tabindex="-1"></a>                </span>
<span id="cb23-154"><a href="#cb23-154" aria-hidden="true" tabindex="-1"></a>                <span class="cf">if</span> weight <span class="op">&gt;</span> <span class="dv">0</span>:</span>
<span id="cb23-155"><a href="#cb23-155" aria-hidden="true" tabindex="-1"></a>                    weights.append(weight)</span>
<span id="cb23-156"><a href="#cb23-156" aria-hidden="true" tabindex="-1"></a>                    indicesPosWeight.append(i)</span>
<span id="cb23-157"><a href="#cb23-157" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb23-158"><a href="#cb23-158" aria-hidden="true" tabindex="-1"></a>            weights <span class="op">=</span> np.array(weights) <span class="op">/</span> <span class="bu">sum</span>(weights)</span>
<span id="cb23-159"><a href="#cb23-159" aria-hidden="true" tabindex="-1"></a>            weightsDataList.append((weights, np.array(indicesPosWeight)))</span>
<span id="cb23-160"><a href="#cb23-160" aria-hidden="true" tabindex="-1"></a>                            </span>
<span id="cb23-161"><a href="#cb23-161" aria-hidden="true" tabindex="-1"></a>        weightsDataList <span class="op">=</span> restructureWeightsDataList(weightsDataList <span class="op">=</span> weightsDataList, </span>
<span id="cb23-162"><a href="#cb23-162" aria-hidden="true" tabindex="-1"></a>                                                     outputType <span class="op">=</span> outputType, </span>
<span id="cb23-163"><a href="#cb23-163" aria-hidden="true" tabindex="-1"></a>                                                     y <span class="op">=</span> <span class="va">self</span>.yTrain,</span>
<span id="cb23-164"><a href="#cb23-164" aria-hidden="true" tabindex="-1"></a>                                                     scalingList <span class="op">=</span> scalingList,</span>
<span id="cb23-165"><a href="#cb23-165" aria-hidden="true" tabindex="-1"></a>                                                     equalWeights <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb23-166"><a href="#cb23-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-167"><a href="#cb23-167" aria-hidden="true" tabindex="-1"></a>        <span class="cf">return</span> weightsDataList</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN_bruteForce <span class="op">=</span> LevelSetKDEx_NN_bruteForce(binSize <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>                                                  estimator <span class="op">=</span> LGBM)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN_bruteForce.fit(XTrain, yTrain)</span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>weightsDataBruteForce <span class="op">=</span> LSKDEx_NN_bruteForce.getWeights(XTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN <span class="op">=</span> LevelSetKDEx_NN(binSize <span class="op">=</span> <span class="dv">4</span>,</span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>                            estimator <span class="op">=</span> LGBM)</span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-4"><a href="#cb25-4" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN.fit(XTrain, yTrain)</span>
<span id="cb25-5"><a href="#cb25-5" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> LSKDEx_NN.getWeights(XTest)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 330.02 MB
After Kernel Values: Memory used by Jupyter notebook: 365.29 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>]):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(weightsDataBruteForce[i][<span class="dv">0</span>], weightsData[i][<span class="dv">0</span>])</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(weightsDataBruteForce[i][<span class="dv">1</span>], weightsData[i][<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="efficientram-algorithm" class="level3">
<h3 class="anchored" data-anchor-id="efficientram-algorithm">EfficientRAM Algorithm</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN <span class="op">=</span> LevelSetKDEx_NN(binSize <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a>                            estimator <span class="op">=</span> LGBM,</span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a>                            efficientRAM <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN.fit(XTrain, yTrain)</span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN2 <span class="op">=</span> LevelSetKDEx_NN(binSize <span class="op">=</span> <span class="dv">500</span>,</span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>                             estimator <span class="op">=</span> LGBM,</span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>                             efficientRAM <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a>LSKDEx_NN2.fit(XTrain, yTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Loop: Memory used by Jupyter notebook: 365.55 MB
After Loop: Memory used by Jupyter notebook: 365.55 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> LSKDEx_NN.getWeights(XTest)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>weightsDataEfficient <span class="op">=</span> LSKDEx_NN2.getWeights(XTest)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="bu">len</span>(weightsDataEfficient))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-stdout">
<pre><code>After Kernel Values: Memory used by Jupyter notebook: 376.37 MB
After Kernel Values: Memory used by Jupyter notebook: 394.26 MB</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb32"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>]):</span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsData[i][<span class="dv">0</span>]</span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> weightsData[i][<span class="dv">1</span>]</span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>    weightsEfficient <span class="op">=</span> weightsDataEfficient[i][<span class="dv">0</span>]</span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>    indicesEfficient <span class="op">=</span> weightsDataEfficient[i][<span class="dv">1</span>]</span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a>    sortedIndices <span class="op">=</span> np.argsort(indicesEfficient)</span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>    weightsEfficient <span class="op">=</span> weightsEfficient[sortedIndices]</span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>    indicesEfficient <span class="op">=</span> indicesEfficient[sortedIndices]</span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(weights, weightsEfficient)</span>
<span id="cb32-13"><a href="#cb32-13" aria-hidden="true" tabindex="-1"></a>    test_eq(indices, indicesEfficient)</span>
<span id="cb32-14"><a href="#cb32-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb32-15"><a href="#cb32-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb32-16"><a href="#cb32-16" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(weightsEfficient.<span class="bu">sum</span>(), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>i</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>1273</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a>weights[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([0.00214096, 0.00053643, 0.00069308, 0.00026109, 0.00100165,
       0.00121527, 0.00155232, 0.00036078, 0.00236882, 0.00020887])</code></pre>
</div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>weightsEfficient[<span class="dv">0</span>:<span class="dv">10</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<pre><code>array([0.00214096, 0.00053643, 0.00069308, 0.00026109, 0.00100165,
       0.00121527, 0.00155232, 0.00036078, 0.00236882, 0.00020887])</code></pre>
</div>
</div>
</section>
</section>
<section id="saa" class="level2">
<h2 class="anchored" data-anchor-id="saa">SAA</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>SAA <span class="op">=</span> SampleAverageApproximation()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb40"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>SAA.fit(y <span class="op">=</span> np.arange(<span class="dv">100</span>))</span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> SAA.getWeights(outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">1</span>)</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], np.repeat(<span class="fl">0.01</span>, <span class="dv">100</span>))</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], np.arange(<span class="dv">100</span>))</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> SAA.getWeights(X <span class="op">=</span> np.identity(<span class="dv">10</span>))</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">10</span>)</span>
<span id="cb40-10"><a href="#cb40-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-11"><a href="#cb40-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb40-12"><a href="#cb40-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(weightsData[i][<span class="dv">0</span>], weightsData[<span class="dv">0</span>][<span class="dv">0</span>])</span>
<span id="cb40-13"><a href="#cb40-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(weightsData[i][<span class="dv">1</span>], weightsData[<span class="dv">0</span>][<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb41"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a>SAA.fit(y <span class="op">=</span> np.repeat(np.arange(<span class="dv">10</span>), <span class="dv">2</span>))</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> SAA.getWeights(outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">1</span>)</span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">0</span>], np.repeat(<span class="fl">0.05</span>, <span class="dv">20</span>))</span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a>test_eq(weightsData[<span class="dv">0</span>][<span class="dv">1</span>], np.arange(<span class="dv">20</span>))</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-8"><a href="#cb41-8" aria-hidden="true" tabindex="-1"></a>weightsData <span class="op">=</span> SAA.getWeights(X <span class="op">=</span> np.identity(<span class="dv">10</span>))</span>
<span id="cb41-9"><a href="#cb41-9" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsData), <span class="dv">10</span>)</span>
<span id="cb41-10"><a href="#cb41-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb41-11"><a href="#cb41-11" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>):</span>
<span id="cb41-12"><a href="#cb41-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(weightsData[i][<span class="dv">0</span>], weightsData[<span class="dv">0</span>][<span class="dv">0</span>])</span>
<span id="cb41-13"><a href="#cb41-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.array_equal(weightsData[i][<span class="dv">1</span>], weightsData[<span class="dv">0</span>][<span class="dv">1</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="loading-yaz-data" class="level2">
<h2 class="anchored" data-anchor-id="loading-yaz-data">Loading Yaz Data</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb42"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a>testDays <span class="op">=</span> <span class="dv">182</span></span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a>daysToCut <span class="op">=</span> <span class="dv">300</span></span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb42-4"><a href="#cb42-4" aria-hidden="true" tabindex="-1"></a>data, XTrain, yTrain, XTest, yTest <span class="op">=</span> loadDataYaz(returnXY <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb42-5"><a href="#cb42-5" aria-hidden="true" tabindex="-1"></a>scalingList <span class="op">=</span> data.loc[data[<span class="st">'label'</span>] <span class="op">==</span> <span class="st">'test'</span>, <span class="st">'scalingValue'</span>].tolist()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb43"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> XTest.shape[<span class="dv">0</span>] <span class="op">==</span> <span class="bu">len</span>(data[<span class="st">'id'</span>].unique()) <span class="op">*</span> testDays </span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> yTest.shape[<span class="dv">0</span>] <span class="op">==</span> <span class="bu">len</span>(data[<span class="st">'id'</span>].unique()) <span class="op">*</span> testDays</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> XTrain.shape[<span class="dv">0</span>] <span class="op">==</span> data.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="bu">len</span>(data[<span class="st">'id'</span>].unique()) <span class="op">*</span> testDays</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> yTrain.shape[<span class="dv">0</span>] <span class="op">==</span> data.shape[<span class="dv">0</span>] <span class="op">-</span> <span class="bu">len</span>(data[<span class="st">'id'</span>].unique()) <span class="op">*</span> testDays</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="grouped-time-series-split" class="level2">
<h2 class="anchored" data-anchor-id="grouped-time-series-split">Grouped Time Series Split</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb44"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a>nIDs <span class="op">=</span> <span class="bu">len</span>(data[<span class="st">'id'</span>].unique())</span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a>kFolds <span class="op">=</span> <span class="dv">4</span></span>
<span id="cb44-3"><a href="#cb44-3" aria-hidden="true" tabindex="-1"></a>testLength <span class="op">=</span> <span class="dv">7</span></span>
<span id="cb44-4"><a href="#cb44-4" aria-hidden="true" tabindex="-1"></a>timeFeature <span class="op">=</span> <span class="st">'dayIndex'</span></span>
<span id="cb44-5"><a href="#cb44-5" aria-hidden="true" tabindex="-1"></a>groupFeature <span class="op">=</span> <span class="st">'id'</span></span>
<span id="cb44-6"><a href="#cb44-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-7"><a href="#cb44-7" aria-hidden="true" tabindex="-1"></a>cvFolds <span class="op">=</span> groupedTimeSeriesSplit(data <span class="op">=</span> data, </span>
<span id="cb44-8"><a href="#cb44-8" aria-hidden="true" tabindex="-1"></a>                                 kFolds <span class="op">=</span> kFolds, </span>
<span id="cb44-9"><a href="#cb44-9" aria-hidden="true" tabindex="-1"></a>                                 testLength <span class="op">=</span> testLength, </span>
<span id="cb44-10"><a href="#cb44-10" aria-hidden="true" tabindex="-1"></a>                                 groupFeature <span class="op">=</span> groupFeature, </span>
<span id="cb44-11"><a href="#cb44-11" aria-hidden="true" tabindex="-1"></a>                                 timeFeature <span class="op">=</span> timeFeature)</span>
<span id="cb44-12"><a href="#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="#cb44-13" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(cvFolds), <span class="dv">4</span>)</span>
<span id="cb44-14"><a href="#cb44-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-15"><a href="#cb44-15" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(cvFolds)):</span>
<span id="cb44-16"><a href="#cb44-16" aria-hidden="true" tabindex="-1"></a>    fold <span class="op">=</span> cvFolds[i]</span>
<span id="cb44-17"><a href="#cb44-17" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-18"><a href="#cb44-18" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(fold[<span class="dv">1</span>]), testLength <span class="op">*</span> nIDs)</span>
<span id="cb44-19"><a href="#cb44-19" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(fold[<span class="dv">0</span>]), (data.shape[<span class="dv">0</span>] <span class="op">-</span> nIDs <span class="op">*</span> testLength <span class="op">*</span> (kFolds <span class="op">-</span> i <span class="op">-</span> <span class="dv">1</span>)) <span class="op">-</span> <span class="bu">len</span>(fold[<span class="dv">1</span>]))</span>
<span id="cb44-20"><a href="#cb44-20" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(<span class="bu">set</span>(fold[<span class="dv">0</span>]) <span class="op">&amp;</span> <span class="bu">set</span>(fold[<span class="dv">1</span>])), <span class="dv">0</span>)</span>
<span id="cb44-21"><a href="#cb44-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-22"><a href="#cb44-22" aria-hidden="true" tabindex="-1"></a>    dataTrainToCheck <span class="op">=</span> data.iloc[fold[<span class="dv">0</span>]]</span>
<span id="cb44-23"><a href="#cb44-23" aria-hidden="true" tabindex="-1"></a>    dataTestToCheck <span class="op">=</span> data.iloc[fold[<span class="dv">1</span>]]</span>
<span id="cb44-24"><a href="#cb44-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-25"><a href="#cb44-25" aria-hidden="true" tabindex="-1"></a>    timeMaxGroupTrain <span class="op">=</span> dataTrainToCheck.groupby(groupFeature)[timeFeature].<span class="bu">max</span>()</span>
<span id="cb44-26"><a href="#cb44-26" aria-hidden="true" tabindex="-1"></a>    timeMinGroupTest <span class="op">=</span> dataTestToCheck.groupby(groupFeature)[timeFeature].<span class="bu">min</span>()</span>
<span id="cb44-27"><a href="#cb44-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb44-28"><a href="#cb44-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> (timeMaxGroupTrain <span class="op">&lt;</span> timeMinGroupTest).<span class="bu">all</span>()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb45"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a>LGBM <span class="op">=</span> LGBMRegressor(max_depth <span class="op">=</span> <span class="dv">4</span>, n_jobs <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a>LGBM.fit(X <span class="op">=</span> XTrain, y <span class="op">=</span> yTrain)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<div class="cell-output cell-output-display">
<style>#sk-container-id-1 {color: black;background-color: white;}#sk-container-id-1 pre{padding: 0;}#sk-container-id-1 div.sk-toggleable {background-color: white;}#sk-container-id-1 label.sk-toggleable__label {cursor: pointer;display: block;width: 100%;margin-bottom: 0;padding: 0.3em;box-sizing: border-box;text-align: center;}#sk-container-id-1 label.sk-toggleable__label-arrow:before {content: "▸";float: left;margin-right: 0.25em;color: #696969;}#sk-container-id-1 label.sk-toggleable__label-arrow:hover:before {color: black;}#sk-container-id-1 div.sk-estimator:hover label.sk-toggleable__label-arrow:before {color: black;}#sk-container-id-1 div.sk-toggleable__content {max-height: 0;max-width: 0;overflow: hidden;text-align: left;background-color: #f0f8ff;}#sk-container-id-1 div.sk-toggleable__content pre {margin: 0.2em;color: black;border-radius: 0.25em;background-color: #f0f8ff;}#sk-container-id-1 input.sk-toggleable__control:checked~div.sk-toggleable__content {max-height: 200px;max-width: 100%;overflow: auto;}#sk-container-id-1 input.sk-toggleable__control:checked~label.sk-toggleable__label-arrow:before {content: "▾";}#sk-container-id-1 div.sk-estimator input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-label input.sk-toggleable__control:checked~label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 input.sk-hidden--visually {border: 0;clip: rect(1px 1px 1px 1px);clip: rect(1px, 1px, 1px, 1px);height: 1px;margin: -1px;overflow: hidden;padding: 0;position: absolute;width: 1px;}#sk-container-id-1 div.sk-estimator {font-family: monospace;background-color: #f0f8ff;border: 1px dotted black;border-radius: 0.25em;box-sizing: border-box;margin-bottom: 0.5em;}#sk-container-id-1 div.sk-estimator:hover {background-color: #d4ebff;}#sk-container-id-1 div.sk-parallel-item::after {content: "";width: 100%;border-bottom: 1px solid gray;flex-grow: 1;}#sk-container-id-1 div.sk-label:hover label.sk-toggleable__label {background-color: #d4ebff;}#sk-container-id-1 div.sk-serial::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: 0;}#sk-container-id-1 div.sk-serial {display: flex;flex-direction: column;align-items: center;background-color: white;padding-right: 0.2em;padding-left: 0.2em;position: relative;}#sk-container-id-1 div.sk-item {position: relative;z-index: 1;}#sk-container-id-1 div.sk-parallel {display: flex;align-items: stretch;justify-content: center;background-color: white;position: relative;}#sk-container-id-1 div.sk-item::before, #sk-container-id-1 div.sk-parallel-item::before {content: "";position: absolute;border-left: 1px solid gray;box-sizing: border-box;top: 0;bottom: 0;left: 50%;z-index: -1;}#sk-container-id-1 div.sk-parallel-item {display: flex;flex-direction: column;z-index: 1;position: relative;background-color: white;}#sk-container-id-1 div.sk-parallel-item:first-child::after {align-self: flex-end;width: 50%;}#sk-container-id-1 div.sk-parallel-item:last-child::after {align-self: flex-start;width: 50%;}#sk-container-id-1 div.sk-parallel-item:only-child::after {width: 0;}#sk-container-id-1 div.sk-dashed-wrapped {border: 1px dashed gray;margin: 0 0.4em 0.5em 0.4em;box-sizing: border-box;padding-bottom: 0.4em;background-color: white;}#sk-container-id-1 div.sk-label label {font-family: monospace;font-weight: bold;display: inline-block;line-height: 1.2em;}#sk-container-id-1 div.sk-label-container {text-align: center;}#sk-container-id-1 div.sk-container {/* jupyter's `normalize.less` sets `[hidden] { display: none; }` but bootstrap.min.css set `[hidden] { display: none !important; }` so we also need the `!important` here to be able to override the default hidden behavior on the sphinx rendered scikit-learn.org. See: https://github.com/scikit-learn/scikit-learn/issues/21755 */display: inline-block !important;position: relative;}#sk-container-id-1 div.sk-text-repr-fallback {display: none;}</style><div id="sk-container-id-1" class="sk-top-container"><div class="sk-text-repr-fallback"><pre>LGBMRegressor(max_depth=4, n_jobs=1)</pre><b>In a Jupyter environment, please rerun this cell to show the HTML representation or trust the notebook. <br>On GitHub, the HTML representation is unable to render, please try loading this page with nbviewer.org.</b></div><div class="sk-container" hidden=""><div class="sk-item"><div class="sk-estimator sk-toggleable"><input class="sk-toggleable__control sk-hidden--visually" id="sk-estimator-id-1" type="checkbox" checked=""><label for="sk-estimator-id-1" class="sk-toggleable__label sk-toggleable__label-arrow">LGBMRegressor</label><div class="sk-toggleable__content"><pre>LGBMRegressor(max_depth=4, n_jobs=1)</pre></div></div></div></div></div>
</div>
</div>
</section>
<section id="cross-validation" class="level2">
<h2 class="anchored" data-anchor-id="cross-validation">Cross-Validation</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb46"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> sklearn.model_selection <span class="im">import</span> ParameterGrid</span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a>yPredTrain <span class="op">=</span> LGBM.predict(XTrain)</span>
<span id="cb46-4"><a href="#cb46-4" aria-hidden="true" tabindex="-1"></a>yTestPred <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb46-5"><a href="#cb46-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb46-6"><a href="#cb46-6" aria-hidden="true" tabindex="-1"></a>dataTrain <span class="op">=</span> data[data[<span class="st">'label'</span>] <span class="op">==</span> <span class="st">'train'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="wasserstein-distance" class="level3">
<h3 class="anchored" data-anchor-id="wasserstein-distance">Wasserstein Distance</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb47"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># ONE DIMENSIONAL TARGET VALUES</span></span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>densities <span class="op">=</span> [(np.array([<span class="fl">0.4</span>, <span class="fl">0.6</span>]), np.array([<span class="dv">2</span>, <span class="dv">4</span>])), </span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>             (np.array([<span class="fl">0.5</span>, <span class="fl">0.5</span>]), np.array([<span class="dv">3</span>, <span class="dv">6</span>]))]</span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array([<span class="dv">3</span>, <span class="dv">4</span>])</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>wassersteinDists <span class="op">=</span> getWassersteinDistances(densities <span class="op">=</span> densities, </span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>                                           yTest <span class="op">=</span> y, </span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a>                                           p <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a>distsByHand <span class="op">=</span> np.array([<span class="fl">0.4</span> <span class="op">*</span> <span class="dv">1</span> <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> <span class="dv">1</span>, <span class="fl">0.5</span> <span class="op">*</span> <span class="dv">1</span> <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> <span class="dv">2</span>])</span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(wassersteinDists, distsByHand)</span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="co"># MULTI DIMENSIONAL TARGET VALUES</span></span>
<span id="cb47-18"><a href="#cb47-18" aria-hidden="true" tabindex="-1"></a>densities <span class="op">=</span> [(np.array([<span class="fl">0.4</span>, <span class="fl">0.6</span>]), np.array([[<span class="dv">2</span>, <span class="dv">4</span>], [<span class="dv">4</span>, <span class="dv">4</span>]])), </span>
<span id="cb47-19"><a href="#cb47-19" aria-hidden="true" tabindex="-1"></a>             (np.array([<span class="fl">0.5</span>, <span class="fl">0.5</span>]), np.array([[<span class="dv">3</span>, <span class="dv">6</span>], [<span class="dv">2</span>, <span class="dv">3</span>]]))]</span>
<span id="cb47-20"><a href="#cb47-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-21"><a href="#cb47-21" aria-hidden="true" tabindex="-1"></a>y <span class="op">=</span> np.array([[<span class="dv">3</span>, <span class="dv">4</span>], </span>
<span id="cb47-22"><a href="#cb47-22" aria-hidden="true" tabindex="-1"></a>              [<span class="dv">4</span>, <span class="dv">2</span>]])</span>
<span id="cb47-23"><a href="#cb47-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-24"><a href="#cb47-24" aria-hidden="true" tabindex="-1"></a>wassersteinDists <span class="op">=</span> getWassersteinDistances(densities <span class="op">=</span> densities, </span>
<span id="cb47-25"><a href="#cb47-25" aria-hidden="true" tabindex="-1"></a>                                           yTest <span class="op">=</span> y,</span>
<span id="cb47-26"><a href="#cb47-26" aria-hidden="true" tabindex="-1"></a>                                           p <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb47-27"><a href="#cb47-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-28"><a href="#cb47-28" aria-hidden="true" tabindex="-1"></a>distsByHand <span class="op">=</span> np.array([<span class="fl">0.4</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">0</span>) <span class="op">+</span> <span class="fl">0.6</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">0</span>), </span>
<span id="cb47-29"><a href="#cb47-29" aria-hidden="true" tabindex="-1"></a>                        <span class="fl">0.5</span> <span class="op">*</span> (<span class="dv">1</span> <span class="op">+</span> <span class="dv">4</span>) <span class="op">+</span> <span class="fl">0.5</span> <span class="op">*</span> (<span class="dv">2</span> <span class="op">+</span> <span class="dv">1</span>)])</span>
<span id="cb47-30"><a href="#cb47-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-31"><a href="#cb47-31" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(wassersteinDists, distsByHand)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="cross-validation---general-quantile-predictors" class="level3">
<h3 class="anchored" data-anchor-id="cross-validation---general-quantile-predictors">Cross Validation - General Quantile Predictors</h3>
<section id="lskdex-as-estimator" class="level4">
<h4 class="anchored" data-anchor-id="lskdex-as-estimator">LSKDEx as Estimator</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb48"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a>LSKDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM,</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>                      weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>kFolds <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>cvFolds <span class="op">=</span> groupedTimeSeriesSplit(data <span class="op">=</span> dataTrain, </span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>                                 kFolds <span class="op">=</span> kFolds, </span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a>                                 testLength <span class="op">=</span> <span class="dv">28</span>, </span>
<span id="cb48-8"><a href="#cb48-8" aria-hidden="true" tabindex="-1"></a>                                 groupFeature <span class="op">=</span> <span class="st">'id'</span>, </span>
<span id="cb48-9"><a href="#cb48-9" aria-hidden="true" tabindex="-1"></a>                                 timeFeature <span class="op">=</span> <span class="st">'dayIndex'</span>)</span>
<span id="cb48-10"><a href="#cb48-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-11"><a href="#cb48-11" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="fl">0.999</span>]</span>
<span id="cb48-12"><a href="#cb48-12" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {<span class="st">'binSize'</span>: [<span class="dv">100</span>, <span class="dv">1000</span>],</span>
<span id="cb48-13"><a href="#cb48-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">'weightsByDistance'</span>: [<span class="va">False</span>]}</span>
<span id="cb48-14"><a href="#cb48-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-15"><a href="#cb48-15" aria-hidden="true" tabindex="-1"></a>parameterGrid <span class="op">=</span> ParameterGrid(parameters)</span>
<span id="cb48-16"><a href="#cb48-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-17"><a href="#cb48-17" aria-hidden="true" tabindex="-1"></a>CV <span class="op">=</span> QuantileCrossValidation(estimator <span class="op">=</span> LSKDEx, </span>
<span id="cb48-18"><a href="#cb48-18" aria-hidden="true" tabindex="-1"></a>                             parameterGrid <span class="op">=</span> parameters,</span>
<span id="cb48-19"><a href="#cb48-19" aria-hidden="true" tabindex="-1"></a>                             cvFolds <span class="op">=</span> cvFolds, </span>
<span id="cb48-20"><a href="#cb48-20" aria-hidden="true" tabindex="-1"></a>                             probs <span class="op">=</span> probs,</span>
<span id="cb48-21"><a href="#cb48-21" aria-hidden="true" tabindex="-1"></a>                             refitPerProb <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb48-22"><a href="#cb48-22" aria-hidden="true" tabindex="-1"></a>                             n_jobs <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb48-23"><a href="#cb48-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-24"><a href="#cb48-24" aria-hidden="true" tabindex="-1"></a>CV.fit(X <span class="op">=</span> XTrain, y <span class="op">=</span> yTrain)</span>
<span id="cb48-25"><a href="#cb48-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-26"><a href="#cb48-26" aria-hidden="true" tabindex="-1"></a>resIndex <span class="op">=</span> [(<span class="dv">100</span>, <span class="va">False</span>), (<span class="dv">1000</span>, <span class="va">False</span>)]</span>
<span id="cb48-27"><a href="#cb48-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-28"><a href="#cb48-28" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-29"><a href="#cb48-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-30"><a href="#cb48-30" aria-hidden="true" tabindex="-1"></a>test_eq(CV.cvFolds, cvFolds)</span>
<span id="cb48-31"><a href="#cb48-31" aria-hidden="true" tabindex="-1"></a>test_eq(CV.probs, probs)</span>
<span id="cb48-32"><a href="#cb48-32" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.refitPerProb</span>
<span id="cb48-33"><a href="#cb48-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-34"><a href="#cb48-34" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-35"><a href="#cb48-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-36"><a href="#cb48-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimator the same? Note: No __eq__ method is implemented for LGBMRegressor. </span></span>
<span id="cb48-37"><a href="#cb48-37" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM == LGBM2 consequently only returns true when both names are refering to </span></span>
<span id="cb48-38"><a href="#cb48-38" aria-hidden="true" tabindex="-1"></a><span class="co"># the exact same object in memory, which shouldn't be the case here because we </span></span>
<span id="cb48-39"><a href="#cb48-39" aria-hidden="true" tabindex="-1"></a><span class="co"># create a deepcopy of LGBM when initiating LS_KDEx. The point estimators</span></span>
<span id="cb48-40"><a href="#cb48-40" aria-hidden="true" tabindex="-1"></a><span class="co"># should be copies of each other though.</span></span>
<span id="cb48-41"><a href="#cb48-41" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.estimator.estimator <span class="kw">is</span> <span class="kw">not</span> LGBM</span>
<span id="cb48-42"><a href="#cb48-42" aria-hidden="true" tabindex="-1"></a>test_eq(CV.estimator.estimator.predict(XTrain), LGBM.predict(XTrain))</span>
<span id="cb48-43"><a href="#cb48-43" aria-hidden="true" tabindex="-1"></a>test_eq(CV.estimator.estimator.predict(XTest), LGBM.predict(XTest))</span>
<span id="cb48-44"><a href="#cb48-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-45"><a href="#cb48-45" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-46"><a href="#cb48-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-47"><a href="#cb48-47" aria-hidden="true" tabindex="-1"></a><span class="co"># CV results raw</span></span>
<span id="cb48-48"><a href="#cb48-48" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">isinstance</span>(CV.cvResults_raw, <span class="bu">list</span>)</span>
<span id="cb48-49"><a href="#cb48-49" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(CV.cvResults_raw), kFolds)</span>
<span id="cb48-50"><a href="#cb48-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-51"><a href="#cb48-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> resDf <span class="kw">in</span> CV.cvResults_raw:</span>
<span id="cb48-52"><a href="#cb48-52" aria-hidden="true" tabindex="-1"></a>    test_eq(resDf.shape, (<span class="bu">len</span>(resIndex), <span class="bu">len</span>(probs)))</span>
<span id="cb48-53"><a href="#cb48-53" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">list</span>(resDf.index), resIndex)</span>
<span id="cb48-54"><a href="#cb48-54" aria-hidden="true" tabindex="-1"></a>    test_eq(resDf.columns, probs)</span>
<span id="cb48-55"><a href="#cb48-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.<span class="bu">all</span>(resDf <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb48-56"><a href="#cb48-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-57"><a href="#cb48-57" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-58"><a href="#cb48-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-59"><a href="#cb48-59" aria-hidden="true" tabindex="-1"></a><span class="co"># CV results aggregated</span></span>
<span id="cb48-60"><a href="#cb48-60" aria-hidden="true" tabindex="-1"></a>meanCostMatrix <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb48-61"><a href="#cb48-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, kFolds, <span class="dv">1</span>):</span>
<span id="cb48-62"><a href="#cb48-62" aria-hidden="true" tabindex="-1"></a>    meanCostMatrix <span class="op">+=</span> CV.cvResults_raw[i]</span>
<span id="cb48-63"><a href="#cb48-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb48-64"><a href="#cb48-64" aria-hidden="true" tabindex="-1"></a>meanCostMatrix <span class="op">=</span> meanCostMatrix <span class="op">/</span> kFolds</span>
<span id="cb48-65"><a href="#cb48-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-66"><a href="#cb48-66" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(CV.cvResults, meanCostMatrix)</span>
<span id="cb48-67"><a href="#cb48-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-68"><a href="#cb48-68" aria-hidden="true" tabindex="-1"></a>test_eq(CV.cvResults.shape, (<span class="bu">len</span>(resIndex), <span class="bu">len</span>(probs)))</span>
<span id="cb48-69"><a href="#cb48-69" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(CV.cvResults.index), resIndex)</span>
<span id="cb48-70"><a href="#cb48-70" aria-hidden="true" tabindex="-1"></a>test_eq(CV.cvResults.columns, probs)</span>
<span id="cb48-71"><a href="#cb48-71" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.<span class="bu">all</span>(resDf <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb48-72"><a href="#cb48-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-73"><a href="#cb48-73" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-74"><a href="#cb48-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-75"><a href="#cb48-75" aria-hidden="true" tabindex="-1"></a><span class="co"># BEST PARAMETER SETTING</span></span>
<span id="cb48-76"><a href="#cb48-76" aria-hidden="true" tabindex="-1"></a>averageCostsPerParam <span class="op">=</span> CV.cvResults.mean(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb48-77"><a href="#cb48-77" aria-hidden="true" tabindex="-1"></a>paramsBestTest <span class="op">=</span> CV.cvResults.index[np.argmin(averageCostsPerParam)]</span>
<span id="cb48-78"><a href="#cb48-78" aria-hidden="true" tabindex="-1"></a>paramsBestTest <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(CV.cvResults.index.names, paramsBestTest))</span>
<span id="cb48-79"><a href="#cb48-79" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestParams, paramsBestTest)</span>
<span id="cb48-80"><a href="#cb48-80" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.bestParams <span class="kw">in</span> parameterGrid</span>
<span id="cb48-81"><a href="#cb48-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-82"><a href="#cb48-82" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-83"><a href="#cb48-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-84"><a href="#cb48-84" aria-hidden="true" tabindex="-1"></a><span class="co"># BEST PARAMETER SETTING PER PROB</span></span>
<span id="cb48-85"><a href="#cb48-85" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(CV.bestParams_perProb), <span class="bu">len</span>(probs))</span>
<span id="cb48-86"><a href="#cb48-86" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">all</span>([params <span class="kw">in</span> parameterGrid <span class="cf">for</span> params <span class="kw">in</span> CV.bestParams_perProb.values()])</span>
<span id="cb48-87"><a href="#cb48-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-88"><a href="#cb48-88" aria-hidden="true" tabindex="-1"></a>paramsBestPerProbTest <span class="op">=</span> CV.cvResults.idxmin(axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb48-89"><a href="#cb48-89" aria-hidden="true" tabindex="-1"></a>paramsBestPerProbTest <span class="op">=</span> {prob: <span class="bu">dict</span>(<span class="bu">zip</span>(CV.cvResults.index.names, paramsBestPerProbTest.loc[prob])) <span class="cf">for</span> prob <span class="kw">in</span> probs}</span>
<span id="cb48-90"><a href="#cb48-90" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestParams_perProb, paramsBestPerProbTest)</span>
<span id="cb48-91"><a href="#cb48-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-92"><a href="#cb48-92" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-93"><a href="#cb48-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-94"><a href="#cb48-94" aria-hidden="true" tabindex="-1"></a><span class="co"># REFITTED QUANTILE ESTIMATOR</span></span>
<span id="cb48-95"><a href="#cb48-95" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">isinstance</span>(CV.bestEstimator, LevelSetKDEx)</span>
<span id="cb48-96"><a href="#cb48-96" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestEstimator.binSize, paramsBestTest[<span class="st">'binSize'</span>])</span>
<span id="cb48-97"><a href="#cb48-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-98"><a href="#cb48-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimator the same? (Note: No __eq__ method is implemented for LGBMRegressor. </span></span>
<span id="cb48-99"><a href="#cb48-99" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM == LGBM2 consequently only returns true when both names are refering to </span></span>
<span id="cb48-100"><a href="#cb48-100" aria-hidden="true" tabindex="-1"></a><span class="co"># the exact same object in memory, which is not (!!) the case here)</span></span>
<span id="cb48-101"><a href="#cb48-101" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.bestEstimator.estimator <span class="kw">is</span> <span class="kw">not</span> LGBM</span>
<span id="cb48-102"><a href="#cb48-102" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestEstimator.estimator.predict(XTrain), LGBM.predict(XTrain))</span>
<span id="cb48-103"><a href="#cb48-103" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestEstimator.estimator.predict(XTest), LGBM.predict(XTest))</span>
<span id="cb48-104"><a href="#cb48-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-105"><a href="#cb48-105" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb48-106"><a href="#cb48-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-107"><a href="#cb48-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> prob <span class="kw">in</span> probs:</span>
<span id="cb48-108"><a href="#cb48-108" aria-hidden="true" tabindex="-1"></a>    estimator <span class="op">=</span> CV.bestEstimator_perProb[prob]</span>
<span id="cb48-109"><a href="#cb48-109" aria-hidden="true" tabindex="-1"></a>    test_eq(estimator.binSize, paramsBestPerProbTest[prob][<span class="st">'binSize'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lskdex_knn-as-estimator" class="level4">
<h4 class="anchored" data-anchor-id="lskdex_knn-as-estimator">LSKDEx_kNN as Estimator</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb49"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a>LSKDEx <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM,</span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a>                          weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a>kFolds <span class="op">=</span> <span class="dv">2</span></span>
<span id="cb49-5"><a href="#cb49-5" aria-hidden="true" tabindex="-1"></a>cvFolds <span class="op">=</span> groupedTimeSeriesSplit(data <span class="op">=</span> dataTrain, </span>
<span id="cb49-6"><a href="#cb49-6" aria-hidden="true" tabindex="-1"></a>                                 kFolds <span class="op">=</span> kFolds, </span>
<span id="cb49-7"><a href="#cb49-7" aria-hidden="true" tabindex="-1"></a>                                 testLength <span class="op">=</span> <span class="dv">28</span>, </span>
<span id="cb49-8"><a href="#cb49-8" aria-hidden="true" tabindex="-1"></a>                                 groupFeature <span class="op">=</span> <span class="st">'id'</span>, </span>
<span id="cb49-9"><a href="#cb49-9" aria-hidden="true" tabindex="-1"></a>                                 timeFeature <span class="op">=</span> <span class="st">'dayIndex'</span>)</span>
<span id="cb49-10"><a href="#cb49-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-11"><a href="#cb49-11" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.01</span>, <span class="fl">0.1</span>, <span class="fl">0.5</span>, <span class="fl">0.9</span>, <span class="fl">0.99</span>, <span class="fl">0.999</span>]</span>
<span id="cb49-12"><a href="#cb49-12" aria-hidden="true" tabindex="-1"></a>parameters <span class="op">=</span> {<span class="st">'binSize'</span>: [<span class="dv">100</span>, <span class="dv">1000</span>],</span>
<span id="cb49-13"><a href="#cb49-13" aria-hidden="true" tabindex="-1"></a>              <span class="st">'weightsByDistance'</span>: [<span class="va">True</span>]}</span>
<span id="cb49-14"><a href="#cb49-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-15"><a href="#cb49-15" aria-hidden="true" tabindex="-1"></a>parameterGrid <span class="op">=</span> ParameterGrid(parameters)</span>
<span id="cb49-16"><a href="#cb49-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-17"><a href="#cb49-17" aria-hidden="true" tabindex="-1"></a>CV <span class="op">=</span> QuantileCrossValidation(estimator <span class="op">=</span> LSKDEx, </span>
<span id="cb49-18"><a href="#cb49-18" aria-hidden="true" tabindex="-1"></a>                             parameterGrid <span class="op">=</span> parameters,</span>
<span id="cb49-19"><a href="#cb49-19" aria-hidden="true" tabindex="-1"></a>                             cvFolds <span class="op">=</span> cvFolds, </span>
<span id="cb49-20"><a href="#cb49-20" aria-hidden="true" tabindex="-1"></a>                             probs <span class="op">=</span> probs,</span>
<span id="cb49-21"><a href="#cb49-21" aria-hidden="true" tabindex="-1"></a>                             refitPerProb <span class="op">=</span> <span class="va">True</span>,</span>
<span id="cb49-22"><a href="#cb49-22" aria-hidden="true" tabindex="-1"></a>                             n_jobs <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb49-23"><a href="#cb49-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-24"><a href="#cb49-24" aria-hidden="true" tabindex="-1"></a>CV.fit(X <span class="op">=</span> XTrain, y <span class="op">=</span> yTrain)</span>
<span id="cb49-25"><a href="#cb49-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-26"><a href="#cb49-26" aria-hidden="true" tabindex="-1"></a>resIndex <span class="op">=</span> [(<span class="dv">100</span>, <span class="va">True</span>), (<span class="dv">1000</span>, <span class="va">True</span>)]</span>
<span id="cb49-27"><a href="#cb49-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-28"><a href="#cb49-28" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-29"><a href="#cb49-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-30"><a href="#cb49-30" aria-hidden="true" tabindex="-1"></a>test_eq(CV.cvFolds, cvFolds)</span>
<span id="cb49-31"><a href="#cb49-31" aria-hidden="true" tabindex="-1"></a>test_eq(CV.probs, probs)</span>
<span id="cb49-32"><a href="#cb49-32" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.refitPerProb</span>
<span id="cb49-33"><a href="#cb49-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-34"><a href="#cb49-34" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-35"><a href="#cb49-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-36"><a href="#cb49-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimator the same? Note: No __eq__ method is implemented for LGBMRegressor. </span></span>
<span id="cb49-37"><a href="#cb49-37" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM == LGBM2 consequently only returns true when both names are refering to </span></span>
<span id="cb49-38"><a href="#cb49-38" aria-hidden="true" tabindex="-1"></a><span class="co"># the exact same object in memory, which shouldn't be the case here because we </span></span>
<span id="cb49-39"><a href="#cb49-39" aria-hidden="true" tabindex="-1"></a><span class="co"># create a deepcopy of LGBM when initiating LS_KDEx. The point estimators</span></span>
<span id="cb49-40"><a href="#cb49-40" aria-hidden="true" tabindex="-1"></a><span class="co"># should be copies of each other though.</span></span>
<span id="cb49-41"><a href="#cb49-41" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.estimator.estimator <span class="kw">is</span> <span class="kw">not</span> LGBM</span>
<span id="cb49-42"><a href="#cb49-42" aria-hidden="true" tabindex="-1"></a>test_eq(CV.estimator.estimator.predict(XTrain), LGBM.predict(XTrain))</span>
<span id="cb49-43"><a href="#cb49-43" aria-hidden="true" tabindex="-1"></a>test_eq(CV.estimator.estimator.predict(XTest), LGBM.predict(XTest))</span>
<span id="cb49-44"><a href="#cb49-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-45"><a href="#cb49-45" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-46"><a href="#cb49-46" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-47"><a href="#cb49-47" aria-hidden="true" tabindex="-1"></a><span class="co"># CV results raw</span></span>
<span id="cb49-48"><a href="#cb49-48" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">isinstance</span>(CV.cvResults_raw, <span class="bu">list</span>)</span>
<span id="cb49-49"><a href="#cb49-49" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(CV.cvResults_raw), kFolds)</span>
<span id="cb49-50"><a href="#cb49-50" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-51"><a href="#cb49-51" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> resDf <span class="kw">in</span> CV.cvResults_raw:</span>
<span id="cb49-52"><a href="#cb49-52" aria-hidden="true" tabindex="-1"></a>    test_eq(resDf.shape, (<span class="bu">len</span>(resIndex), <span class="bu">len</span>(probs)))</span>
<span id="cb49-53"><a href="#cb49-53" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">list</span>(resDf.index), resIndex)</span>
<span id="cb49-54"><a href="#cb49-54" aria-hidden="true" tabindex="-1"></a>    test_eq(resDf.columns, probs)</span>
<span id="cb49-55"><a href="#cb49-55" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.<span class="bu">all</span>(resDf <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb49-56"><a href="#cb49-56" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-57"><a href="#cb49-57" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-58"><a href="#cb49-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-59"><a href="#cb49-59" aria-hidden="true" tabindex="-1"></a><span class="co"># CV results aggregated</span></span>
<span id="cb49-60"><a href="#cb49-60" aria-hidden="true" tabindex="-1"></a>meanCostMatrix <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb49-61"><a href="#cb49-61" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">0</span>, kFolds, <span class="dv">1</span>):</span>
<span id="cb49-62"><a href="#cb49-62" aria-hidden="true" tabindex="-1"></a>    meanCostMatrix <span class="op">+=</span> CV.cvResults_raw[i]</span>
<span id="cb49-63"><a href="#cb49-63" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb49-64"><a href="#cb49-64" aria-hidden="true" tabindex="-1"></a>meanCostMatrix <span class="op">=</span> meanCostMatrix <span class="op">/</span> kFolds</span>
<span id="cb49-65"><a href="#cb49-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-66"><a href="#cb49-66" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(CV.cvResults, meanCostMatrix)</span>
<span id="cb49-67"><a href="#cb49-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-68"><a href="#cb49-68" aria-hidden="true" tabindex="-1"></a>test_eq(CV.cvResults.shape, (<span class="bu">len</span>(resIndex), <span class="bu">len</span>(probs)))</span>
<span id="cb49-69"><a href="#cb49-69" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(CV.cvResults.index), resIndex)</span>
<span id="cb49-70"><a href="#cb49-70" aria-hidden="true" tabindex="-1"></a>test_eq(CV.cvResults.columns, probs)</span>
<span id="cb49-71"><a href="#cb49-71" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.<span class="bu">all</span>(resDf <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb49-72"><a href="#cb49-72" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-73"><a href="#cb49-73" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-74"><a href="#cb49-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-75"><a href="#cb49-75" aria-hidden="true" tabindex="-1"></a><span class="co"># BEST PARAMETER SETTING</span></span>
<span id="cb49-76"><a href="#cb49-76" aria-hidden="true" tabindex="-1"></a>averageCostsPerParam <span class="op">=</span> CV.cvResults.mean(axis <span class="op">=</span> <span class="dv">1</span>)</span>
<span id="cb49-77"><a href="#cb49-77" aria-hidden="true" tabindex="-1"></a>paramsBestTest <span class="op">=</span> CV.cvResults.index[np.argmin(averageCostsPerParam)]</span>
<span id="cb49-78"><a href="#cb49-78" aria-hidden="true" tabindex="-1"></a>paramsBestTest <span class="op">=</span> <span class="bu">dict</span>(<span class="bu">zip</span>(CV.cvResults.index.names, paramsBestTest))</span>
<span id="cb49-79"><a href="#cb49-79" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestParams, paramsBestTest)</span>
<span id="cb49-80"><a href="#cb49-80" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.bestParams <span class="kw">in</span> parameterGrid</span>
<span id="cb49-81"><a href="#cb49-81" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-82"><a href="#cb49-82" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-83"><a href="#cb49-83" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-84"><a href="#cb49-84" aria-hidden="true" tabindex="-1"></a><span class="co"># BEST PARAMETER SETTING PER PROB</span></span>
<span id="cb49-85"><a href="#cb49-85" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(CV.bestParams_perProb), <span class="bu">len</span>(probs))</span>
<span id="cb49-86"><a href="#cb49-86" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">all</span>([params <span class="kw">in</span> parameterGrid <span class="cf">for</span> params <span class="kw">in</span> CV.bestParams_perProb.values()])</span>
<span id="cb49-87"><a href="#cb49-87" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-88"><a href="#cb49-88" aria-hidden="true" tabindex="-1"></a>paramsBestPerProbTest <span class="op">=</span> CV.cvResults.idxmin(axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb49-89"><a href="#cb49-89" aria-hidden="true" tabindex="-1"></a>paramsBestPerProbTest <span class="op">=</span> {prob: <span class="bu">dict</span>(<span class="bu">zip</span>(CV.cvResults.index.names, paramsBestPerProbTest.loc[prob])) <span class="cf">for</span> prob <span class="kw">in</span> probs}</span>
<span id="cb49-90"><a href="#cb49-90" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestParams_perProb, paramsBestPerProbTest)</span>
<span id="cb49-91"><a href="#cb49-91" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-92"><a href="#cb49-92" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-93"><a href="#cb49-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-94"><a href="#cb49-94" aria-hidden="true" tabindex="-1"></a><span class="co"># REFITTED QUANTILE ESTIMATOR</span></span>
<span id="cb49-95"><a href="#cb49-95" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="bu">isinstance</span>(CV.bestEstimator, LevelSetKDEx_kNN)</span>
<span id="cb49-96"><a href="#cb49-96" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestEstimator.binSize, paramsBestTest[<span class="st">'binSize'</span>])</span>
<span id="cb49-97"><a href="#cb49-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-98"><a href="#cb49-98" aria-hidden="true" tabindex="-1"></a><span class="co"># Estimator the same? (Note: No __eq__ method is implemented for LGBMRegressor. </span></span>
<span id="cb49-99"><a href="#cb49-99" aria-hidden="true" tabindex="-1"></a><span class="co"># LGBM == LGBM2 consequently only returns true when both names are refering to </span></span>
<span id="cb49-100"><a href="#cb49-100" aria-hidden="true" tabindex="-1"></a><span class="co"># the exact same object in memory, which is not (!!) the case here)</span></span>
<span id="cb49-101"><a href="#cb49-101" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> CV.bestEstimator.estimator <span class="kw">is</span> <span class="kw">not</span> LGBM</span>
<span id="cb49-102"><a href="#cb49-102" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestEstimator.estimator.predict(XTrain), LGBM.predict(XTrain))</span>
<span id="cb49-103"><a href="#cb49-103" aria-hidden="true" tabindex="-1"></a>test_eq(CV.bestEstimator.estimator.predict(XTest), LGBM.predict(XTest))</span>
<span id="cb49-104"><a href="#cb49-104" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-105"><a href="#cb49-105" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb49-106"><a href="#cb49-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-107"><a href="#cb49-107" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> prob <span class="kw">in</span> probs:</span>
<span id="cb49-108"><a href="#cb49-108" aria-hidden="true" tabindex="-1"></a>    estimator <span class="op">=</span> CV.bestEstimator_perProb[prob]</span>
<span id="cb49-109"><a href="#cb49-109" aria-hidden="true" tabindex="-1"></a>    test_eq(estimator.binSize, paramsBestPerProbTest[prob][<span class="st">'binSize'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
</section>
<section id="ls_kdex" class="level2">
<h2 class="anchored" data-anchor-id="ls_kdex">LS_KDEx</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb50"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a>LS_KDEx.fit(XTrain, yTrain)</span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-4"><a href="#cb50-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if nothing weird happened to y and yPred</span></span>
<span id="cb50-5"><a href="#cb50-5" aria-hidden="true" tabindex="-1"></a>test_eq(LS_KDEx.yTrain, yTrain)</span>
<span id="cb50-6"><a href="#cb50-6" aria-hidden="true" tabindex="-1"></a>test_eq(LS_KDEx.yPredTrain, LGBM.predict(XTrain))</span>
<span id="cb50-7"><a href="#cb50-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-8"><a href="#cb50-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if fitted has been set correctly</span></span>
<span id="cb50-9"><a href="#cb50-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx.fitted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<section id="standard-attributes" class="level3">
<h3 class="anchored" data-anchor-id="standard-attributes">Standard Attributes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb51"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># All train-indices must be part of indicesPerBin</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a><span class="co"># and duplicates mustn't exist</span></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a>indicesList <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb51-4"><a href="#cb51-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-5"><a href="#cb51-5" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> values <span class="kw">in</span> LS_KDEx.indicesPerBin.values():</span>
<span id="cb51-6"><a href="#cb51-6" aria-hidden="true" tabindex="-1"></a>    indicesList.extend(values)</span>
<span id="cb51-7"><a href="#cb51-7" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb51-8"><a href="#cb51-8" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">set</span>(indicesList), <span class="bu">set</span>(np.arange(XTrain.shape[<span class="dv">0</span>])))</span>
<span id="cb51-9"><a href="#cb51-9" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(indicesList), XTrain.shape[<span class="dv">0</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="lower-bounds" class="level3">
<h3 class="anchored" data-anchor-id="lower-bounds">Lower Bounds</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb52"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Lower-bound structure has to be correct</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> LS_KDEx.yPredTrain</span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a>indicesPerBin <span class="op">=</span> LS_KDEx.indicesPerBin</span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBin <span class="op">=</span> LS_KDEx.lowerBoundPerBin</span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-6"><a href="#cb52-6" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(indicesPerBin)):</span>
<span id="cb52-7"><a href="#cb52-7" aria-hidden="true" tabindex="-1"></a>    binIndex <span class="op">=</span> <span class="bu">list</span>(indicesPerBin.keys())[i]</span>
<span id="cb52-8"><a href="#cb52-8" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> indicesPerBin[binIndex]</span>
<span id="cb52-9"><a href="#cb52-9" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-10"><a href="#cb52-10" aria-hidden="true" tabindex="-1"></a>    minValue <span class="op">=</span> yPred[indices].<span class="bu">min</span>()</span>
<span id="cb52-11"><a href="#cb52-11" aria-hidden="true" tabindex="-1"></a>    maxValue <span class="op">=</span> yPred[indices].<span class="bu">max</span>()</span>
<span id="cb52-12"><a href="#cb52-12" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-13"><a href="#cb52-13" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> minValue <span class="op">&gt;=</span> lowerBoundPerBin.loc[binIndex]</span>
<span id="cb52-14"><a href="#cb52-14" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb52-15"><a href="#cb52-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> binIndex <span class="op">&lt;</span> <span class="bu">max</span>(<span class="bu">list</span>(indicesPerBin.keys())):</span>
<span id="cb52-16"><a href="#cb52-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> maxValue <span class="op">&lt;</span> lowerBoundPerBin.loc[binIndex <span class="op">+</span> <span class="dv">1</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="getweights" class="level3">
<h3 class="anchored" data-anchor-id="getweights">getWeights</h3>
<section id="standard-settings" class="level4">
<h4 class="anchored" data-anchor-id="standard-settings">Standard Settings</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb53"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Weights-Output Test</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a>LS_KDEx.fit(XTrain, yTrain)</span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb53-7"><a href="#cb53-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-8"><a href="#cb53-8" aria-hidden="true" tabindex="-1"></a>indicesPerBin <span class="op">=</span> LS_KDEx.indicesPerBin</span>
<span id="cb53-9"><a href="#cb53-9" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBin <span class="op">=</span> LS_KDEx.lowerBoundPerBin</span>
<span id="cb53-10"><a href="#cb53-10" aria-hidden="true" tabindex="-1"></a>yPredTrain <span class="op">=</span> LGBM.predict(XTrain)</span>
<span id="cb53-11"><a href="#cb53-11" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb53-12"><a href="#cb53-12" aria-hidden="true" tabindex="-1"></a>binPerPred <span class="op">=</span> np.searchsorted(a <span class="op">=</span> lowerBoundPerBin, v <span class="op">=</span> yPredTest, side <span class="op">=</span> <span class="st">'right'</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb53-13"><a href="#cb53-13" aria-hidden="true" tabindex="-1"></a>indicesPerPred <span class="op">=</span> [indicesPerBin[binIndex] <span class="cf">for</span> binIndex <span class="kw">in</span> binPerPred]</span>
<span id="cb53-14"><a href="#cb53-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-15"><a href="#cb53-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb53-16"><a href="#cb53-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-17"><a href="#cb53-17" aria-hidden="true" tabindex="-1"></a>weightsAll <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'all'</span>)</span>
<span id="cb53-18"><a href="#cb53-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-19"><a href="#cb53-19" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if every bin contains at least 100 observations</span></span>
<span id="cb53-20"><a href="#cb53-20" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">sum</span>(weightsAll[i] <span class="op">&gt;</span> <span class="dv">0</span>) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb53-21"><a href="#cb53-21" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (np.array(binSizesReal) <span class="op">&gt;=</span> <span class="dv">100</span>).<span class="bu">all</span>()</span>
<span id="cb53-22"><a href="#cb53-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-23"><a href="#cb53-23" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsAll), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb53-24"><a href="#cb53-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-25"><a href="#cb53-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsAll)):</span>
<span id="cb53-26"><a href="#cb53-26" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsAll[i]</span>
<span id="cb53-27"><a href="#cb53-27" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-28"><a href="#cb53-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb53-29"><a href="#cb53-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb53-30"><a href="#cb53-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-31"><a href="#cb53-31" aria-hidden="true" tabindex="-1"></a>    test_eq(np.where(weights <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>], np.sort(indicesPerPred[i]))</span>
<span id="cb53-32"><a href="#cb53-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-33"><a href="#cb53-33" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb53-34"><a href="#cb53-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-35"><a href="#cb53-35" aria-hidden="true" tabindex="-1"></a>weightsOnlyPos <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb53-36"><a href="#cb53-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-37"><a href="#cb53-37" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if every bin contains at least 100 observations</span></span>
<span id="cb53-38"><a href="#cb53-38" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">len</span>(weightsOnlyPos[i][<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb53-39"><a href="#cb53-39" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (np.array(binSizesReal) <span class="op">&gt;=</span> <span class="dv">100</span>).<span class="bu">all</span>()</span>
<span id="cb53-40"><a href="#cb53-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-41"><a href="#cb53-41" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsOnlyPos), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb53-42"><a href="#cb53-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-43"><a href="#cb53-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsOnlyPos)):</span>
<span id="cb53-44"><a href="#cb53-44" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsOnlyPos[i][<span class="dv">0</span>]</span>
<span id="cb53-45"><a href="#cb53-45" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> weightsOnlyPos[i][<span class="dv">1</span>]</span>
<span id="cb53-46"><a href="#cb53-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-47"><a href="#cb53-47" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb53-48"><a href="#cb53-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb53-49"><a href="#cb53-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-50"><a href="#cb53-50" aria-hidden="true" tabindex="-1"></a>    test_eq(indices, indicesPerPred[i])</span>
<span id="cb53-51"><a href="#cb53-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-52"><a href="#cb53-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(indices) <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb53-53"><a href="#cb53-53" aria-hidden="true" tabindex="-1"></a>        checkLastBin <span class="op">=</span> yPredTrain.<span class="bu">max</span>() <span class="op">==</span> yPredTrain[indices].<span class="bu">max</span>()</span>
<span id="cb53-54"><a href="#cb53-54" aria-hidden="true" tabindex="-1"></a>        checkBinExtension <span class="op">=</span> yPredTrain[indices[<span class="dv">99</span>]] <span class="op">==</span> yPredTrain[indices[<span class="dv">100</span>]]</span>
<span id="cb53-55"><a href="#cb53-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> checkLastBin <span class="kw">or</span> checkBinExtension</span>
<span id="cb53-56"><a href="#cb53-56" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb53-57"><a href="#cb53-57" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb53-58"><a href="#cb53-58" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-59"><a href="#cb53-59" aria-hidden="true" tabindex="-1"></a>weightsSummarized <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>)</span>
<span id="cb53-60"><a href="#cb53-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-61"><a href="#cb53-61" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb53-62"><a href="#cb53-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-63"><a href="#cb53-63" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsSummarized)):</span>
<span id="cb53-64"><a href="#cb53-64" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsSummarized[i][<span class="dv">0</span>]</span>
<span id="cb53-65"><a href="#cb53-65" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsSummarized[i][<span class="dv">1</span>]</span>
<span id="cb53-66"><a href="#cb53-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-67"><a href="#cb53-67" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb53-68"><a href="#cb53-68" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb53-69"><a href="#cb53-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-70"><a href="#cb53-70" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb53-71"><a href="#cb53-71" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(yTrain[indicesPerPred[i]]), <span class="bu">set</span>(values))</span>
<span id="cb53-72"><a href="#cb53-72" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-73"><a href="#cb53-73" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb53-74"><a href="#cb53-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-75"><a href="#cb53-75" aria-hidden="true" tabindex="-1"></a>weightsCumDistr <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistribution'</span>)</span>
<span id="cb53-76"><a href="#cb53-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-77"><a href="#cb53-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if every bin contains at least 100 observations</span></span>
<span id="cb53-78"><a href="#cb53-78" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">len</span>(weightsCumDistr[i][<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb53-79"><a href="#cb53-79" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> (np.array(binSizesReal) <span class="op">&gt;=</span> <span class="dv">100</span>).<span class="bu">all</span>()</span>
<span id="cb53-80"><a href="#cb53-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-81"><a href="#cb53-81" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsCumDistr), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb53-82"><a href="#cb53-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-83"><a href="#cb53-83" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsCumDistr)):</span>
<span id="cb53-84"><a href="#cb53-84" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsCumDistr[i][<span class="dv">0</span>]</span>
<span id="cb53-85"><a href="#cb53-85" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsCumDistr[i][<span class="dv">1</span>]</span>
<span id="cb53-86"><a href="#cb53-86" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-87"><a href="#cb53-87" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb53-88"><a href="#cb53-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb53-89"><a href="#cb53-89" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb53-90"><a href="#cb53-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(np.diff(cumProb), np.diff(cumProb)[<span class="dv">0</span>])</span>
<span id="cb53-91"><a href="#cb53-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-92"><a href="#cb53-92" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(yTrain[indicesPerPred[i]]))</span>
<span id="cb53-93"><a href="#cb53-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-94"><a href="#cb53-94" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb53-95"><a href="#cb53-95" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-96"><a href="#cb53-96" aria-hidden="true" tabindex="-1"></a>weightsDistrSummarized <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistributionSummarized'</span>)</span>
<span id="cb53-97"><a href="#cb53-97" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-98"><a href="#cb53-98" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsDistrSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb53-99"><a href="#cb53-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-100"><a href="#cb53-100" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsDistrSummarized)):</span>
<span id="cb53-101"><a href="#cb53-101" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">0</span>]</span>
<span id="cb53-102"><a href="#cb53-102" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">1</span>]</span>
<span id="cb53-103"><a href="#cb53-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-104"><a href="#cb53-104" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb53-105"><a href="#cb53-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb53-106"><a href="#cb53-106" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb53-107"><a href="#cb53-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb53-108"><a href="#cb53-108" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb53-109"><a href="#cb53-109" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(values), <span class="bu">set</span>(np.sort(yTrain[indicesPerPred[i]])))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distance-based-weights" class="level4">
<h4 class="anchored" data-anchor-id="distance-based-weights">Distance Based Weights</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb54"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Weights-Output Test</span></span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifying XTrain to enforce test-predictions being identical to train predictions</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>XTrainMod <span class="op">=</span> np.concatenate([XTest[<span class="dv">0</span>:<span class="dv">2</span>, :], XTrain], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>yTrainMod <span class="op">=</span> np.concatenate([yTest[<span class="dv">0</span>:<span class="dv">2</span>], yTrain], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">True</span>)</span>
<span id="cb54-8"><a href="#cb54-8" aria-hidden="true" tabindex="-1"></a>LS_KDEx.fit(XTrainMod, yTrainMod)</span>
<span id="cb54-9"><a href="#cb54-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-10"><a href="#cb54-10" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-11"><a href="#cb54-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-12"><a href="#cb54-12" aria-hidden="true" tabindex="-1"></a>indicesPerBin <span class="op">=</span> LS_KDEx.indicesPerBin</span>
<span id="cb54-13"><a href="#cb54-13" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBin <span class="op">=</span> LS_KDEx.lowerBoundPerBin</span>
<span id="cb54-14"><a href="#cb54-14" aria-hidden="true" tabindex="-1"></a>yPredTrain <span class="op">=</span> LGBM.predict(XTrainMod)</span>
<span id="cb54-15"><a href="#cb54-15" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb54-16"><a href="#cb54-16" aria-hidden="true" tabindex="-1"></a>binPerPred <span class="op">=</span> np.searchsorted(a <span class="op">=</span> lowerBoundPerBin, v <span class="op">=</span> yPredTest, side <span class="op">=</span> <span class="st">'right'</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb54-17"><a href="#cb54-17" aria-hidden="true" tabindex="-1"></a>indicesPerPred <span class="op">=</span> [indicesPerBin[binIndex] <span class="cf">for</span> binIndex <span class="kw">in</span> binPerPred]</span>
<span id="cb54-18"><a href="#cb54-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-19"><a href="#cb54-19" aria-hidden="true" tabindex="-1"></a>predDistances <span class="op">=</span> [np.<span class="bu">abs</span>(yPredTrain[indicesPerPred[i]] <span class="op">-</span> yPredTest[i]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb54-20"><a href="#cb54-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-21"><a href="#cb54-21" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-22"><a href="#cb54-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-23"><a href="#cb54-23" aria-hidden="true" tabindex="-1"></a>weightsList <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb54-24"><a href="#cb54-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-25"><a href="#cb54-25" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if all bins either contain at least 100 observations or if not all weights have to equal</span></span>
<span id="cb54-26"><a href="#cb54-26" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">len</span>(weightsList[i][<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb54-27"><a href="#cb54-27" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-28"><a href="#cb54-28" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(binSizesReal)):</span>
<span id="cb54-29"><a href="#cb54-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> binSizesReal[i] <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb54-30"><a href="#cb54-30" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weightsList[i][<span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(weightsList[i][<span class="dv">0</span>]))</span>
<span id="cb54-31"><a href="#cb54-31" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-32"><a href="#cb54-32" aria-hidden="true" tabindex="-1"></a><span class="co"># Because of our above modification of XTrain and yTrain, for the first and second test observation </span></span>
<span id="cb54-33"><a href="#cb54-33" aria-hidden="true" tabindex="-1"></a><span class="co"># the special case applies where the test prediction is identical to at least 1 train prediction.</span></span>
<span id="cb54-34"><a href="#cb54-34" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(weightsList[<span class="dv">0</span>][<span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(weightsList[<span class="dv">0</span>][<span class="dv">0</span>]))</span>
<span id="cb54-35"><a href="#cb54-35" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(weightsList[<span class="dv">1</span>][<span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(weightsList[<span class="dv">0</span>][<span class="dv">0</span>]))</span>
<span id="cb54-36"><a href="#cb54-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-37"><a href="#cb54-37" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">0</span> <span class="kw">in</span> weightsList[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb54-38"><a href="#cb54-38" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">1</span> <span class="kw">in</span> weightsList[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb54-39"><a href="#cb54-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-40"><a href="#cb54-40" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-41"><a href="#cb54-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-42"><a href="#cb54-42" aria-hidden="true" tabindex="-1"></a>weightsAll <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'all'</span>)</span>
<span id="cb54-43"><a href="#cb54-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-44"><a href="#cb54-44" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsAll), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb54-45"><a href="#cb54-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-46"><a href="#cb54-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsAll)):</span>
<span id="cb54-47"><a href="#cb54-47" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> indicesPerPred[i]</span>
<span id="cb54-48"><a href="#cb54-48" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> predDistances[i]</span>
<span id="cb54-49"><a href="#cb54-49" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsAll[i]</span>
<span id="cb54-50"><a href="#cb54-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-51"><a href="#cb54-51" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb54-52"><a href="#cb54-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb54-53"><a href="#cb54-53" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-54"><a href="#cb54-54" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb54-55"><a href="#cb54-55" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-56"><a href="#cb54-56" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb54-57"><a href="#cb54-57" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb54-58"><a href="#cb54-58" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weights[neighborsPredDistanceZero], <span class="dv">1</span> <span class="op">/</span> <span class="bu">sum</span>(predDistanceCloseZero))</span>
<span id="cb54-59"><a href="#cb54-59" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighborsPredDistanceZero), np.sort(np.where(weights <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]))</span>
<span id="cb54-60"><a href="#cb54-60" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-61"><a href="#cb54-61" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-62"><a href="#cb54-62" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb54-63"><a href="#cb54-63" aria-hidden="true" tabindex="-1"></a>        np.allclose(np.sort(weights[neighbors]), np.sort(inverseDistances <span class="op">/</span> <span class="bu">sum</span>(inverseDistances)))</span>
<span id="cb54-64"><a href="#cb54-64" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighbors), np.sort(np.where(weights <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]))</span>
<span id="cb54-65"><a href="#cb54-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-66"><a href="#cb54-66" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-67"><a href="#cb54-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-68"><a href="#cb54-68" aria-hidden="true" tabindex="-1"></a>weightsOnlyPos <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb54-69"><a href="#cb54-69" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-70"><a href="#cb54-70" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsOnlyPos), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb54-71"><a href="#cb54-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-72"><a href="#cb54-72" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsOnlyPos)):</span>
<span id="cb54-73"><a href="#cb54-73" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> indicesPerPred[i]</span>
<span id="cb54-74"><a href="#cb54-74" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> predDistances[i]</span>
<span id="cb54-75"><a href="#cb54-75" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsOnlyPos[i][<span class="dv">0</span>]</span>
<span id="cb54-76"><a href="#cb54-76" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> weightsOnlyPos[i][<span class="dv">1</span>]</span>
<span id="cb54-77"><a href="#cb54-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-78"><a href="#cb54-78" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb54-79"><a href="#cb54-79" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb54-80"><a href="#cb54-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-81"><a href="#cb54-81" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb54-82"><a href="#cb54-82" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-83"><a href="#cb54-83" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb54-84"><a href="#cb54-84" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb54-85"><a href="#cb54-85" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weights, <span class="dv">1</span> <span class="op">/</span> <span class="bu">sum</span>(predDistanceCloseZero))</span>
<span id="cb54-86"><a href="#cb54-86" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighborsPredDistanceZero), np.sort(indices))</span>
<span id="cb54-87"><a href="#cb54-87" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb54-88"><a href="#cb54-88" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-89"><a href="#cb54-89" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb54-90"><a href="#cb54-90" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weights, inverseDistances <span class="op">/</span> <span class="bu">sum</span>(inverseDistances))</span>
<span id="cb54-91"><a href="#cb54-91" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighbors), np.sort(indices))</span>
<span id="cb54-92"><a href="#cb54-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-93"><a href="#cb54-93" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(indices) <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb54-94"><a href="#cb54-94" aria-hidden="true" tabindex="-1"></a>        checkLastBin <span class="op">=</span> yPredTrain.<span class="bu">max</span>() <span class="op">==</span> yPredTrain[indices].<span class="bu">max</span>()</span>
<span id="cb54-95"><a href="#cb54-95" aria-hidden="true" tabindex="-1"></a>        checkBinExtension <span class="op">=</span> yPredTrain[indices[<span class="dv">99</span>]] <span class="op">==</span> yPredTrain[indices[<span class="dv">100</span>]]</span>
<span id="cb54-96"><a href="#cb54-96" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> checkLastBin <span class="kw">or</span> checkBinExtension</span>
<span id="cb54-97"><a href="#cb54-97" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-98"><a href="#cb54-98" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-99"><a href="#cb54-99" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-100"><a href="#cb54-100" aria-hidden="true" tabindex="-1"></a>weightsSummarized <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>)</span>
<span id="cb54-101"><a href="#cb54-101" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-102"><a href="#cb54-102" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb54-103"><a href="#cb54-103" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-104"><a href="#cb54-104" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsSummarized)):</span>
<span id="cb54-105"><a href="#cb54-105" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> indicesPerPred[i]</span>
<span id="cb54-106"><a href="#cb54-106" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> predDistances[i]</span>
<span id="cb54-107"><a href="#cb54-107" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsSummarized[i][<span class="dv">0</span>]</span>
<span id="cb54-108"><a href="#cb54-108" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsSummarized[i][<span class="dv">1</span>]</span>
<span id="cb54-109"><a href="#cb54-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-110"><a href="#cb54-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb54-111"><a href="#cb54-111" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb54-112"><a href="#cb54-112" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-113"><a href="#cb54-113" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb54-114"><a href="#cb54-114" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-115"><a href="#cb54-115" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb54-116"><a href="#cb54-116" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb54-117"><a href="#cb54-117" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsPredDistanceZero]</span>
<span id="cb54-118"><a href="#cb54-118" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb54-119"><a href="#cb54-119" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-120"><a href="#cb54-120" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighbors]</span>
<span id="cb54-121"><a href="#cb54-121" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-122"><a href="#cb54-122" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb54-123"><a href="#cb54-123" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(valuesByHand), <span class="bu">set</span>(values))</span>
<span id="cb54-124"><a href="#cb54-124" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-125"><a href="#cb54-125" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-126"><a href="#cb54-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-127"><a href="#cb54-127" aria-hidden="true" tabindex="-1"></a>weightsCumDistr <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistribution'</span>)</span>
<span id="cb54-128"><a href="#cb54-128" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-129"><a href="#cb54-129" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsCumDistr), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb54-130"><a href="#cb54-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-131"><a href="#cb54-131" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsCumDistr)):</span>
<span id="cb54-132"><a href="#cb54-132" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> indicesPerPred[i]</span>
<span id="cb54-133"><a href="#cb54-133" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> predDistances[i]</span>
<span id="cb54-134"><a href="#cb54-134" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsCumDistr[i][<span class="dv">0</span>]</span>
<span id="cb54-135"><a href="#cb54-135" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsCumDistr[i][<span class="dv">1</span>]</span>
<span id="cb54-136"><a href="#cb54-136" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-137"><a href="#cb54-137" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb54-138"><a href="#cb54-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb54-139"><a href="#cb54-139" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb54-140"><a href="#cb54-140" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-141"><a href="#cb54-141" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb54-142"><a href="#cb54-142" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-143"><a href="#cb54-143" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb54-144"><a href="#cb54-144" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb54-145"><a href="#cb54-145" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsPredDistanceZero]</span>
<span id="cb54-146"><a href="#cb54-146" aria-hidden="true" tabindex="-1"></a>        nCloseZero <span class="op">=</span> <span class="bu">sum</span>(predDistanceCloseZero)</span>
<span id="cb54-147"><a href="#cb54-147" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(cumProb, np.cumsum(np.repeat(<span class="dv">1</span> <span class="op">/</span> nCloseZero, nCloseZero)))</span>
<span id="cb54-148"><a href="#cb54-148" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb54-149"><a href="#cb54-149" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-150"><a href="#cb54-150" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The following test works if we use 'valuesByHand = yTrainMod[weightsOnlyPos[i][1]' to grab the yTrain values</span></span>
<span id="cb54-151"><a href="#cb54-151" aria-hidden="true" tabindex="-1"></a>        <span class="co"># because the getWeights-function does nothing else. If we grab them differently here (e.g. via neighborsMatrix),</span></span>
<span id="cb54-152"><a href="#cb54-152" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the sorting can become different for identical yTrain values which will change the cumulated probabilities</span></span>
<span id="cb54-153"><a href="#cb54-153" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for exactly those indices (and only these). This has no practical implications for the usage of the computed</span></span>
<span id="cb54-154"><a href="#cb54-154" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cumulated distribution function, but it has for the exact value testing we are doing here.</span></span>
<span id="cb54-155"><a href="#cb54-155" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb54-156"><a href="#cb54-156" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[weightsOnlyPos[i][<span class="dv">1</span>]]</span>
<span id="cb54-157"><a href="#cb54-157" aria-hidden="true" tabindex="-1"></a>        valuesByHandIndicesSort <span class="op">=</span> np.argsort(valuesByHand)</span>
<span id="cb54-158"><a href="#cb54-158" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(cumProb, np.cumsum((inverseDistances <span class="op">/</span> <span class="bu">sum</span>(inverseDistances))[valuesByHandIndicesSort]))</span>
<span id="cb54-159"><a href="#cb54-159" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-160"><a href="#cb54-160" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb54-161"><a href="#cb54-161" aria-hidden="true" tabindex="-1"></a>    test_eq(np.sort(valuesByHand), values)</span>
<span id="cb54-162"><a href="#cb54-162" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-163"><a href="#cb54-163" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb54-164"><a href="#cb54-164" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-165"><a href="#cb54-165" aria-hidden="true" tabindex="-1"></a>weightsDistrSummarized <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistributionSummarized'</span>)</span>
<span id="cb54-166"><a href="#cb54-166" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-167"><a href="#cb54-167" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsDistrSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb54-168"><a href="#cb54-168" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-169"><a href="#cb54-169" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsDistrSummarized)):</span>
<span id="cb54-170"><a href="#cb54-170" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> indicesPerPred[i]</span>
<span id="cb54-171"><a href="#cb54-171" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> predDistances[i]</span>
<span id="cb54-172"><a href="#cb54-172" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">0</span>]</span>
<span id="cb54-173"><a href="#cb54-173" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">1</span>]</span>
<span id="cb54-174"><a href="#cb54-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-175"><a href="#cb54-175" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb54-176"><a href="#cb54-176" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb54-177"><a href="#cb54-177" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb54-178"><a href="#cb54-178" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-179"><a href="#cb54-179" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb54-180"><a href="#cb54-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-181"><a href="#cb54-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb54-182"><a href="#cb54-182" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb54-183"><a href="#cb54-183" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsPredDistanceZero]</span>
<span id="cb54-184"><a href="#cb54-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-185"><a href="#cb54-185" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb54-186"><a href="#cb54-186" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb54-187"><a href="#cb54-187" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighbors]</span>
<span id="cb54-188"><a href="#cb54-188" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb54-189"><a href="#cb54-189" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb54-190"><a href="#cb54-190" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb54-191"><a href="#cb54-191" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(valuesByHand), <span class="bu">set</span>(values))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scalinglist" class="level4">
<h4 class="anchored" data-anchor-id="scalinglist">ScalingList</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb55"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing scalingList </span></span>
<span id="cb55-2"><a href="#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="#cb55-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb55-4"><a href="#cb55-4" aria-hidden="true" tabindex="-1"></a>LS_KDEx.fit(XTrain, yTrain)</span>
<span id="cb55-5"><a href="#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="#cb55-6" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb55-7"><a href="#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="#cb55-8" aria-hidden="true" tabindex="-1"></a>indicesPerBin <span class="op">=</span> LS_KDEx.indicesPerBin</span>
<span id="cb55-9"><a href="#cb55-9" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBin <span class="op">=</span> LS_KDEx.lowerBoundPerBin</span>
<span id="cb55-10"><a href="#cb55-10" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb55-11"><a href="#cb55-11" aria-hidden="true" tabindex="-1"></a>binPerPred <span class="op">=</span> np.searchsorted(a <span class="op">=</span> lowerBoundPerBin, v <span class="op">=</span> yPredTest, side <span class="op">=</span> <span class="st">'right'</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb55-12"><a href="#cb55-12" aria-hidden="true" tabindex="-1"></a>indicesPerPred <span class="op">=</span> [indicesPerBin[binIndex] <span class="cf">for</span> binIndex <span class="kw">in</span> binPerPred]</span>
<span id="cb55-13"><a href="#cb55-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-14"><a href="#cb55-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb55-15"><a href="#cb55-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-16"><a href="#cb55-16" aria-hidden="true" tabindex="-1"></a>weightsSummarized <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>, scalingList <span class="op">=</span> scalingList)</span>
<span id="cb55-17"><a href="#cb55-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-18"><a href="#cb55-18" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb55-19"><a href="#cb55-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-20"><a href="#cb55-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsSummarized)):</span>
<span id="cb55-21"><a href="#cb55-21" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsSummarized[i][<span class="dv">0</span>]</span>
<span id="cb55-22"><a href="#cb55-22" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsSummarized[i][<span class="dv">1</span>]</span>
<span id="cb55-23"><a href="#cb55-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-24"><a href="#cb55-24" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb55-25"><a href="#cb55-25" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(yTrain[indicesPerPred[i]] <span class="op">*</span> scalingList[i]), <span class="bu">set</span>(values))</span>
<span id="cb55-26"><a href="#cb55-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-27"><a href="#cb55-27" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb55-28"><a href="#cb55-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-29"><a href="#cb55-29" aria-hidden="true" tabindex="-1"></a>weightsCumDistr <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistribution'</span>, scalingList <span class="op">=</span> scalingList)</span>
<span id="cb55-30"><a href="#cb55-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-31"><a href="#cb55-31" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsCumDistr), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb55-32"><a href="#cb55-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-33"><a href="#cb55-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsCumDistr)):</span>
<span id="cb55-34"><a href="#cb55-34" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsCumDistr[i][<span class="dv">0</span>]</span>
<span id="cb55-35"><a href="#cb55-35" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsCumDistr[i][<span class="dv">1</span>]</span>
<span id="cb55-36"><a href="#cb55-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-37"><a href="#cb55-37" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(yTrain[indicesPerPred[i]]) <span class="op">*</span> scalingList[i])</span>
<span id="cb55-38"><a href="#cb55-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-39"><a href="#cb55-39" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb55-40"><a href="#cb55-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-41"><a href="#cb55-41" aria-hidden="true" tabindex="-1"></a>weightsDistrSummarized <span class="op">=</span> LS_KDEx.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistributionSummarized'</span>, scalingList <span class="op">=</span> scalingList)</span>
<span id="cb55-42"><a href="#cb55-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-43"><a href="#cb55-43" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsDistrSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb55-44"><a href="#cb55-44" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-45"><a href="#cb55-45" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsDistrSummarized)):</span>
<span id="cb55-46"><a href="#cb55-46" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">0</span>]</span>
<span id="cb55-47"><a href="#cb55-47" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">1</span>]</span>
<span id="cb55-48"><a href="#cb55-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb55-49"><a href="#cb55-49" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb55-50"><a href="#cb55-50" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(values), <span class="bu">set</span>(np.sort(yTrain[indicesPerPred[i]]) <span class="op">*</span> scalingList[i]))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="predict" class="level4">
<h4 class="anchored" data-anchor-id="predict">predict</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb56"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing predict-method</span></span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx.fit(XTrain, yTrain)</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb56-6"><a href="#cb56-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-7"><a href="#cb56-7" aria-hidden="true" tabindex="-1"></a>indicesPerBin <span class="op">=</span> LS_KDEx.indicesPerBin</span>
<span id="cb56-8"><a href="#cb56-8" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBin <span class="op">=</span> LS_KDEx.lowerBoundPerBin</span>
<span id="cb56-9"><a href="#cb56-9" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb56-10"><a href="#cb56-10" aria-hidden="true" tabindex="-1"></a>binPerPred <span class="op">=</span> np.searchsorted(a <span class="op">=</span> lowerBoundPerBin, v <span class="op">=</span> yPredTest, side <span class="op">=</span> <span class="st">'right'</span>) <span class="op">-</span> <span class="dv">1</span></span>
<span id="cb56-11"><a href="#cb56-11" aria-hidden="true" tabindex="-1"></a>indicesPerPred <span class="op">=</span> [indicesPerBin[binIndex] <span class="cf">for</span> binIndex <span class="kw">in</span> binPerPred]</span>
<span id="cb56-12"><a href="#cb56-12" aria-hidden="true" tabindex="-1"></a>yTrainPerPred <span class="op">=</span> [yTrain[indices] <span class="cf">for</span> indices <span class="kw">in</span> indicesPerPred]</span>
<span id="cb56-13"><a href="#cb56-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-14"><a href="#cb56-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb56-15"><a href="#cb56-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-16"><a href="#cb56-16" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.5</span>, <span class="fl">0.999</span>]</span>
<span id="cb56-17"><a href="#cb56-17" aria-hidden="true" tabindex="-1"></a>quantileDict <span class="op">=</span> LS_KDEx.predict(X <span class="op">=</span> XTest, probs <span class="op">=</span> probs, scalingList <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb56-18"><a href="#cb56-18" aria-hidden="true" tabindex="-1"></a>quantileDf <span class="op">=</span> LS_KDEx.predict(X <span class="op">=</span> XTest, probs <span class="op">=</span> probs, scalingList <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb56-19"><a href="#cb56-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-20"><a href="#cb56-20" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(quantileDf.columns), probs)</span>
<span id="cb56-21"><a href="#cb56-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb56-22"><a href="#cb56-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(quantileDf.shape[<span class="dv">0</span>]):</span>
<span id="cb56-23"><a href="#cb56-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span>((np.diff(quantileDf.iloc[i,:]) <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>())</span>
<span id="cb56-24"><a href="#cb56-24" aria-hidden="true" tabindex="-1"></a>    test_eq(yTrainPerPred[i].<span class="bu">min</span>(), quantileDf.loc[i, <span class="fl">0.001</span>])</span>
<span id="cb56-25"><a href="#cb56-25" aria-hidden="true" tabindex="-1"></a>    test_eq(yTrainPerPred[i].<span class="bu">max</span>(), quantileDf.loc[i, <span class="fl">0.999</span>])</span>
<span id="cb56-26"><a href="#cb56-26" aria-hidden="true" tabindex="-1"></a>    test_eq(np.quantile(a <span class="op">=</span> yTrainPerPred[i], q <span class="op">=</span> <span class="fl">0.5</span>, method <span class="op">=</span> <span class="st">'inverted_cdf'</span>), quantileDf.loc[i, <span class="fl">0.5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="set-and-get-parameters" class="level3">
<h3 class="anchored" data-anchor-id="set-and-get-parameters">Set and Get Parameters</h3>
</section>
<section id="point-estimator-fit-and-predict" class="level3">
<h3 class="anchored" data-anchor-id="point-estimator-fit-and-predict">Point Estimator Fit and Predict</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb57"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a>LGBM2 <span class="op">=</span> LGBMRegressor(n_jobs <span class="op">=</span> <span class="dv">1</span>, max_depth <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM2, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LS_KDEx.estimator)</span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>LS_KDEx.fit(XTrain, yTrain)</span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx.estimator.fitted_</span>
<span id="cb57-7"><a href="#cb57-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-8"><a href="#cb57-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check whether original estimator has been unintentionally modified</span></span>
<span id="cb57-9"><a href="#cb57-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LGBM2)</span>
<span id="cb57-10"><a href="#cb57-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-11"><a href="#cb57-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb57-12"><a href="#cb57-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-13"><a href="#cb57-13" aria-hidden="true" tabindex="-1"></a>LGBM2 <span class="op">=</span> LGBMRegressor(n_jobs <span class="op">=</span> <span class="dv">1</span>, max_depth <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb57-14"><a href="#cb57-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-15"><a href="#cb57-15" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM2, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb57-16"><a href="#cb57-16" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LS_KDEx.estimator)</span>
<span id="cb57-17"><a href="#cb57-17" aria-hidden="true" tabindex="-1"></a>LS_KDEx.refitPointEstimator(XTrain, yTrain)</span>
<span id="cb57-18"><a href="#cb57-18" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx.estimator.fitted_</span>
<span id="cb57-19"><a href="#cb57-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-20"><a href="#cb57-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check whether original estimator has been unintentionally modified</span></span>
<span id="cb57-21"><a href="#cb57-21" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LGBM2)</span>
<span id="cb57-22"><a href="#cb57-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-23"><a href="#cb57-23" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb57-24"><a href="#cb57-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-25"><a href="#cb57-25" aria-hidden="true" tabindex="-1"></a>LGBM2 <span class="op">=</span> LGBMRegressor(n_jobs <span class="op">=</span> <span class="dv">1</span>, max_depth <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb57-26"><a href="#cb57-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-27"><a href="#cb57-27" aria-hidden="true" tabindex="-1"></a>LS_KDEx <span class="op">=</span> LevelSetKDEx(estimator <span class="op">=</span> LGBM2, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb57-28"><a href="#cb57-28" aria-hidden="true" tabindex="-1"></a>LS_KDEx.set_params(estimator <span class="op">=</span> LGBMRegressor(min_child_samples <span class="op">=</span> <span class="dv">10000</span>))</span>
<span id="cb57-29"><a href="#cb57-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-30"><a href="#cb57-30" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LS_KDEx.estimator)</span>
<span id="cb57-31"><a href="#cb57-31" aria-hidden="true" tabindex="-1"></a>LS_KDEx.refitPointEstimator(XTrain, yTrain)</span>
<span id="cb57-32"><a href="#cb57-32" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx.estimator.fitted_</span>
<span id="cb57-33"><a href="#cb57-33" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(np.unique(LS_KDEx.estimator.predict(XTest))), <span class="dv">1</span>)</span>
<span id="cb57-34"><a href="#cb57-34" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(np.unique(LS_KDEx.pointPredict(XTest))), <span class="dv">1</span>)</span>
<span id="cb57-35"><a href="#cb57-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb57-36"><a href="#cb57-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Check whether original estimator has been unintentionally modified</span></span>
<span id="cb57-37"><a href="#cb57-37" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LGBM2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="ls_kdex_knn" class="level2">
<h2 class="anchored" data-anchor-id="ls_kdex_knn">LS_KDEx_kNN</h2>
<section id="standard-attributes-1" class="level3">
<h3 class="anchored" data-anchor-id="standard-attributes-1">Standard Attributes</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb58"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>)</span>
<span id="cb58-2"><a href="#cb58-2" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrain, yTrain)</span>
<span id="cb58-3"><a href="#cb58-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-4"><a href="#cb58-4" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if nothing weird happened to y and yPred</span></span>
<span id="cb58-5"><a href="#cb58-5" aria-hidden="true" tabindex="-1"></a>test_eq(LS_KDEx_kNN.yTrain, yTrain)</span>
<span id="cb58-6"><a href="#cb58-6" aria-hidden="true" tabindex="-1"></a>test_eq(LS_KDEx_kNN.yPredTrain, LGBM.predict(XTrain))</span>
<span id="cb58-7"><a href="#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="#cb58-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if fitted has been set correctly</span></span>
<span id="cb58-9"><a href="#cb58-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx_kNN.fitted</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="getweights-1" class="level3">
<h3 class="anchored" data-anchor-id="getweights-1">getWeights</h3>
<section id="standard-settings-1" class="level4">
<h4 class="anchored" data-anchor-id="standard-settings-1">Standard Settings</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb59"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Weights-Output Test</span></span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrain, yTrain)</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>nn <span class="op">=</span> LS_KDEx_kNN.nearestNeighborsOnPreds</span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>yPredTest_reshaped <span class="op">=</span> np.reshape(yPredTest, newshape <span class="op">=</span> (<span class="bu">len</span>(yPredTest), <span class="dv">1</span>))</span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a>weightsList <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, </span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a>                                     outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">len</span>(weightsList[i][<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPredTest_reshaped, n_neighbors <span class="op">=</span> <span class="bu">max</span>(binSizesReal))</span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if all bins contain at least 100 observations</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.<span class="bu">all</span>((np.array(binSizesReal) <span class="op">&gt;=</span> <span class="dv">100</span>))</span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a>weightsAll <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'all'</span>)</span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsAll), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-24"><a href="#cb59-24" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsAll)):</span>
<span id="cb59-25"><a href="#cb59-25" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsAll[i]</span>
<span id="cb59-26"><a href="#cb59-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-27"><a href="#cb59-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb59-28"><a href="#cb59-28" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb59-29"><a href="#cb59-29" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(weights[weights <span class="op">&gt;</span> <span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> binSizesReal[i])</span>
<span id="cb59-30"><a href="#cb59-30" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-31"><a href="#cb59-31" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]), <span class="bu">set</span>(np.where(weights <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]))</span>
<span id="cb59-32"><a href="#cb59-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-33"><a href="#cb59-33" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb59-34"><a href="#cb59-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-35"><a href="#cb59-35" aria-hidden="true" tabindex="-1"></a>weightsOnlyPos <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb59-36"><a href="#cb59-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-37"><a href="#cb59-37" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsOnlyPos), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb59-38"><a href="#cb59-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-39"><a href="#cb59-39" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsOnlyPos)):</span>
<span id="cb59-40"><a href="#cb59-40" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsOnlyPos[i][<span class="dv">0</span>]</span>
<span id="cb59-41"><a href="#cb59-41" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> weightsOnlyPos[i][<span class="dv">1</span>]</span>
<span id="cb59-42"><a href="#cb59-42" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-43"><a href="#cb59-43" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb59-44"><a href="#cb59-44" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb59-45"><a href="#cb59-45" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(weights, <span class="dv">1</span> <span class="op">/</span> binSizesReal[i])</span>
<span id="cb59-46"><a href="#cb59-46" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-47"><a href="#cb59-47" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]), <span class="bu">set</span>(indices))</span>
<span id="cb59-48"><a href="#cb59-48" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-49"><a href="#cb59-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(indices) <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb59-50"><a href="#cb59-50" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(np.diff(distancesMatrix[i, <span class="dv">99</span>:binSizesReal[i]]), <span class="dv">0</span>)</span>
<span id="cb59-51"><a href="#cb59-51" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-52"><a href="#cb59-52" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb59-53"><a href="#cb59-53" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-54"><a href="#cb59-54" aria-hidden="true" tabindex="-1"></a>weightsSummarized <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>)</span>
<span id="cb59-55"><a href="#cb59-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-56"><a href="#cb59-56" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb59-57"><a href="#cb59-57" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-58"><a href="#cb59-58" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsSummarized)):</span>
<span id="cb59-59"><a href="#cb59-59" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsSummarized[i][<span class="dv">0</span>]</span>
<span id="cb59-60"><a href="#cb59-60" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsSummarized[i][<span class="dv">1</span>]</span>
<span id="cb59-61"><a href="#cb59-61" aria-hidden="true" tabindex="-1"></a>    valuesByHand <span class="op">=</span> yTrain[neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]]</span>
<span id="cb59-62"><a href="#cb59-62" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-63"><a href="#cb59-63" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb59-64"><a href="#cb59-64" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb59-65"><a href="#cb59-65" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.<span class="bu">all</span>(weights <span class="op">&gt;=</span> <span class="dv">1</span> <span class="op">/</span> binSizesReal[i])</span>
<span id="cb59-66"><a href="#cb59-66" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-67"><a href="#cb59-67" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb59-68"><a href="#cb59-68" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(valuesByHand), <span class="bu">set</span>(values))</span>
<span id="cb59-69"><a href="#cb59-69" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-70"><a href="#cb59-70" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb59-71"><a href="#cb59-71" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-72"><a href="#cb59-72" aria-hidden="true" tabindex="-1"></a>weightsCumDistr <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistribution'</span>)</span>
<span id="cb59-73"><a href="#cb59-73" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-74"><a href="#cb59-74" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsCumDistr), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb59-75"><a href="#cb59-75" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-76"><a href="#cb59-76" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsCumDistr)):</span>
<span id="cb59-77"><a href="#cb59-77" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsCumDistr[i][<span class="dv">0</span>]</span>
<span id="cb59-78"><a href="#cb59-78" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsCumDistr[i][<span class="dv">1</span>]</span>
<span id="cb59-79"><a href="#cb59-79" aria-hidden="true" tabindex="-1"></a>    valuesByHand <span class="op">=</span> yTrain[neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]]</span>
<span id="cb59-80"><a href="#cb59-80" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-81"><a href="#cb59-81" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb59-82"><a href="#cb59-82" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb59-83"><a href="#cb59-83" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb59-84"><a href="#cb59-84" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> np.allclose(np.diff(cumProb), np.diff(cumProb)[<span class="dv">0</span>])</span>
<span id="cb59-85"><a href="#cb59-85" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-86"><a href="#cb59-86" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb59-87"><a href="#cb59-87" aria-hidden="true" tabindex="-1"></a>    test_eq(np.sort(valuesByHand), values)</span>
<span id="cb59-88"><a href="#cb59-88" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-89"><a href="#cb59-89" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb59-90"><a href="#cb59-90" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-91"><a href="#cb59-91" aria-hidden="true" tabindex="-1"></a>weightsDistrSummarized <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistributionSummarized'</span>)</span>
<span id="cb59-92"><a href="#cb59-92" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-93"><a href="#cb59-93" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsDistrSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb59-94"><a href="#cb59-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-95"><a href="#cb59-95" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsDistrSummarized)):</span>
<span id="cb59-96"><a href="#cb59-96" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">0</span>]</span>
<span id="cb59-97"><a href="#cb59-97" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">1</span>]</span>
<span id="cb59-98"><a href="#cb59-98" aria-hidden="true" tabindex="-1"></a>    valuesByHand <span class="op">=</span> yTrain[neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]]</span>
<span id="cb59-99"><a href="#cb59-99" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-100"><a href="#cb59-100" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb59-101"><a href="#cb59-101" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb59-102"><a href="#cb59-102" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb59-103"><a href="#cb59-103" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb59-104"><a href="#cb59-104" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb59-105"><a href="#cb59-105" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb59-106"><a href="#cb59-106" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(valuesByHand), <span class="bu">set</span>(values))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="distance-based-weights-1" class="level4">
<h4 class="anchored" data-anchor-id="distance-based-weights-1">Distance Based Weights</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb60"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Weights-Output Test</span></span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="co"># Modifying XTrain to enforce test-predictions being identical to train predictions</span></span>
<span id="cb60-4"><a href="#cb60-4" aria-hidden="true" tabindex="-1"></a>XTrainMod <span class="op">=</span> np.concatenate([XTest[<span class="dv">0</span>:<span class="dv">2</span>, :], XTrain], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb60-5"><a href="#cb60-5" aria-hidden="true" tabindex="-1"></a>yTrainMod <span class="op">=</span> np.concatenate([yTest[<span class="dv">0</span>:<span class="dv">2</span>], yTrain], axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb60-6"><a href="#cb60-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-7"><a href="#cb60-7" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">True</span>,)</span>
<span id="cb60-8"><a href="#cb60-8" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrainMod, yTrainMod)</span>
<span id="cb60-9"><a href="#cb60-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-10"><a href="#cb60-10" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-11"><a href="#cb60-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-12"><a href="#cb60-12" aria-hidden="true" tabindex="-1"></a>nn <span class="op">=</span> LS_KDEx_kNN.nearestNeighborsOnPreds</span>
<span id="cb60-13"><a href="#cb60-13" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb60-14"><a href="#cb60-14" aria-hidden="true" tabindex="-1"></a>yPredTest_reshaped <span class="op">=</span> np.reshape(yPredTest, newshape <span class="op">=</span> (<span class="bu">len</span>(yPredTest), <span class="dv">1</span>))</span>
<span id="cb60-15"><a href="#cb60-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-16"><a href="#cb60-16" aria-hidden="true" tabindex="-1"></a>weightsList <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest,  </span>
<span id="cb60-17"><a href="#cb60-17" aria-hidden="true" tabindex="-1"></a>                                     outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb60-18"><a href="#cb60-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-19"><a href="#cb60-19" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-20"><a href="#cb60-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-21"><a href="#cb60-21" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">len</span>(weightsList[i][<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb60-22"><a href="#cb60-22" aria-hidden="true" tabindex="-1"></a>distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPredTest_reshaped, n_neighbors <span class="op">=</span> <span class="bu">max</span>(binSizesReal))</span>
<span id="cb60-23"><a href="#cb60-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-24"><a href="#cb60-24" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if all bins either contain at least 100 observations or if not all weights have to equal</span></span>
<span id="cb60-25"><a href="#cb60-25" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(binSizesReal)):</span>
<span id="cb60-26"><a href="#cb60-26" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> binSizesReal[i] <span class="op">&lt;</span> <span class="dv">100</span>:</span>
<span id="cb60-27"><a href="#cb60-27" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weightsList[i][<span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(weightsList[i][<span class="dv">0</span>]))</span>
<span id="cb60-28"><a href="#cb60-28" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-29"><a href="#cb60-29" aria-hidden="true" tabindex="-1"></a><span class="co"># Because of our above modification of XTrain and yTrain, for the first and second test observation </span></span>
<span id="cb60-30"><a href="#cb60-30" aria-hidden="true" tabindex="-1"></a><span class="co"># the special case applies where the test prediction is identical to at least 1 train prediction.</span></span>
<span id="cb60-31"><a href="#cb60-31" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(weightsList[<span class="dv">0</span>][<span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(weightsList[<span class="dv">0</span>][<span class="dv">0</span>]))</span>
<span id="cb60-32"><a href="#cb60-32" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> np.allclose(weightsList[<span class="dv">1</span>][<span class="dv">0</span>], <span class="dv">1</span> <span class="op">/</span> <span class="bu">len</span>(weightsList[<span class="dv">0</span>][<span class="dv">0</span>]))</span>
<span id="cb60-33"><a href="#cb60-33" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-34"><a href="#cb60-34" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">0</span> <span class="kw">in</span> weightsList[<span class="dv">0</span>][<span class="dv">1</span>]</span>
<span id="cb60-35"><a href="#cb60-35" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="dv">1</span> <span class="kw">in</span> weightsList[<span class="dv">1</span>][<span class="dv">1</span>]</span>
<span id="cb60-36"><a href="#cb60-36" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-37"><a href="#cb60-37" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-38"><a href="#cb60-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-39"><a href="#cb60-39" aria-hidden="true" tabindex="-1"></a>weightsAll <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'all'</span>)</span>
<span id="cb60-40"><a href="#cb60-40" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-41"><a href="#cb60-41" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsAll), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb60-42"><a href="#cb60-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-43"><a href="#cb60-43" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsAll)):</span>
<span id="cb60-44"><a href="#cb60-44" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-45"><a href="#cb60-45" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> distancesMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-46"><a href="#cb60-46" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsAll[i]</span>
<span id="cb60-47"><a href="#cb60-47" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-48"><a href="#cb60-48" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;=</span> <span class="dv">0</span>)</span>
<span id="cb60-49"><a href="#cb60-49" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb60-50"><a href="#cb60-50" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-51"><a href="#cb60-51" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb60-52"><a href="#cb60-52" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-53"><a href="#cb60-53" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb60-54"><a href="#cb60-54" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb60-55"><a href="#cb60-55" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weights[neighborsPredDistanceZero], <span class="dv">1</span> <span class="op">/</span> <span class="bu">sum</span>(predDistanceCloseZero))</span>
<span id="cb60-56"><a href="#cb60-56" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighborsPredDistanceZero), np.sort(np.where(weights <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]))</span>
<span id="cb60-57"><a href="#cb60-57" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-58"><a href="#cb60-58" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-59"><a href="#cb60-59" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb60-60"><a href="#cb60-60" aria-hidden="true" tabindex="-1"></a>        np.allclose(np.sort(weights[neighbors]), np.sort(inverseDistances <span class="op">/</span> <span class="bu">sum</span>(inverseDistances)))</span>
<span id="cb60-61"><a href="#cb60-61" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighbors), np.sort(np.where(weights <span class="op">&gt;</span> <span class="dv">0</span>)[<span class="dv">0</span>]))</span>
<span id="cb60-62"><a href="#cb60-62" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-63"><a href="#cb60-63" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-64"><a href="#cb60-64" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-65"><a href="#cb60-65" aria-hidden="true" tabindex="-1"></a>weightsOnlyPos <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb60-66"><a href="#cb60-66" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-67"><a href="#cb60-67" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsOnlyPos), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb60-68"><a href="#cb60-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-69"><a href="#cb60-69" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsOnlyPos)):</span>
<span id="cb60-70"><a href="#cb60-70" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-71"><a href="#cb60-71" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> distancesMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-72"><a href="#cb60-72" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsOnlyPos[i][<span class="dv">0</span>]</span>
<span id="cb60-73"><a href="#cb60-73" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> weightsOnlyPos[i][<span class="dv">1</span>]</span>
<span id="cb60-74"><a href="#cb60-74" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-75"><a href="#cb60-75" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb60-76"><a href="#cb60-76" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb60-77"><a href="#cb60-77" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-78"><a href="#cb60-78" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb60-79"><a href="#cb60-79" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-80"><a href="#cb60-80" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb60-81"><a href="#cb60-81" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb60-82"><a href="#cb60-82" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weights, <span class="dv">1</span> <span class="op">/</span> <span class="bu">sum</span>(predDistanceCloseZero))</span>
<span id="cb60-83"><a href="#cb60-83" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighborsPredDistanceZero), np.sort(indices))</span>
<span id="cb60-84"><a href="#cb60-84" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb60-85"><a href="#cb60-85" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-86"><a href="#cb60-86" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb60-87"><a href="#cb60-87" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(weights, inverseDistances <span class="op">/</span> <span class="bu">sum</span>(inverseDistances))</span>
<span id="cb60-88"><a href="#cb60-88" aria-hidden="true" tabindex="-1"></a>        test_eq(np.sort(neighbors), np.sort(indices))</span>
<span id="cb60-89"><a href="#cb60-89" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-90"><a href="#cb60-90" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(indices) <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb60-91"><a href="#cb60-91" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(np.diff(distancesMatrix[i, <span class="dv">99</span>:binSizesReal[i]]), <span class="dv">0</span>)</span>
<span id="cb60-92"><a href="#cb60-92" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-93"><a href="#cb60-93" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-94"><a href="#cb60-94" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-95"><a href="#cb60-95" aria-hidden="true" tabindex="-1"></a>weightsSummarized <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>)</span>
<span id="cb60-96"><a href="#cb60-96" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-97"><a href="#cb60-97" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb60-98"><a href="#cb60-98" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-99"><a href="#cb60-99" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsSummarized)):</span>
<span id="cb60-100"><a href="#cb60-100" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-101"><a href="#cb60-101" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> distancesMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-102"><a href="#cb60-102" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsSummarized[i][<span class="dv">0</span>]</span>
<span id="cb60-103"><a href="#cb60-103" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsSummarized[i][<span class="dv">1</span>]</span>
<span id="cb60-104"><a href="#cb60-104" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-105"><a href="#cb60-105" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb60-106"><a href="#cb60-106" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb60-107"><a href="#cb60-107" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-108"><a href="#cb60-108" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb60-109"><a href="#cb60-109" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-110"><a href="#cb60-110" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb60-111"><a href="#cb60-111" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb60-112"><a href="#cb60-112" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsPredDistanceZero]</span>
<span id="cb60-113"><a href="#cb60-113" aria-hidden="true" tabindex="-1"></a>            </span>
<span id="cb60-114"><a href="#cb60-114" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-115"><a href="#cb60-115" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]]</span>
<span id="cb60-116"><a href="#cb60-116" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-117"><a href="#cb60-117" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb60-118"><a href="#cb60-118" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(valuesByHand), <span class="bu">set</span>(values))</span>
<span id="cb60-119"><a href="#cb60-119" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-120"><a href="#cb60-120" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-121"><a href="#cb60-121" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-122"><a href="#cb60-122" aria-hidden="true" tabindex="-1"></a>weightsCumDistr <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistribution'</span>)</span>
<span id="cb60-123"><a href="#cb60-123" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-124"><a href="#cb60-124" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsCumDistr), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb60-125"><a href="#cb60-125" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-126"><a href="#cb60-126" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsCumDistr)):</span>
<span id="cb60-127"><a href="#cb60-127" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-128"><a href="#cb60-128" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> distancesMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-129"><a href="#cb60-129" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsCumDistr[i][<span class="dv">0</span>]</span>
<span id="cb60-130"><a href="#cb60-130" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsCumDistr[i][<span class="dv">1</span>]</span>
<span id="cb60-131"><a href="#cb60-131" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-132"><a href="#cb60-132" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb60-133"><a href="#cb60-133" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb60-134"><a href="#cb60-134" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb60-135"><a href="#cb60-135" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-136"><a href="#cb60-136" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb60-137"><a href="#cb60-137" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-138"><a href="#cb60-138" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb60-139"><a href="#cb60-139" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb60-140"><a href="#cb60-140" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsPredDistanceZero]</span>
<span id="cb60-141"><a href="#cb60-141" aria-hidden="true" tabindex="-1"></a>        nCloseZero <span class="op">=</span> <span class="bu">sum</span>(predDistanceCloseZero)</span>
<span id="cb60-142"><a href="#cb60-142" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(cumProb, np.cumsum(np.repeat(<span class="dv">1</span> <span class="op">/</span> nCloseZero, nCloseZero)))</span>
<span id="cb60-143"><a href="#cb60-143" aria-hidden="true" tabindex="-1"></a>        </span>
<span id="cb60-144"><a href="#cb60-144" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-145"><a href="#cb60-145" aria-hidden="true" tabindex="-1"></a>        <span class="co"># The following test works if we use 'valuesByHand = yTrainMod[weightsOnlyPos[i][1]' to grab the yTrain values</span></span>
<span id="cb60-146"><a href="#cb60-146" aria-hidden="true" tabindex="-1"></a>        <span class="co"># because the getWeights-function does nothing else. If we grab them differently here (e.g. via neighborsMatrix),</span></span>
<span id="cb60-147"><a href="#cb60-147" aria-hidden="true" tabindex="-1"></a>        <span class="co"># the sorting can become different for identical yTrain values which will change the cumulated probabilities</span></span>
<span id="cb60-148"><a href="#cb60-148" aria-hidden="true" tabindex="-1"></a>        <span class="co"># for exactly those indices (and only these). This has no practical implications for the usage of the computed</span></span>
<span id="cb60-149"><a href="#cb60-149" aria-hidden="true" tabindex="-1"></a>        <span class="co"># cumulated distribution function, but it has for the exact value testing we are doing here.</span></span>
<span id="cb60-150"><a href="#cb60-150" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb60-151"><a href="#cb60-151" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[weightsOnlyPos[i][<span class="dv">1</span>]]</span>
<span id="cb60-152"><a href="#cb60-152" aria-hidden="true" tabindex="-1"></a>        valuesByHandIndicesSort <span class="op">=</span> np.argsort(valuesByHand)</span>
<span id="cb60-153"><a href="#cb60-153" aria-hidden="true" tabindex="-1"></a>        <span class="cf">assert</span> np.allclose(cumProb, np.cumsum((inverseDistances <span class="op">/</span> <span class="bu">sum</span>(inverseDistances))[valuesByHandIndicesSort]))</span>
<span id="cb60-154"><a href="#cb60-154" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-155"><a href="#cb60-155" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb60-156"><a href="#cb60-156" aria-hidden="true" tabindex="-1"></a>    test_eq(np.sort(valuesByHand), values)</span>
<span id="cb60-157"><a href="#cb60-157" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-158"><a href="#cb60-158" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb60-159"><a href="#cb60-159" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-160"><a href="#cb60-160" aria-hidden="true" tabindex="-1"></a>weightsDistrSummarized <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistributionSummarized'</span>)</span>
<span id="cb60-161"><a href="#cb60-161" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-162"><a href="#cb60-162" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsDistrSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb60-163"><a href="#cb60-163" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb60-164"><a href="#cb60-164" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsDistrSummarized)):</span>
<span id="cb60-165"><a href="#cb60-165" aria-hidden="true" tabindex="-1"></a>    neighbors <span class="op">=</span> neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-166"><a href="#cb60-166" aria-hidden="true" tabindex="-1"></a>    distances <span class="op">=</span> distancesMatrix[i, <span class="dv">0</span>:binSizesReal[i]]</span>
<span id="cb60-167"><a href="#cb60-167" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">0</span>]</span>
<span id="cb60-168"><a href="#cb60-168" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">1</span>]</span>
<span id="cb60-169"><a href="#cb60-169" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-170"><a href="#cb60-170" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-171"><a href="#cb60-171" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(cumProb <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb60-172"><a href="#cb60-172" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(cumProb.<span class="bu">max</span>(), <span class="dv">1</span>)</span>
<span id="cb60-173"><a href="#cb60-173" aria-hidden="true" tabindex="-1"></a>    test_eq(cumProb, np.sort(cumProb))</span>
<span id="cb60-174"><a href="#cb60-174" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-175"><a href="#cb60-175" aria-hidden="true" tabindex="-1"></a>    predDistanceCloseZero <span class="op">=</span> np.isclose(distances, <span class="dv">0</span>)</span>
<span id="cb60-176"><a href="#cb60-176" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-177"><a href="#cb60-177" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> np.<span class="bu">any</span>(predDistanceCloseZero):</span>
<span id="cb60-178"><a href="#cb60-178" aria-hidden="true" tabindex="-1"></a>        neighborsPredDistanceZero <span class="op">=</span> neighbors[np.where(predDistanceCloseZero)[<span class="dv">0</span>]]</span>
<span id="cb60-179"><a href="#cb60-179" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsPredDistanceZero]</span>
<span id="cb60-180"><a href="#cb60-180" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-181"><a href="#cb60-181" aria-hidden="true" tabindex="-1"></a>    <span class="cf">else</span>:</span>
<span id="cb60-182"><a href="#cb60-182" aria-hidden="true" tabindex="-1"></a>        inverseDistances <span class="op">=</span> <span class="dv">1</span> <span class="op">/</span> distances</span>
<span id="cb60-183"><a href="#cb60-183" aria-hidden="true" tabindex="-1"></a>        valuesByHand <span class="op">=</span> yTrainMod[neighborsMatrix[i, <span class="dv">0</span>:binSizesReal[i]]]</span>
<span id="cb60-184"><a href="#cb60-184" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb60-185"><a href="#cb60-185" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb60-186"><a href="#cb60-186" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb60-187"><a href="#cb60-187" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(valuesByHand), <span class="bu">set</span>(values))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="artificially-big-bins" class="level4">
<h4 class="anchored" data-anchor-id="artificially-big-bins">Artificially Big Bins</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb61"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enforcing bins with size bigger than binSize</span></span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Done to ensure that bins with binSize &gt; 100 happen</span></span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a>XTrainDuplicated <span class="op">=</span> np.concatenate([XTrain] <span class="op">*</span> (binSize <span class="op">+</span> <span class="dv">1</span>), axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb61-8"><a href="#cb61-8" aria-hidden="true" tabindex="-1"></a>yTrainDuplicated <span class="op">=</span> np.concatenate([yTrain] <span class="op">*</span> (binSize <span class="op">+</span> <span class="dv">1</span>), axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb61-9"><a href="#cb61-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-10"><a href="#cb61-10" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrainDuplicated, yTrainDuplicated)</span>
<span id="cb61-11"><a href="#cb61-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-12"><a href="#cb61-12" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb61-13"><a href="#cb61-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-14"><a href="#cb61-14" aria-hidden="true" tabindex="-1"></a>nn <span class="op">=</span> LS_KDEx_kNN.nearestNeighborsOnPreds</span>
<span id="cb61-15"><a href="#cb61-15" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb61-16"><a href="#cb61-16" aria-hidden="true" tabindex="-1"></a>yPredTest_reshaped <span class="op">=</span> np.reshape(yPredTest, newshape <span class="op">=</span> (<span class="bu">len</span>(yPredTest), <span class="dv">1</span>))</span>
<span id="cb61-17"><a href="#cb61-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-18"><a href="#cb61-18" aria-hidden="true" tabindex="-1"></a>distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPredTest_reshaped, n_neighbors <span class="op">=</span> binSize <span class="op">+</span> <span class="dv">1</span>)</span>
<span id="cb61-19"><a href="#cb61-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-20"><a href="#cb61-20" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb61-21"><a href="#cb61-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-22"><a href="#cb61-22" aria-hidden="true" tabindex="-1"></a>weightsOnlyPos <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb61-23"><a href="#cb61-23" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-24"><a href="#cb61-24" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsOnlyPos), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb61-25"><a href="#cb61-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb61-26"><a href="#cb61-26" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsOnlyPos)):</span>
<span id="cb61-27"><a href="#cb61-27" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsOnlyPos[i][<span class="dv">0</span>]</span>
<span id="cb61-28"><a href="#cb61-28" aria-hidden="true" tabindex="-1"></a>    indices <span class="op">=</span> weightsOnlyPos[i][<span class="dv">1</span>]</span>
<span id="cb61-29"><a href="#cb61-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-30"><a href="#cb61-30" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb61-31"><a href="#cb61-31" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb61-32"><a href="#cb61-32" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-33"><a href="#cb61-33" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">set</span>(neighborsMatrix[i, <span class="dv">0</span>:binSize]) <span class="op">&lt;=</span> <span class="bu">set</span>(indices)</span>
<span id="cb61-34"><a href="#cb61-34" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb61-35"><a href="#cb61-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> <span class="bu">len</span>(indices) <span class="op">&gt;</span> <span class="dv">100</span>:</span>
<span id="cb61-36"><a href="#cb61-36" aria-hidden="true" tabindex="-1"></a>        test_eq(distancesMatrix[i, binSize<span class="op">-</span><span class="dv">1</span>], distancesMatrix[i, binSize])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="bins-with-only-1-unique-value" class="level4">
<h4 class="anchored" data-anchor-id="bins-with-only-1-unique-value">Bins with only 1 Unique Value</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb62"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Enforcing bins with only one unique value</span></span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">10</span></span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> <span class="dv">10</span>)</span>
<span id="cb62-5"><a href="#cb62-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-6"><a href="#cb62-6" aria-hidden="true" tabindex="-1"></a><span class="co"># Done to ensure that bins with binSize &gt; 100 happen</span></span>
<span id="cb62-7"><a href="#cb62-7" aria-hidden="true" tabindex="-1"></a>XTrainDuplicated <span class="op">=</span> np.concatenate([XTrain] <span class="op">*</span> binSize, axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb62-8"><a href="#cb62-8" aria-hidden="true" tabindex="-1"></a>yTrainDuplicated <span class="op">=</span> np.concatenate([yTrain] <span class="op">*</span> binSize, axis <span class="op">=</span> <span class="dv">0</span>)</span>
<span id="cb62-9"><a href="#cb62-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-10"><a href="#cb62-10" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrainDuplicated, yTrainDuplicated)</span>
<span id="cb62-11"><a href="#cb62-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-12"><a href="#cb62-12" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb62-13"><a href="#cb62-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-14"><a href="#cb62-14" aria-hidden="true" tabindex="-1"></a>weightsOnlyPos <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>)</span>
<span id="cb62-15"><a href="#cb62-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-16"><a href="#cb62-16" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsOnlyPos), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb62-17"><a href="#cb62-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb62-18"><a href="#cb62-18" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsOnlyPos)):</span>
<span id="cb62-19"><a href="#cb62-19" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsOnlyPos[i][<span class="dv">0</span>]</span>
<span id="cb62-20"><a href="#cb62-20" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsOnlyPos[i][<span class="dv">1</span>]</span>
<span id="cb62-21"><a href="#cb62-21" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-22"><a href="#cb62-22" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">all</span>(weights <span class="op">&gt;</span> <span class="dv">0</span>)</span>
<span id="cb62-23"><a href="#cb62-23" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> isclose(weights.<span class="bu">sum</span>(), <span class="dv">1</span>)</span>
<span id="cb62-24"><a href="#cb62-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb62-25"><a href="#cb62-25" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="dv">1</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="scalinglist-1" class="level4">
<h4 class="anchored" data-anchor-id="scalinglist-1">ScalingList</h4>
<div class="cell">
<div class="sourceCode cell-code" id="cb63"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing scalingList </span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">20</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> binSize)</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrain, yTrain)</span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>nn <span class="op">=</span> LS_KDEx_kNN.nearestNeighborsOnPreds</span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>yPredTest_reshaped <span class="op">=</span> np.reshape(yPredTest, newshape <span class="op">=</span> (<span class="bu">len</span>(yPredTest), <span class="dv">1</span>))</span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-12"><a href="#cb63-12" aria-hidden="true" tabindex="-1"></a>distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPredTest_reshaped, n_neighbors <span class="op">=</span> binSize)</span>
<span id="cb63-13"><a href="#cb63-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-14"><a href="#cb63-14" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb63-15"><a href="#cb63-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-16"><a href="#cb63-16" aria-hidden="true" tabindex="-1"></a>weightsSummarized <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'summarized'</span>, scalingList <span class="op">=</span> scalingList)</span>
<span id="cb63-17"><a href="#cb63-17" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-18"><a href="#cb63-18" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb63-19"><a href="#cb63-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-20"><a href="#cb63-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsSummarized)):</span>
<span id="cb63-21"><a href="#cb63-21" aria-hidden="true" tabindex="-1"></a>    weights <span class="op">=</span> weightsSummarized[i][<span class="dv">0</span>]</span>
<span id="cb63-22"><a href="#cb63-22" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsSummarized[i][<span class="dv">1</span>]</span>
<span id="cb63-23"><a href="#cb63-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-24"><a href="#cb63-24" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb63-25"><a href="#cb63-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">set</span>(yTrain[neighborsMatrix[i, :]] <span class="op">*</span> scalingList[i]) <span class="op">&lt;=</span> <span class="bu">set</span>(values)</span>
<span id="cb63-26"><a href="#cb63-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-27"><a href="#cb63-27" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb63-28"><a href="#cb63-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-29"><a href="#cb63-29" aria-hidden="true" tabindex="-1"></a>weightsCumDistr <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistribution'</span>, scalingList <span class="op">=</span> scalingList)</span>
<span id="cb63-30"><a href="#cb63-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-31"><a href="#cb63-31" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsCumDistr), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb63-32"><a href="#cb63-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-33"><a href="#cb63-33" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsCumDistr)):</span>
<span id="cb63-34"><a href="#cb63-34" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsCumDistr[i][<span class="dv">0</span>]</span>
<span id="cb63-35"><a href="#cb63-35" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsCumDistr[i][<span class="dv">1</span>]</span>
<span id="cb63-36"><a href="#cb63-36" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-37"><a href="#cb63-37" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb63-38"><a href="#cb63-38" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">set</span>(yTrain[neighborsMatrix[i, :]] <span class="op">*</span> scalingList[i]) <span class="op">&lt;=</span> <span class="bu">set</span>(values)</span>
<span id="cb63-39"><a href="#cb63-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-40"><a href="#cb63-40" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb63-41"><a href="#cb63-41" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-42"><a href="#cb63-42" aria-hidden="true" tabindex="-1"></a>weightsDistrSummarized <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'cumulativeDistributionSummarized'</span>, scalingList <span class="op">=</span> scalingList)</span>
<span id="cb63-43"><a href="#cb63-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-44"><a href="#cb63-44" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(weightsDistrSummarized), XTest.shape[<span class="dv">0</span>])</span>
<span id="cb63-45"><a href="#cb63-45" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-46"><a href="#cb63-46" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(weightsDistrSummarized)):</span>
<span id="cb63-47"><a href="#cb63-47" aria-hidden="true" tabindex="-1"></a>    cumProb <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">0</span>]</span>
<span id="cb63-48"><a href="#cb63-48" aria-hidden="true" tabindex="-1"></a>    values <span class="op">=</span> weightsDistrSummarized[i][<span class="dv">1</span>]</span>
<span id="cb63-49"><a href="#cb63-49" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb63-50"><a href="#cb63-50" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(values), <span class="bu">len</span>(np.unique(values)))</span>
<span id="cb63-51"><a href="#cb63-51" aria-hidden="true" tabindex="-1"></a>    test_eq(values, np.sort(values))</span>
<span id="cb63-52"><a href="#cb63-52" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span> <span class="bu">set</span>(yTrain[neighborsMatrix[i, :]] <span class="op">*</span> scalingList[i]) <span class="op">&lt;=</span> <span class="bu">set</span>(values)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="predict-1" class="level3">
<h3 class="anchored" data-anchor-id="predict-1">predict</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb64"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing predict-method</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>binSize <span class="op">=</span> <span class="dv">15</span></span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM, binSize <span class="op">=</span> binSize)</span>
<span id="cb64-5"><a href="#cb64-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-6"><a href="#cb64-6" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrain, yTrain)</span>
<span id="cb64-7"><a href="#cb64-7" aria-hidden="true" tabindex="-1"></a>nn <span class="op">=</span> LS_KDEx_kNN.nearestNeighborsOnPreds</span>
<span id="cb64-8"><a href="#cb64-8" aria-hidden="true" tabindex="-1"></a>yPredTest <span class="op">=</span> LGBM.predict(XTest)</span>
<span id="cb64-9"><a href="#cb64-9" aria-hidden="true" tabindex="-1"></a>yPredTest_reshaped <span class="op">=</span> np.reshape(yPredTest, newshape <span class="op">=</span> (<span class="bu">len</span>(yPredTest), <span class="dv">1</span>))</span>
<span id="cb64-10"><a href="#cb64-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-11"><a href="#cb64-11" aria-hidden="true" tabindex="-1"></a>weightsList <span class="op">=</span> LS_KDEx_kNN.getWeights(X <span class="op">=</span> XTest, outputType <span class="op">=</span> <span class="st">'onlyPositiveWeights'</span>)</span>
<span id="cb64-12"><a href="#cb64-12" aria-hidden="true" tabindex="-1"></a>binSizesReal <span class="op">=</span> [<span class="bu">len</span>(weightsList[i][<span class="dv">1</span>]) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(XTest.shape[<span class="dv">0</span>])]</span>
<span id="cb64-13"><a href="#cb64-13" aria-hidden="true" tabindex="-1"></a>distancesMatrix, neighborsMatrix <span class="op">=</span> nn.kneighbors(X <span class="op">=</span> yPredTest_reshaped, n_neighbors <span class="op">=</span> <span class="bu">max</span>(binSizesReal))</span>
<span id="cb64-14"><a href="#cb64-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-15"><a href="#cb64-15" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb64-16"><a href="#cb64-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-17"><a href="#cb64-17" aria-hidden="true" tabindex="-1"></a>probs <span class="op">=</span> [<span class="fl">0.001</span>, <span class="fl">0.5</span>, <span class="fl">0.999</span>]</span>
<span id="cb64-18"><a href="#cb64-18" aria-hidden="true" tabindex="-1"></a>quantileDict <span class="op">=</span> LS_KDEx_kNN.predict(X <span class="op">=</span> XTest, probs <span class="op">=</span> probs, scalingList <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb64-19"><a href="#cb64-19" aria-hidden="true" tabindex="-1"></a>quantileDf <span class="op">=</span> LS_KDEx_kNN.predict(X <span class="op">=</span> XTest, probs <span class="op">=</span> probs, scalingList <span class="op">=</span> <span class="va">None</span>)</span>
<span id="cb64-20"><a href="#cb64-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-21"><a href="#cb64-21" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(quantileDf.columns), probs)</span>
<span id="cb64-22"><a href="#cb64-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb64-23"><a href="#cb64-23" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(quantileDf.shape[<span class="dv">0</span>]):</span>
<span id="cb64-24"><a href="#cb64-24" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-25"><a href="#cb64-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">assert</span>((np.diff(quantileDf.iloc[i,:]) <span class="op">&gt;=</span> <span class="dv">0</span>).<span class="bu">all</span>())</span>
<span id="cb64-26"><a href="#cb64-26" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-27"><a href="#cb64-27" aria-hidden="true" tabindex="-1"></a>    binSizeReal <span class="op">=</span> binSizesReal[i]</span>
<span id="cb64-28"><a href="#cb64-28" aria-hidden="true" tabindex="-1"></a>    valuesByHand <span class="op">=</span> yTrain[neighborsMatrix[i, <span class="dv">0</span>:binSizeReal]]</span>
<span id="cb64-29"><a href="#cb64-29" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb64-30"><a href="#cb64-30" aria-hidden="true" tabindex="-1"></a>    test_eq(valuesByHand.<span class="bu">min</span>(), quantileDf.loc[i, <span class="fl">0.001</span>])</span>
<span id="cb64-31"><a href="#cb64-31" aria-hidden="true" tabindex="-1"></a>    test_eq(valuesByHand.<span class="bu">max</span>(), quantileDf.loc[i, <span class="fl">0.999</span>])</span>
<span id="cb64-32"><a href="#cb64-32" aria-hidden="true" tabindex="-1"></a>    test_eq(np.quantile(a <span class="op">=</span> valuesByHand, q <span class="op">=</span> <span class="fl">0.5</span>, method <span class="op">=</span> <span class="st">'inverted_cdf'</span>), quantileDf.loc[i, <span class="fl">0.5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
<section id="set-and-get-parameters-1" class="level3">
<h3 class="anchored" data-anchor-id="set-and-get-parameters-1">Set and Get Parameters</h3>
</section>
<section id="point-estimator-fit-and-predict-1" class="level3">
<h3 class="anchored" data-anchor-id="point-estimator-fit-and-predict-1">Point Estimator Fit and Predict</h3>
<div class="cell">
<div class="sourceCode cell-code" id="cb65"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>LGBM2 <span class="op">=</span> LGBMRegressor(n_jobs <span class="op">=</span> <span class="dv">1</span>, max_depth <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-3"><a href="#cb65-3" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM2, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb65-4"><a href="#cb65-4" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LS_KDEx_kNN.estimator)</span>
<span id="cb65-5"><a href="#cb65-5" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.fit(XTrain, yTrain)</span>
<span id="cb65-6"><a href="#cb65-6" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx_kNN.estimator.fitted_</span>
<span id="cb65-7"><a href="#cb65-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-8"><a href="#cb65-8" aria-hidden="true" tabindex="-1"></a><span class="co"># Check whether original estimator has been unintentionally modified</span></span>
<span id="cb65-9"><a href="#cb65-9" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LGBM2)</span>
<span id="cb65-10"><a href="#cb65-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-11"><a href="#cb65-11" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb65-12"><a href="#cb65-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-13"><a href="#cb65-13" aria-hidden="true" tabindex="-1"></a>LGBM2 <span class="op">=</span> LGBMRegressor(n_jobs <span class="op">=</span> <span class="dv">1</span>, max_depth <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb65-14"><a href="#cb65-14" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-15"><a href="#cb65-15" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM2, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb65-16"><a href="#cb65-16" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LS_KDEx_kNN.estimator)</span>
<span id="cb65-17"><a href="#cb65-17" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.refitPointEstimator(XTrain, yTrain)</span>
<span id="cb65-18"><a href="#cb65-18" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx_kNN.estimator.fitted_</span>
<span id="cb65-19"><a href="#cb65-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-20"><a href="#cb65-20" aria-hidden="true" tabindex="-1"></a><span class="co"># Check whether original estimator has been unintentionally modified</span></span>
<span id="cb65-21"><a href="#cb65-21" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LGBM2)</span>
<span id="cb65-22"><a href="#cb65-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-23"><a href="#cb65-23" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb65-24"><a href="#cb65-24" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-25"><a href="#cb65-25" aria-hidden="true" tabindex="-1"></a>LGBM2 <span class="op">=</span> LGBMRegressor(n_jobs <span class="op">=</span> <span class="dv">1</span>, max_depth <span class="op">=</span> <span class="dv">2</span>)</span>
<span id="cb65-26"><a href="#cb65-26" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-27"><a href="#cb65-27" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN <span class="op">=</span> LevelSetKDEx_kNN(estimator <span class="op">=</span> LGBM2, binSize <span class="op">=</span> <span class="dv">100</span>, weightsByDistance <span class="op">=</span> <span class="va">False</span>)</span>
<span id="cb65-28"><a href="#cb65-28" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.set_params(estimator <span class="op">=</span> LGBMRegressor(min_child_samples <span class="op">=</span> <span class="dv">10000</span>))</span>
<span id="cb65-29"><a href="#cb65-29" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-30"><a href="#cb65-30" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LS_KDEx_kNN.estimator)</span>
<span id="cb65-31"><a href="#cb65-31" aria-hidden="true" tabindex="-1"></a>LS_KDEx_kNN.refitPointEstimator(XTrain, yTrain)</span>
<span id="cb65-32"><a href="#cb65-32" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> LS_KDEx_kNN.estimator.fitted_</span>
<span id="cb65-33"><a href="#cb65-33" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(np.unique(LS_KDEx_kNN.estimator.predict(XTest))), <span class="dv">1</span>)</span>
<span id="cb65-34"><a href="#cb65-34" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(np.unique(LS_KDEx_kNN.pointPredict(XTest))), <span class="dv">1</span>)</span>
<span id="cb65-35"><a href="#cb65-35" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb65-36"><a href="#cb65-36" aria-hidden="true" tabindex="-1"></a><span class="co"># Check whether original estimator has been unintentionally modified</span></span>
<span id="cb65-37"><a href="#cb65-37" aria-hidden="true" tabindex="-1"></a><span class="cf">assert</span> <span class="st">'fitted_'</span> <span class="kw">not</span> <span class="kw">in</span> <span class="bu">dir</span>(LGBM2)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
</section>
</section>
<section id="generate-bins" class="level2">
<h2 class="anchored" data-anchor-id="generate-bins">Generate Bins</h2>
<div class="cell">
<div class="sourceCode cell-code" id="cb66"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Testing various artificial inputs of 'generateBins'</span></span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.arange(<span class="dv">100</span>)</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a>indicesPerBin, lowerBoundPerBin <span class="op">=</span> generateBins(binSize <span class="op">=</span> <span class="dv">10</span>, yPred <span class="op">=</span> yPred)</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-6"><a href="#cb66-6" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(indicesPerBin.keys()), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)])</span>
<span id="cb66-7"><a href="#cb66-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-8"><a href="#cb66-8" aria-hidden="true" tabindex="-1"></a>indicesPerBinTest <span class="op">=</span> {<span class="dv">0</span>: np.array([<span class="dv">0</span>, <span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">3</span>, <span class="dv">4</span>, <span class="dv">5</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">8</span>, <span class="dv">9</span>]),</span>
<span id="cb66-9"><a href="#cb66-9" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">1</span>: np.array([<span class="dv">10</span>, <span class="dv">11</span>, <span class="dv">12</span>, <span class="dv">13</span>, <span class="dv">14</span>, <span class="dv">15</span>, <span class="dv">16</span>, <span class="dv">17</span>, <span class="dv">18</span>, <span class="dv">19</span>]),</span>
<span id="cb66-10"><a href="#cb66-10" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">2</span>: np.array([<span class="dv">20</span>, <span class="dv">21</span>, <span class="dv">22</span>, <span class="dv">23</span>, <span class="dv">24</span>, <span class="dv">25</span>, <span class="dv">26</span>, <span class="dv">27</span>, <span class="dv">28</span>, <span class="dv">29</span>]),</span>
<span id="cb66-11"><a href="#cb66-11" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">3</span>: np.array([<span class="dv">30</span>, <span class="dv">31</span>, <span class="dv">32</span>, <span class="dv">33</span>, <span class="dv">34</span>, <span class="dv">35</span>, <span class="dv">36</span>, <span class="dv">37</span>, <span class="dv">38</span>, <span class="dv">39</span>]),</span>
<span id="cb66-12"><a href="#cb66-12" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>: np.array([<span class="dv">40</span>, <span class="dv">41</span>, <span class="dv">42</span>, <span class="dv">43</span>, <span class="dv">44</span>, <span class="dv">45</span>, <span class="dv">46</span>, <span class="dv">47</span>, <span class="dv">48</span>, <span class="dv">49</span>]),</span>
<span id="cb66-13"><a href="#cb66-13" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">5</span>: np.array([<span class="dv">50</span>, <span class="dv">51</span>, <span class="dv">52</span>, <span class="dv">53</span>, <span class="dv">54</span>, <span class="dv">55</span>, <span class="dv">56</span>, <span class="dv">57</span>, <span class="dv">58</span>, <span class="dv">59</span>]),</span>
<span id="cb66-14"><a href="#cb66-14" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>: np.array([<span class="dv">60</span>, <span class="dv">61</span>, <span class="dv">62</span>, <span class="dv">63</span>, <span class="dv">64</span>, <span class="dv">65</span>, <span class="dv">66</span>, <span class="dv">67</span>, <span class="dv">68</span>, <span class="dv">69</span>]),</span>
<span id="cb66-15"><a href="#cb66-15" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">7</span>: np.array([<span class="dv">70</span>, <span class="dv">71</span>, <span class="dv">72</span>, <span class="dv">73</span>, <span class="dv">74</span>, <span class="dv">75</span>, <span class="dv">76</span>, <span class="dv">77</span>, <span class="dv">78</span>, <span class="dv">79</span>]),</span>
<span id="cb66-16"><a href="#cb66-16" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">8</span>: np.array([<span class="dv">80</span>, <span class="dv">81</span>, <span class="dv">82</span>, <span class="dv">83</span>, <span class="dv">84</span>, <span class="dv">85</span>, <span class="dv">86</span>, <span class="dv">87</span>, <span class="dv">88</span>, <span class="dv">89</span>]),</span>
<span id="cb66-17"><a href="#cb66-17" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">9</span>: np.array([<span class="dv">90</span>, <span class="dv">91</span>, <span class="dv">92</span>, <span class="dv">93</span>, <span class="dv">94</span>, <span class="dv">95</span>, <span class="dv">96</span>, <span class="dv">97</span>, <span class="dv">98</span>, <span class="dv">99</span>])}</span>
<span id="cb66-18"><a href="#cb66-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-19"><a href="#cb66-19" aria-hidden="true" tabindex="-1"></a>indicesTracker <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb66-20"><a href="#cb66-20" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(indicesPerBin)):</span>
<span id="cb66-21"><a href="#cb66-21" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(indicesPerBin[i]), <span class="bu">set</span>(indicesPerBinTest[i]))</span>
<span id="cb66-22"><a href="#cb66-22" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(indicesPerBin[i]), <span class="bu">len</span>(np.unique(indicesPerBin[i])))</span>
<span id="cb66-23"><a href="#cb66-23" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-24"><a href="#cb66-24" aria-hidden="true" tabindex="-1"></a>    indicesTracker.extend(indicesPerBin[i].tolist())</span>
<span id="cb66-25"><a href="#cb66-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-26"><a href="#cb66-26" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(indicesTracker), <span class="bu">len</span>(np.unique(indicesTracker)))</span>
<span id="cb66-27"><a href="#cb66-27" aria-hidden="true" tabindex="-1"></a>test_eq(np.sort(indicesTracker), np.arange(<span class="bu">len</span>(yPred)))</span>
<span id="cb66-28"><a href="#cb66-28" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-29"><a href="#cb66-29" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBinTest <span class="op">=</span> [np.NINF, <span class="fl">9.5</span>, <span class="fl">19.5</span>, <span class="fl">29.5</span>, <span class="fl">39.5</span>, <span class="fl">49.5</span>, <span class="fl">59.5</span>, <span class="fl">69.5</span>, <span class="fl">79.5</span>, <span class="fl">89.5</span>]</span>
<span id="cb66-30"><a href="#cb66-30" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin), lowerBoundPerBinTest)</span>
<span id="cb66-31"><a href="#cb66-31" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin.index), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>)])</span>
<span id="cb66-32"><a href="#cb66-32" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-33"><a href="#cb66-33" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb66-34"><a href="#cb66-34" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-35"><a href="#cb66-35" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.append(np.arange(<span class="dv">100</span>), np.arange(<span class="dv">100</span>))</span>
<span id="cb66-36"><a href="#cb66-36" aria-hidden="true" tabindex="-1"></a>indicesPerBin, lowerBoundPerBin <span class="op">=</span> generateBins(binSize <span class="op">=</span> <span class="dv">10</span>, yPred <span class="op">=</span> yPred)</span>
<span id="cb66-37"><a href="#cb66-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-38"><a href="#cb66-38" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(indicesPerBin.keys()), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)])</span>
<span id="cb66-39"><a href="#cb66-39" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-40"><a href="#cb66-40" aria-hidden="true" tabindex="-1"></a>indicesPerBinTest <span class="op">=</span> {<span class="dv">0</span>: np.array([   <span class="dv">0</span>, <span class="dv">100</span>,   <span class="dv">1</span>, <span class="dv">101</span>,   <span class="dv">2</span>, <span class="dv">102</span>,   <span class="dv">3</span>, <span class="dv">103</span>,   <span class="dv">4</span>, <span class="dv">104</span>]),</span>
<span id="cb66-41"><a href="#cb66-41" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">1</span>: np.array([   <span class="dv">5</span>, <span class="dv">105</span>,   <span class="dv">6</span>, <span class="dv">106</span>,   <span class="dv">7</span>, <span class="dv">107</span>,   <span class="dv">8</span>, <span class="dv">108</span>,   <span class="dv">9</span>, <span class="dv">109</span>]),</span>
<span id="cb66-42"><a href="#cb66-42" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">2</span>: np.array([  <span class="dv">10</span>, <span class="dv">110</span>,  <span class="dv">11</span>, <span class="dv">111</span>,  <span class="dv">12</span>, <span class="dv">112</span>,  <span class="dv">13</span>, <span class="dv">113</span>,  <span class="dv">14</span>, <span class="dv">114</span>]),</span>
<span id="cb66-43"><a href="#cb66-43" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">3</span>: np.array([  <span class="dv">15</span>, <span class="dv">115</span>,  <span class="dv">16</span>, <span class="dv">116</span>,  <span class="dv">17</span>, <span class="dv">117</span>,  <span class="dv">18</span>, <span class="dv">118</span>,  <span class="dv">19</span>, <span class="dv">119</span>]),</span>
<span id="cb66-44"><a href="#cb66-44" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">4</span>: np.array([  <span class="dv">20</span>, <span class="dv">120</span>,  <span class="dv">21</span>, <span class="dv">121</span>,  <span class="dv">22</span>, <span class="dv">122</span>,  <span class="dv">23</span>, <span class="dv">123</span>,  <span class="dv">24</span>, <span class="dv">124</span>]),</span>
<span id="cb66-45"><a href="#cb66-45" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">5</span>: np.array([  <span class="dv">25</span>, <span class="dv">125</span>,  <span class="dv">26</span>, <span class="dv">126</span>,  <span class="dv">27</span>, <span class="dv">127</span>,  <span class="dv">28</span>, <span class="dv">128</span>,  <span class="dv">29</span>, <span class="dv">129</span>]),</span>
<span id="cb66-46"><a href="#cb66-46" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">6</span>: np.array([  <span class="dv">30</span>, <span class="dv">130</span>,  <span class="dv">31</span>, <span class="dv">131</span>,  <span class="dv">32</span>, <span class="dv">132</span>,  <span class="dv">33</span>, <span class="dv">133</span>,  <span class="dv">34</span>, <span class="dv">134</span>]),</span>
<span id="cb66-47"><a href="#cb66-47" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">7</span>: np.array([  <span class="dv">35</span>, <span class="dv">135</span>,  <span class="dv">36</span>, <span class="dv">136</span>,  <span class="dv">37</span>, <span class="dv">137</span>,  <span class="dv">38</span>, <span class="dv">138</span>,  <span class="dv">39</span>, <span class="dv">139</span>]),</span>
<span id="cb66-48"><a href="#cb66-48" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">8</span>: np.array([  <span class="dv">40</span>, <span class="dv">140</span>,  <span class="dv">41</span>, <span class="dv">141</span>,  <span class="dv">42</span>, <span class="dv">142</span>,  <span class="dv">43</span>, <span class="dv">143</span>,  <span class="dv">44</span>, <span class="dv">144</span>]),</span>
<span id="cb66-49"><a href="#cb66-49" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">9</span>: np.array([  <span class="dv">45</span>, <span class="dv">145</span>,  <span class="dv">46</span>, <span class="dv">146</span>,  <span class="dv">47</span>, <span class="dv">147</span>,  <span class="dv">48</span>, <span class="dv">148</span>,  <span class="dv">49</span>, <span class="dv">149</span>]),</span>
<span id="cb66-50"><a href="#cb66-50" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">10</span>: np.array([ <span class="dv">50</span>, <span class="dv">150</span>,  <span class="dv">51</span>, <span class="dv">151</span>,  <span class="dv">52</span>, <span class="dv">152</span>,  <span class="dv">53</span>, <span class="dv">153</span>,  <span class="dv">54</span>, <span class="dv">154</span>]),</span>
<span id="cb66-51"><a href="#cb66-51" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">11</span>: np.array([ <span class="dv">55</span>, <span class="dv">155</span>,  <span class="dv">56</span>, <span class="dv">156</span>,  <span class="dv">57</span>, <span class="dv">157</span>,  <span class="dv">58</span>, <span class="dv">158</span>,  <span class="dv">59</span>, <span class="dv">159</span>]),</span>
<span id="cb66-52"><a href="#cb66-52" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">12</span>: np.array([ <span class="dv">60</span>, <span class="dv">160</span>,  <span class="dv">61</span>, <span class="dv">161</span>,  <span class="dv">62</span>, <span class="dv">162</span>,  <span class="dv">63</span>, <span class="dv">163</span>,  <span class="dv">64</span>, <span class="dv">164</span>]),</span>
<span id="cb66-53"><a href="#cb66-53" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">13</span>: np.array([ <span class="dv">65</span>, <span class="dv">165</span>,  <span class="dv">66</span>, <span class="dv">166</span>,  <span class="dv">67</span>, <span class="dv">167</span>,  <span class="dv">68</span>, <span class="dv">168</span>,  <span class="dv">69</span>, <span class="dv">169</span>]),</span>
<span id="cb66-54"><a href="#cb66-54" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">14</span>: np.array([ <span class="dv">70</span>, <span class="dv">170</span>,  <span class="dv">71</span>, <span class="dv">171</span>,  <span class="dv">72</span>, <span class="dv">172</span>,  <span class="dv">73</span>, <span class="dv">173</span>,  <span class="dv">74</span>, <span class="dv">174</span>]),</span>
<span id="cb66-55"><a href="#cb66-55" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">15</span>: np.array([ <span class="dv">75</span>, <span class="dv">175</span>,  <span class="dv">76</span>, <span class="dv">176</span>,  <span class="dv">77</span>, <span class="dv">177</span>,  <span class="dv">78</span>, <span class="dv">178</span>,  <span class="dv">79</span>, <span class="dv">179</span>]),</span>
<span id="cb66-56"><a href="#cb66-56" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">16</span>: np.array([ <span class="dv">80</span>, <span class="dv">180</span>,  <span class="dv">81</span>, <span class="dv">181</span>,  <span class="dv">82</span>, <span class="dv">182</span>,  <span class="dv">83</span>, <span class="dv">183</span>,  <span class="dv">84</span>, <span class="dv">184</span>]),</span>
<span id="cb66-57"><a href="#cb66-57" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">17</span>: np.array([ <span class="dv">85</span>, <span class="dv">185</span>,  <span class="dv">86</span>, <span class="dv">186</span>,  <span class="dv">87</span>, <span class="dv">187</span>,  <span class="dv">88</span>, <span class="dv">188</span>,  <span class="dv">89</span>, <span class="dv">189</span>]),</span>
<span id="cb66-58"><a href="#cb66-58" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">18</span>: np.array([ <span class="dv">90</span>, <span class="dv">190</span>,  <span class="dv">91</span>, <span class="dv">191</span>,  <span class="dv">92</span>, <span class="dv">192</span>,  <span class="dv">93</span>, <span class="dv">193</span>,  <span class="dv">94</span>, <span class="dv">194</span>]),</span>
<span id="cb66-59"><a href="#cb66-59" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">19</span>: np.array([ <span class="dv">95</span>, <span class="dv">195</span>,  <span class="dv">96</span>, <span class="dv">196</span>,  <span class="dv">97</span>, <span class="dv">197</span>,  <span class="dv">98</span>, <span class="dv">198</span>,  <span class="dv">99</span>, <span class="dv">199</span>])}</span>
<span id="cb66-60"><a href="#cb66-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-61"><a href="#cb66-61" aria-hidden="true" tabindex="-1"></a>indicesTracker <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb66-62"><a href="#cb66-62" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(indicesPerBin)):</span>
<span id="cb66-63"><a href="#cb66-63" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(indicesPerBin[i]), <span class="bu">set</span>(indicesPerBinTest[i]))</span>
<span id="cb66-64"><a href="#cb66-64" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(indicesPerBin[i]), <span class="bu">len</span>(np.unique(indicesPerBin[i])))</span>
<span id="cb66-65"><a href="#cb66-65" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-66"><a href="#cb66-66" aria-hidden="true" tabindex="-1"></a>    indicesTracker.extend(indicesPerBin[i].tolist())</span>
<span id="cb66-67"><a href="#cb66-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-68"><a href="#cb66-68" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(indicesTracker), <span class="bu">len</span>(np.unique(indicesTracker)))</span>
<span id="cb66-69"><a href="#cb66-69" aria-hidden="true" tabindex="-1"></a>test_eq(np.sort(indicesTracker), np.arange(<span class="bu">len</span>(yPred)))</span>
<span id="cb66-70"><a href="#cb66-70" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-71"><a href="#cb66-71" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBinTest <span class="op">=</span> [np.NINF] <span class="op">+</span> <span class="bu">list</span>(np.arange(<span class="fl">4.5</span>, <span class="fl">99.5</span>, <span class="dv">5</span>))</span>
<span id="cb66-72"><a href="#cb66-72" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin), lowerBoundPerBinTest)</span>
<span id="cb66-73"><a href="#cb66-73" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin.index), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">20</span>)])</span>
<span id="cb66-74"><a href="#cb66-74" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-75"><a href="#cb66-75" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb66-76"><a href="#cb66-76" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-77"><a href="#cb66-77" aria-hidden="true" tabindex="-1"></a><span class="co"># Check if creation of last bin works correctly</span></span>
<span id="cb66-78"><a href="#cb66-78" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.append(np.arange(<span class="dv">10</span>), np.arange(<span class="dv">10</span>))</span>
<span id="cb66-79"><a href="#cb66-79" aria-hidden="true" tabindex="-1"></a>indicesPerBin, lowerBoundPerBin <span class="op">=</span> generateBins(binSize <span class="op">=</span> <span class="dv">5</span>, yPred <span class="op">=</span> yPred)</span>
<span id="cb66-80"><a href="#cb66-80" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-81"><a href="#cb66-81" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(indicesPerBin.keys()), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb66-82"><a href="#cb66-82" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-83"><a href="#cb66-83" aria-hidden="true" tabindex="-1"></a>indicesPerBinTest <span class="op">=</span> {<span class="dv">0</span>: np.array([ <span class="dv">0</span>, <span class="dv">10</span>,  <span class="dv">1</span>, <span class="dv">11</span>,  <span class="dv">2</span>, <span class="dv">12</span>]),</span>
<span id="cb66-84"><a href="#cb66-84" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">1</span>: np.array([ <span class="dv">3</span>, <span class="dv">13</span>,  <span class="dv">4</span>, <span class="dv">14</span>,  <span class="dv">5</span>, <span class="dv">15</span>]),</span>
<span id="cb66-85"><a href="#cb66-85" aria-hidden="true" tabindex="-1"></a>                     <span class="dv">2</span>: np.array([ <span class="dv">6</span>, <span class="dv">16</span>,  <span class="dv">7</span>, <span class="dv">17</span>,  <span class="dv">8</span>, <span class="dv">18</span>,  <span class="dv">9</span>, <span class="dv">19</span>])}</span>
<span id="cb66-86"><a href="#cb66-86" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-87"><a href="#cb66-87" aria-hidden="true" tabindex="-1"></a>indicesTracker <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb66-88"><a href="#cb66-88" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(indicesPerBin)):</span>
<span id="cb66-89"><a href="#cb66-89" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(indicesPerBin[i]), <span class="bu">set</span>(indicesPerBinTest[i]))</span>
<span id="cb66-90"><a href="#cb66-90" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(indicesPerBin[i]), <span class="bu">len</span>(np.unique(indicesPerBin[i])))</span>
<span id="cb66-91"><a href="#cb66-91" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-92"><a href="#cb66-92" aria-hidden="true" tabindex="-1"></a>    indicesTracker.extend(indicesPerBin[i].tolist())</span>
<span id="cb66-93"><a href="#cb66-93" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-94"><a href="#cb66-94" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(indicesTracker), <span class="bu">len</span>(np.unique(indicesTracker)))</span>
<span id="cb66-95"><a href="#cb66-95" aria-hidden="true" tabindex="-1"></a>test_eq(np.sort(indicesTracker), np.arange(<span class="bu">len</span>(yPred)))</span>
<span id="cb66-96"><a href="#cb66-96" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-97"><a href="#cb66-97" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBinTest <span class="op">=</span> [np.NINF, <span class="fl">2.5</span>, <span class="fl">5.5</span>]</span>
<span id="cb66-98"><a href="#cb66-98" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin), lowerBoundPerBinTest)</span>
<span id="cb66-99"><a href="#cb66-99" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin.index), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">3</span>)])</span>
<span id="cb66-100"><a href="#cb66-100" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-101"><a href="#cb66-101" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb66-102"><a href="#cb66-102" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-103"><a href="#cb66-103" aria-hidden="true" tabindex="-1"></a><span class="co"># yPred.unique() == 1</span></span>
<span id="cb66-104"><a href="#cb66-104" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.repeat(<span class="dv">1</span>, <span class="dv">100</span>)</span>
<span id="cb66-105"><a href="#cb66-105" aria-hidden="true" tabindex="-1"></a>indicesPerBin, lowerBoundPerBin <span class="op">=</span> generateBins(binSize <span class="op">=</span> <span class="dv">5</span>, yPred <span class="op">=</span> yPred)</span>
<span id="cb66-106"><a href="#cb66-106" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-107"><a href="#cb66-107" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(indicesPerBin.keys()), [<span class="dv">0</span>])</span>
<span id="cb66-108"><a href="#cb66-108" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-109"><a href="#cb66-109" aria-hidden="true" tabindex="-1"></a>indicesPerBinTest <span class="op">=</span> {<span class="dv">0</span>: np.arange(<span class="dv">0</span>, <span class="dv">100</span>, <span class="dv">1</span>)}</span>
<span id="cb66-110"><a href="#cb66-110" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-111"><a href="#cb66-111" aria-hidden="true" tabindex="-1"></a>indicesTracker <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb66-112"><a href="#cb66-112" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(indicesPerBin)):</span>
<span id="cb66-113"><a href="#cb66-113" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(indicesPerBin[i]), <span class="bu">set</span>(indicesPerBinTest[i]))</span>
<span id="cb66-114"><a href="#cb66-114" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(indicesPerBin[i]), <span class="bu">len</span>(np.unique(indicesPerBin[i])))</span>
<span id="cb66-115"><a href="#cb66-115" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-116"><a href="#cb66-116" aria-hidden="true" tabindex="-1"></a>    indicesTracker.extend(indicesPerBin[i].tolist())</span>
<span id="cb66-117"><a href="#cb66-117" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-118"><a href="#cb66-118" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(indicesTracker), <span class="bu">len</span>(np.unique(indicesTracker)))</span>
<span id="cb66-119"><a href="#cb66-119" aria-hidden="true" tabindex="-1"></a>test_eq(np.sort(indicesTracker), np.arange(<span class="bu">len</span>(yPred)))</span>
<span id="cb66-120"><a href="#cb66-120" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-121"><a href="#cb66-121" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBinTest <span class="op">=</span> [np.NINF]</span>
<span id="cb66-122"><a href="#cb66-122" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin), lowerBoundPerBinTest)</span>
<span id="cb66-123"><a href="#cb66-123" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin.index), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>)])</span>
<span id="cb66-124"><a href="#cb66-124" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-125"><a href="#cb66-125" aria-hidden="true" tabindex="-1"></a><span class="co">#---</span></span>
<span id="cb66-126"><a href="#cb66-126" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-127"><a href="#cb66-127" aria-hidden="true" tabindex="-1"></a><span class="co"># binSize &gt; len(yPred)</span></span>
<span id="cb66-128"><a href="#cb66-128" aria-hidden="true" tabindex="-1"></a>yPred <span class="op">=</span> np.arange(<span class="dv">10</span>)</span>
<span id="cb66-129"><a href="#cb66-129" aria-hidden="true" tabindex="-1"></a>indicesPerBin, lowerBoundPerBin <span class="op">=</span> generateBins(binSize <span class="op">=</span> <span class="dv">100</span>, yPred <span class="op">=</span> yPred)</span>
<span id="cb66-130"><a href="#cb66-130" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-131"><a href="#cb66-131" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(indicesPerBin.keys()), [<span class="dv">0</span>])</span>
<span id="cb66-132"><a href="#cb66-132" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-133"><a href="#cb66-133" aria-hidden="true" tabindex="-1"></a>indicesPerBinTest <span class="op">=</span> {<span class="dv">0</span>: np.arange(<span class="dv">0</span>, <span class="dv">10</span>, <span class="dv">1</span>)}</span>
<span id="cb66-134"><a href="#cb66-134" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-135"><a href="#cb66-135" aria-hidden="true" tabindex="-1"></a>indicesTracker <span class="op">=</span> <span class="bu">list</span>()</span>
<span id="cb66-136"><a href="#cb66-136" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(indicesPerBin)):</span>
<span id="cb66-137"><a href="#cb66-137" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">set</span>(indicesPerBin[i]), <span class="bu">set</span>(indicesPerBinTest[i]))</span>
<span id="cb66-138"><a href="#cb66-138" aria-hidden="true" tabindex="-1"></a>    test_eq(<span class="bu">len</span>(indicesPerBin[i]), <span class="bu">len</span>(np.unique(indicesPerBin[i])))</span>
<span id="cb66-139"><a href="#cb66-139" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-140"><a href="#cb66-140" aria-hidden="true" tabindex="-1"></a>    indicesTracker.extend(indicesPerBin[i].tolist())</span>
<span id="cb66-141"><a href="#cb66-141" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb66-142"><a href="#cb66-142" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">len</span>(indicesTracker), <span class="bu">len</span>(np.unique(indicesTracker)))</span>
<span id="cb66-143"><a href="#cb66-143" aria-hidden="true" tabindex="-1"></a>test_eq(np.sort(indicesTracker), np.arange(<span class="bu">len</span>(yPred)))</span>
<span id="cb66-144"><a href="#cb66-144" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb66-145"><a href="#cb66-145" aria-hidden="true" tabindex="-1"></a>lowerBoundPerBinTest <span class="op">=</span> [np.NINF]</span>
<span id="cb66-146"><a href="#cb66-146" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin), lowerBoundPerBinTest)</span>
<span id="cb66-147"><a href="#cb66-147" aria-hidden="true" tabindex="-1"></a>test_eq(<span class="bu">list</span>(lowerBoundPerBin.index), [i <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">1</span>)])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb67"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # LevelSetKDEx.getWeights() and LevelSetKDEx_kNN.getWeights()</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a><span class="co"># for i in range(len(neighborsList)):</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a><span class="co">#     if len(neighborsList[i]) &lt; self.binSize:</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="co">#         ipdb.set_trace()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb68"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # generateBins</span></span>
<span id="cb68-2"><a href="#cb68-2" aria-hidden="true" tabindex="-1"></a><span class="co"># indices = np.array([])</span></span>
<span id="cb68-3"><a href="#cb68-3" aria-hidden="true" tabindex="-1"></a><span class="co"># for k in range(len(indicesPerBin.keys())):</span></span>
<span id="cb68-4"><a href="#cb68-4" aria-hidden="true" tabindex="-1"></a><span class="co">#     indices = np.append(indices, indicesPerBin[k])</span></span>
<span id="cb68-5"><a href="#cb68-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-6"><a href="#cb68-6" aria-hidden="true" tabindex="-1"></a><span class="co"># if len(indices) != len(yPred):</span></span>
<span id="cb68-7"><a href="#cb68-7" aria-hidden="true" tabindex="-1"></a><span class="co">#     ipdb.set_trace()</span></span>
<span id="cb68-8"><a href="#cb68-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-9"><a href="#cb68-9" aria-hidden="true" tabindex="-1"></a><span class="co"># predCheck = np.array([pred in binPerPred.keys() for pred in yPred])</span></span>
<span id="cb68-10"><a href="#cb68-10" aria-hidden="true" tabindex="-1"></a><span class="co"># keyCheck = np.array([key in yPred for key in binPerPred.keys()])</span></span>
<span id="cb68-11"><a href="#cb68-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb68-12"><a href="#cb68-12" aria-hidden="true" tabindex="-1"></a><span class="co"># if (all(predCheck) &amp; all(keyCheck)) is False:</span></span>
<span id="cb68-13"><a href="#cb68-13" aria-hidden="true" tabindex="-1"></a><span class="co">#     ipdb.set_trace()</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<div class="cell">
<div class="sourceCode cell-code" id="cb69"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="co"># # LevelSetKDEx.getWeights()</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a><span class="co"># check = [i for i in range(len(weightsDataList)) if len(weightsDataList[i][1]) &gt; 100]</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a><span class="co"># check2 = [i for i in range(len(weightsDataList)) if len(weightsDataList[i][1]) &gt; 100 and binPerPred[i] != self.lowerBoundPerBin.index.max()]</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->



</body></html>